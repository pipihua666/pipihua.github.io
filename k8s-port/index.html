<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.01877a06b072953c14c7.css" id="gatsby-global-css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.32.12"/><title data-react-helmet="true">k8s修改外部访问端口 - pipihua&#x27;s blog</title><meta data-react-helmet="true" name="description" content="k8s修改外部访问端口，只要是涉及到service的各种端口解惑"/><meta data-react-helmet="true" property="og:title" content="k8s修改外部访问端口 - pipihua&#x27;s blog"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="k8s修改外部访问端口，只要是涉及到service的各种端口解惑"/><meta data-react-helmet="true" property="og:url" content="https://pipihua666.github.io/k8s-port"/><meta data-react-helmet="true" name="twitter:label1" content="Written by"/><meta data-react-helmet="true" name="twitter:data1" content="pipihua"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="pipihua"/><meta data-react-helmet="true" name="twitter:title" content="k8s修改外部访问端口 - pipihua&#x27;s blog"/><meta data-react-helmet="true" name="twitter:description" content="k8s修改外部访问端口，只要是涉及到service的各种端口解惑"/><meta data-react-helmet="true" name="keywords" content="React, JavaScript, TypeScript, Echarts, DevOps, Devops"/><meta data-react-helmet="true" name="article:published_time" content="2021-04-27 18:22"/><meta data-react-helmet="true" name="article:modified_time" content="2021-04-27 18:22"/><meta data-react-helmet="true" name="twitter:label2" content="Filed under"/><meta data-react-helmet="true" name="twitter:data2" content="Devops"/><meta data-react-helmet="true" property="og:image" content="https://pipihua666.github.io/static/f05eb1861e4384ccd1f4478fe0de1a22/f2cbb/image.jpg"/><meta data-react-helmet="true" name="twitter:image" content="https://pipihua666.github.io/static/f05eb1861e4384ccd1f4478fe0de1a22/f2cbb/image.jpg"/><script data-react-helmet="true" type="application/ld+json">
        {
          "@context": "https://schema.org/",
          "@type": "Article",
          "author": {
            "@type": "Person",
            "name": "pipihua"
          },
          "keywords": "Devops",
          "headline": "k8s修改外部访问端口 - pipihua's blog",
          "url": "https://pipihua666.github.io/k8s-port",
          "datePublished": "2021-04-27 18:22",
          "dateModified": "2021-04-27 18:22",
          "image": {
            "@type": "ImageObject",
            "url": "https://pipihua666.github.io/static/f05eb1861e4384ccd1f4478fe0de1a22/f2cbb/image.jpg",
            "width": "1000",
            "height": "520"
          },
          "publisher": {
            "@type": "Organization",
            "name": "pipihua's blog"
          },
          "description": "k8s修改外部访问端口，只要是涉及到service的各种端口解惑",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://pipihua666.github.io"
          }
        }
      </script><style data-styled="bzOPpS kHKWRw fOuWxu biTeGs jLOYBk fVqyTA cROOCp gWrDHi MQpwo llwmof fYiJFa iRZLqu jZNSfz hRYAD faXnX lhFcmu GDWrm fTdjuL bXjWFc iHPqjx jtkVLk jqyLKa cCerLd bVnRow jqxPBx bYZhdV iKTLAq gTfYTh iHGPyz kXzLbm lfACiL lbetsi OjwYO gpDhwt ctpkkx cXOFUh bqPxdl" data-styled-version="4.4.1">
/* sc-component-id: sc-global-705724203 */
html{line-height:1.15;-webkit-text-size-adjust:100%;} body{margin:0;} main{display:block;} h1{font-size:2em;margin:0.67em 0;} hr{box-sizing:content-box;height:0;overflow:visible;} pre{font-family:monospace,monospace;font-size:1em;} a{background-color:transparent;} abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;} b,strong{font-weight:bolder;} code,kbd,samp{font-family:monospace,monospace;font-size:1em;} small{font-size:80%;} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;} sub{bottom:-0.25em;} sup{top:-0.5em;} img{border-style:none;} button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;} button,input{overflow:visible;} button,select{text-transform:none;} button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;} button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;} button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;} fieldset{padding:0.35em 0.75em 0.625em;} legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;} progress{vertical-align:baseline;} textarea{overflow:auto;} [type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;} [type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;} [type="search"]{-webkit-appearance:textfield;outline-offset:-2px;} [type="search"]::-webkit-search-decoration{-webkit-appearance:none;} ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;} details{display:block;} summary{display:list-item;} template{display:none;} [hidden]{display:none;} html{box-sizing:border-box;background-color:#fafafa;} body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;line-height:1.9em;} *{box-sizing:border-box;} h1,h2,h3,h4,h5,h6{outline:none;} a{color:#000;-webkit-text-decoration:none;text-decoration:none;} .gatsby-highlight{max-width:100% !important;} .gatsby-highlight-code-line{background-color:#353631;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:0.75em;}
/* sc-component-id: style__NavContainer-sc-1ck1w82-0 */
.bzOPpS{z-index:1000;background-color:#20232a;position:-webkit-sticky;position:sticky;top:0;box-shadow:0 0 3px rgba(0,0,0,.03),0 3px 46px rgba(0,0,0,.07);}
/* sc-component-id: style__Nav-sc-1ck1w82-1 */
.kHKWRw{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;} @media (max-width:1300px){.kHKWRw{padding:0 20px;}}
/* sc-component-id: style__NavWrapper-sc-1ck1w82-2 */
.jLOYBk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:100%;height:70px;white-space:nowrap;} @media (max-width:576px){.jLOYBk{width:90%;}}
/* sc-component-id: style__NavMenu-sc-1ck1w82-3 */
.fVqyTA{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;list-style-type:none;margin:0;padding:0;} @media (max-width:576px){.fVqyTA{width:80%;overflow-x:auto;overflow-y:hidden;-webkit-mask-image:linear-gradient(to right,transparent,#000 25px,#000 90%,transparent);mask-image:linear-gradient(to right,transparent,#000 25px,#000 90%,transparent);}}.cROOCp{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;list-style-type:none;margin:0;padding:0;}
/* sc-component-id: style__NavMenuItem-sc-1ck1w82-4 */
.gWrDHi{cursor:pointer;display:inline-block;border:0;background:transparent;outline:none;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: style__NavLink-sc-1ck1w82-5 */
.MQpwo{color:#fff;opacity:.8;padding:16px;-webkit-transition:opacity .5s;transition:opacity .5s;} .MQpwo:hover{opacity:1;}
/* sc-component-id: style__SearchContainer-sc-1ck1w82-6 */
.llwmof{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;position:relative;}
/* sc-component-id: style__ToggleSearchButton-sc-1ck1w82-7 */
.fYiJFa{cursor:pointer;color:#fff;opacity:.8;background:none;outline:none;border:0;-webkit-transition:opacity .5s;transition:opacity .5s;} .fYiJFa:hover{opacity:1;}
/* sc-component-id: logo__LogoImage-sc-1eqkae8-0 */
.biTeGs{max-height:30px;width:30px;margin-right:45px;} @media (max-width:576px){.biTeGs{margin-right:15px;}}
/* sc-component-id: logo__HomeLink-sc-1eqkae8-1 */
.fOuWxu{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;height:30px;}
/* sc-component-id: style__StyledFooter-sc-1oqvjzu-0 */
.gpDhwt{max-width:100%;padding:10px 0;z-index:700;position:relative;font-size:.9em;margin-top:50px;}
/* sc-component-id: style__FooterContainer-sc-1oqvjzu-1 */
.ctpkkx{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;text-align:right;line-height:1.1em;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;} @media (max-width:1300px){.ctpkkx{padding:0 20px;}}
/* sc-component-id: style__Copyright-sc-1oqvjzu-2 */
.cXOFUh{margin:0;}
/* sc-component-id: style__DesignBy-sc-1oqvjzu-3 */
.bqPxdl{margin:0;opacity:.8;font-size:.8em;} .bqPxdl a{font-weight:bold;-webkit-text-decoration:none;text-decoration:none;color:#000;} .bqPxdl a:hover{-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: toc__StyledNav-sc-1hwup8p-0 */
.lhFcmu .toc-list{list-style-type:none;margin:0;padding:0;} .lhFcmu .toc-list .toc-list{padding-left:17px;padding-top:10px;} .lhFcmu .toc-list-item{line-height:1.2em;padding-bottom:10px;} .lhFcmu .toc-list-item:last-child{padding-bottom:0;} .lhFcmu .toc-link{color:#808080;-webkit-text-decoration:none;text-decoration:none;} .lhFcmu .is-active-link{color:#404040;font-weight:700;}
/* sc-component-id: reading-progress__ReadingProgressBar-vxjjnv-0 */
.iRZLqu{position:-webkit-sticky;position:sticky;height:5px;top:70px;background-color:#a4cbb8;z-index:500;}
/* sc-component-id: avatar__StyledAvatar-sc-1v6bq9n-0 */
.kXzLbm{max-width:55px;border-radius:100%;}
/* sc-component-id: bio__StyledBio-sc-19adui4-0 */
.iHGPyz{margin:auto;text-align:center;width:100%;}
/* sc-component-id: bio__AuthorDescription-sc-19adui4-1 */
.lbetsi{margin:10px 0 13px;} .lbetsi a{color:#000;-webkit-text-decoration:underline;text-decoration:underline;}
/* sc-component-id: bio__AuthorName-sc-19adui4-2 */
.lfACiL{margin:10px;}
/* sc-component-id: bio__FriendLink-sc-19adui4-3 */
.OjwYO{-webkit-text-decoration:underline;text-decoration:underline;margin-left:5px;}
/* sc-component-id: post__PostContainer-h8gzap-0 */
.jZNSfz{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:0 !important;} @media (max-width:1300px){.jZNSfz{padding:0 20px;}}
/* sc-component-id: post__LeftSidebar-h8gzap-1 */
.hRYAD{min-width:255px;max-width:225px;-webkit-transition:opacity .5s,z-index .5s;transition:opacity .5s,z-index .5s;} @media (max-width:1300px){.hRYAD{position:fixed;opacity:0;z-index:-1;background-color:#fff;width:100% !important;max-width:100%;padding:0 20px;margin-top:-5px;height:calc(100vh - 70px);}}
/* sc-component-id: post__PostContent-h8gzap-2 */
.fTdjuL{margin-top:-5px;border-right:1px #e5eff5 solid;border-left:1px #e5eff5 solid;background-color:#fff;box-shadow:0 0 3px rgba(0,0,0,.03),0 3px 46px rgba(0,0,0,.1);z-index:10;width:1035px;max-width:100%;} .fTdjuL li > a,.fTdjuL p > a{color:#a4cbb8;border-bottom:2px #a4cbb8 solid;} .fTdjuL pre{margin:30px 0;} .fTdjuL blockquote{border-left:4px #a4cbb8 solid;background-color:#fafafa;margin:30px 0;padding:5px 20px;border-radius:.3em;} .fTdjuL h3::before,.fTdjuL h4::before,.fTdjuL h5::before,.fTdjuL h6::before{display:block;content:" ";height:90px;margin-top:-90px;visibility:hidden;} .fTdjuL h2{border-top:1px solid #ececec;margin-top:44px;padding-top:40px;line-height:1.2;} .fTdjuL code[class*="language-text"]{padding:5px;} .fTdjuL p > img{max-width:100%;border-radius:.3em;margin:30px 0;} .fTdjuL hr{border-top:1px solid #ececec;border-bottom:0;margin-top:44px;margin-bottom:40px;} .fTdjuL .gatsby-resp-image-link{margin:30px 0;max-width:100%;} .fTdjuL .gatsby-resp-image-link .gatsby-resp-image-image{border-radius:.3em;}
/* sc-component-id: post__TocWrapper-h8gzap-3 */
.faXnX{position:-webkit-sticky;position:sticky;top:70px;padding:40px 30px 40px 0;}
/* sc-component-id: post__PostHeader-h8gzap-4 */
.bXjWFc{padding:40px;} @media (max-width:576px){.bXjWFc{padding:20px;}}
/* sc-component-id: post__FeaturedImage-h8gzap-5 */
.jqyLKa{border-radius:0;} @media (max-width:1300px){.jqyLKa{margin-left:-1px;margin-right:-1px;}}
/* sc-component-id: post__StyledPost-h8gzap-6 */
.cCerLd{padding:40px;} @media (max-width:576px){.cCerLd{padding:20px;}}
/* sc-component-id: post__PostMeta-h8gzap-7 */
.iHPqjx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;opacity:.8;font-size:.9em;}
/* sc-component-id: post__PostTitle-h8gzap-8 */
.jtkVLk{margin:0;padding:0;}
/* sc-component-id: post__PostFooter-h8gzap-9 */
.bVnRow{background-color:#fafafa;font-size:.8em;color:#666;padding:40px;line-height:1em;} .bVnRow p{margin:5px 0;}
/* sc-component-id: post__FooterTagLink-h8gzap-10 */
.jqxPBx{color:#000 !important;-webkit-text-decoration:none;text-decoration:none;border-bottom:0 !important;}
/* sc-component-id: post__PostAddition-h8gzap-11 */
.bYZhdV{background-color:#fff;border-top:1px #e5eff5 solid;border-bottom:1px #e5eff5 solid;z-index:700;position:relative;padding:40px;}
/* sc-component-id: post__PostAdditionContent-h8gzap-12 */
.iKTLAq{width:1260px;margin-left:auto;margin-right:auto;max-width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;} @media (max-width:1300px){.iKTLAq{padding:0 20px;}}
/* sc-component-id: post__BioWrapper-h8gzap-13 */
.gTfYTh{width:50%;margin:auto;} @media (max-width:576px){.gTfYTh{width:100%;}}
/* sc-component-id: post__ToggleTocButton-h8gzap-14 */
.GDWrm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:fixed;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;right:20px;bottom:20px;border-radius:100%;box-shadow:0 0 3px rgba(0,0,0,.03),0 3px 46px rgba(0,0,0,.1);border:0;z-index:5000;width:50px;height:50px;background-color:#20232a;color:#fff;outline:none;} @media (min-width:1300px){.GDWrm{display:none;}}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=72e8008a1ad86357775e2878c278a5b7" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#a4cbb8"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=72e8008a1ad86357775e2878c278a5b7"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=72e8008a1ad86357775e2878c278a5b7"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=72e8008a1ad86357775e2878c278a5b7"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=72e8008a1ad86357775e2878c278a5b7"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=72e8008a1ad86357775e2878c278a5b7"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=72e8008a1ad86357775e2878c278a5b7"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=72e8008a1ad86357775e2878c278a5b7"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=72e8008a1ad86357775e2878c278a5b7"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-7e670d5ffa1abcedb118.js"/><link as="script" rel="preload" href="/framework-5dc1caea2c5fd4bcd10a.js"/><link as="script" rel="preload" href="/app-6124a287738eddf542a4.js"/><link as="script" rel="preload" href="/styles-7d4153d260c0197f0043.js"/><link as="script" rel="preload" href="/fa5f8105-689aa33d25e6e356ccaa.js"/><link as="script" rel="preload" href="/commons-163e26c0e5bce56e925e.js"/><link as="script" rel="preload" href="/component---theme-src-templates-post-tsx-5ceb473ccfd9d725e5c8.js"/><link as="fetch" rel="preload" href="/page-data/k8s-port/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1116962356.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2275848304.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3097946992.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3138592700.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3462520645.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="style__NavContainer-sc-1ck1w82-0 bzOPpS"><div class="common__Container-sc-1d5kp8-0 style__Nav-sc-1ck1w82-1 kHKWRw"><a class="logo__HomeLink-sc-1eqkae8-1 fOuWxu" href="/"><div class="logo__LogoImage-sc-1eqkae8-0 biTeGs gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:30px;height:30px"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAMEBQL/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQP/2gAMAwEAAhADEAAAAeY5rjFYKVdEzeaKf//EABwQAAICAgMAAAAAAAAAAAAAAAEDAAIREjEzQf/aAAgBAQABBQJg0qu24mRaBa9ciU59b2//xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQMBAT8BI3//xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQIBAT8BZ3//xAAZEAADAAMAAAAAAAAAAAAAAAAAARECEDH/2gAIAQEABj8CvSyaj4xYraMj/8QAHRABAAICAgMAAAAAAAAAAAAAAQARIVExQWFx8P/aAAgBAQABPyG2OBqedFQ4gW7ZAWImBlbS5IcnuH36jqjc/9oADAMBAAIAAwAAABCvB4P/xAAZEQEAAgMAAAAAAAAAAAAAAAABADEQESH/2gAIAQMBAT8Q0TmBUbn/xAAXEQEAAwAAAAAAAAAAAAAAAAARABAh/9oACAECAQE/EG7Bf//EABwQAQADAAIDAAAAAAAAAAAAAAEAESEQYTFB0f/aAAgBAQABPxAqOffZYytIw4Bb3AVSEpAyy33sWjiIncLHitjrt+op/Dc//9k=" alt="pipihua&#x27;s blog" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/72e8008a1ad86357775e2878c278a5b7/58a4b/profile-pic.jpg 1x,
/static/72e8008a1ad86357775e2878c278a5b7/f8771/profile-pic.jpg 1.5x,
/static/72e8008a1ad86357775e2878c278a5b7/56ed0/profile-pic.jpg 2x" /><img loading="lazy" width="30" height="30" srcset="/static/72e8008a1ad86357775e2878c278a5b7/58a4b/profile-pic.jpg 1x,
/static/72e8008a1ad86357775e2878c278a5b7/f8771/profile-pic.jpg 1.5x,
/static/72e8008a1ad86357775e2878c278a5b7/56ed0/profile-pic.jpg 2x" src="/static/72e8008a1ad86357775e2878c278a5b7/58a4b/profile-pic.jpg" alt="pipihua's blog" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></a><div class="style__NavWrapper-sc-1ck1w82-2 jLOYBk"><ul class="style__NavMenu-sc-1ck1w82-3 fVqyTA"><li class="style__NavMenuItem-sc-1ck1w82-4 gWrDHi"><a class="style__NavLink-sc-1ck1w82-5 MQpwo" href="/">Home</a></li></ul><div class="style__SearchContainer-sc-1ck1w82-6 llwmof"><ul class="style__NavMenu-sc-1ck1w82-3 cROOCp"><li class="style__NavMenuItem-sc-1ck1w82-4 gWrDHi"><button role="button" aria-label="Toggle search" class="style__ToggleSearchButton-sc-1ck1w82-7 fYiJFa"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg></button></li></ul></div></div></div></div><main><div style="width:0%" class="reading-progress__ReadingProgressBar-vxjjnv-0 iRZLqu"></div><div class="common__Container-sc-1d5kp8-0 post__PostContainer-h8gzap-0 jZNSfz"><div class="post__LeftSidebar-h8gzap-1 hRYAD"><div class="post__TocWrapper-h8gzap-3 faXnX"><nav class="toc__StyledNav-sc-1hwup8p-0 lhFcmu toc"></nav></div></div><button role="button" aria-label="Toggle table of contents" class="post__ToggleTocButton-h8gzap-14 GDWrm"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-128H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path></svg></button><div class="post__PostContent-h8gzap-2 fTdjuL"><article class="post"><header class="post__PostHeader-h8gzap-4 bXjWFc"><section class="post__PostMeta-h8gzap-7 iHPqjx"><a href="/tag/devops">Devops</a><time dateTime="2021-04-27 18:22">27 April, 2021</time></section><h1 class="post__PostTitle-h8gzap-8 jtkVLk">k8s修改外部访问端口</h1></header><div class="post__FeaturedImage-h8gzap-5 jqyLKa gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:56.5%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDBAX/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAGTcl6zqZAf/8QAGhAAAgIDAAAAAAAAAAAAAAAAAAECAwQRQf/aAAgBAQABBQKtVEo441XtM4z/xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8BkY//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAABBQAAAAAAAAAAAAAAAAAAASAiMTL/2gAIAQEABj8CkWppn//EABoQAQEAAgMAAAAAAAAAAAAAAAEAETEhUZH/2gAIAQEAAT8hUZHjc7B2ucncrd7/2gAMAwEAAgADAAAAEJgP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxCGQVH/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAECAQE/EGtpT//EABsQAQADAQADAAAAAAAAAAAAAAEAESExUWGB/9oACAEBAAE/EKUarmkWWka1z5BIQHqZ9RCFeTGfE//Z" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/f05eb1861e4384ccd1f4478fe0de1a22/8850c/image.jpg 200w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/da113/image.jpg 400w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/f2cbb/image.jpg 800w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/c26c2/image.jpg 1200w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/9352a/image.jpg 1600w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/4fb49/image.jpg 1920w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="/static/f05eb1861e4384ccd1f4478fe0de1a22/8850c/image.jpg 200w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/da113/image.jpg 400w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/f2cbb/image.jpg 800w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/c26c2/image.jpg 1200w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/9352a/image.jpg 1600w,
/static/f05eb1861e4384ccd1f4478fe0de1a22/4fb49/image.jpg 1920w" src="/static/f05eb1861e4384ccd1f4478fe0de1a22/f2cbb/image.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><section class="post__StyledPost-h8gzap-6 cCerLd post"><h2 id="service-的-ports-字段解惑" style="position:relative;"><a href="#service-%E7%9A%84-ports-%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%83%91" aria-label="service 的 ports 字段解惑 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Service 的 ports 字段解惑</h2>
<ul>
<li>port: service 暴露在 cluster ip 上的端口，通过<code class="language-text">&lt;cluster ip&gt;:port</code> 访问服务,通过此端口集群内的服务可以相互访问</li>
<li>targetPort: Pod 的外部访问端口，port 和 nodePort 的数据通过这个端口进入到 Pod 内部，Pod 里面的 containers 的端口映射到这个端口，提供服务(需要与制作容器时暴露的端口一致,与 DockerFile 中的 <code class="language-text">EXPOSE</code> 对应)</li>
<li>nodePort: Node 节点的端口，<code class="language-text">&lt;nodeIP&gt;:nodePort</code> 是提供给集群外部客户访问 service 的入口</li>
</ul>
<h2 id="deployment-的-ports-字段解惑" style="position:relative;"><a href="#deployment-%E7%9A%84-ports-%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%83%91" aria-label="deployment 的 ports 字段解惑 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment 的 ports 字段解惑</h2>
<ul>
<li>containerPort: 这里 containerPort 是容器内部的 port</li>
<li>
<p>hostPort: 相当于 docker 的-p 参数，映射容器端口到宿主机的端口</p>
<blockquote>
<p>但这样做有个缺点，因为 Pod 重新调度的时候该 Pod 被调度到的宿主机可能会变动，这样就变化了，用户必须自己维护一个 Pod 与所在宿主机的对应关系。
使用了 hostPort 的容器只能调度到端口不冲突的 Node 上，除非有必要（比如运行一些系统级的 daemon 服务），不建议使用端口映射功能。如果需要对外暴露服务，建议使用 NodePort Service。</p>
</blockquote>
</li>
</ul>
<h2 id="示例" style="position:relative;"><a href="#%E7%A4%BA%E4%BE%8B" aria-label="示例 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h2>
<blockquote>
<p>如果想把 nginx 容器的 80 端口映射到宿主机上的 1000 端口，则只要修改 service.yml 文件如下</p>
</blockquote>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">spec:
type: NodePort
ports:
    port: 80
    targetPort: 80
    nodePort: 1000</code></pre></div>
<h2 id="总结" style="position:relative;"><a href="#%E6%80%BB%E7%BB%93" aria-label="总结 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<blockquote>
<p>总结 Service,Service 的端口服务会覆盖 Deployment</p>
</blockquote>
<p>总的来说，<code class="language-text">port</code> 和 <code class="language-text">nodePort</code> 都是 service 的端口，前者暴露给 k8s 集群内部服务访问，后者暴露给 k8s 集群外部流量访问。从上两个端口过来的数据都需要经过反向代理 <code class="language-text">kube-proxy</code>，流入后端 pod 的 <code class="language-text">targetPort</code> 上，最后到达 pod 内的容器。</p></section><footer class="post__PostFooter-h8gzap-9 bVnRow"><p>Published under <span><a class="post__FooterTagLink-h8gzap-10 jqxPBx" href="/tag/devops">Devops</a></span> on <time dateTime="2021-04-27 18:22">27 April, 2021</time>.</p></footer></article></div></div><section class="post__PostAddition-h8gzap-11 bYZhdV"><div class="common__Container-sc-1d5kp8-0 post__PostAdditionContent-h8gzap-12 iKTLAq"><div class="post__BioWrapper-h8gzap-13 gTfYTh"><section class="bio__StyledBio-sc-19adui4-0 iHGPyz"><div class="avatar__StyledAvatar-sc-1v6bq9n-0 kXzLbm gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:55px;height:55px"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAMEBQL/xAAWAQEBAQAAAAAAAAAAAAAAAAACAQP/2gAMAwEAAhADEAAAAeY5rjFYKVdEzeaKf//EABwQAAICAgMAAAAAAAAAAAAAAAEDAAIREjEzQf/aAAgBAQABBQJg0qu24mRaBa9ciU59b2//xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQMBAT8BI3//xAAWEQEBAQAAAAAAAAAAAAAAAAARABD/2gAIAQIBAT8BZ3//xAAZEAADAAMAAAAAAAAAAAAAAAAAARECEDH/2gAIAQEABj8CvSyaj4xYraMj/8QAHRABAAICAgMAAAAAAAAAAAAAAQARIVExQWFx8P/aAAgBAQABPyG2OBqedFQ4gW7ZAWImBlbS5IcnuH36jqjc/9oADAMBAAIAAwAAABCvB4P/xAAZEQEAAgMAAAAAAAAAAAAAAAABADEQESH/2gAIAQMBAT8Q0TmBUbn/xAAXEQEAAwAAAAAAAAAAAAAAAAARABAh/9oACAECAQE/EG7Bf//EABwQAQADAAIDAAAAAAAAAAAAAAEAESEQYTFB0f/aAAgBAQABPxAqOffZYytIw4Bb3AVSEpAyy33sWjiIncLHitjrt+op/Dc//9k=" alt="pipihua" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/72e8008a1ad86357775e2878c278a5b7/36742/profile-pic.jpg 1x,
/static/72e8008a1ad86357775e2878c278a5b7/aa6d7/profile-pic.jpg 1.5x,
/static/72e8008a1ad86357775e2878c278a5b7/05b67/profile-pic.jpg 2x" /><img loading="lazy" width="55" height="55" srcset="/static/72e8008a1ad86357775e2878c278a5b7/36742/profile-pic.jpg 1x,
/static/72e8008a1ad86357775e2878c278a5b7/aa6d7/profile-pic.jpg 1.5x,
/static/72e8008a1ad86357775e2878c278a5b7/05b67/profile-pic.jpg 2x" src="/static/72e8008a1ad86357775e2878c278a5b7/36742/profile-pic.jpg" alt="pipihua" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><h3 class="bio__AuthorName-sc-19adui4-2 lfACiL">pipihua</h3><p class="bio__AuthorDescription-sc-19adui4-1 lbetsi">I'm <strong>pipihua</strong>, The best way to deal with anxiety is to get started right now.
        If you like what you see feel free to give a 
        <a href="https://github.com/pipihua666" rel="noopener" target="_blank">star on GitHub!</a></p><div>Friend:<a href="https://www.cnblogs.com/yahuian/" target="_blank" rel="noopener" class="bio__FriendLink-sc-19adui4-3 OjwYO">Golang-就学45分钟</a></div></section></div></div></section></main><footer class="style__StyledFooter-sc-1oqvjzu-0 gpDhwt"><div class="common__Container-sc-1d5kp8-0 style__FooterContainer-sc-1oqvjzu-1 ctpkkx"><div><p class="style__Copyright-sc-1oqvjzu-2 cXOFUh"><strong>pipihua&#x27;s blog</strong> © <!-- -->2021</p><p class="style__DesignBy-sc-1oqvjzu-3 bqPxdl">Theme by<!-- --> <a href="https://nehalist.io" target="_blank" rel="noopener">nehalist.io</a></p></div></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/k8s-port";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-25cf05b7fad03f114865.js"],"app":["/app-6124a287738eddf542a4.js"],"component---theme-src-pages-404-tsx":["/component---theme-src-pages-404-tsx-8164ccd1f47bf761fa52.js"],"component---theme-src-pages-archive-tsx":["/component---theme-src-pages-archive-tsx-bea44c6f4fba5c2e6e3a.js"],"component---theme-src-pages-tags-tsx":["/component---theme-src-pages-tags-tsx-43a7c6667512c3c1c411.js"],"component---theme-src-templates-page-tsx":["/component---theme-src-templates-page-tsx-d8ba7e74bef2b20f7182.js"],"component---theme-src-templates-post-tsx":["/component---theme-src-templates-post-tsx-5ceb473ccfd9d725e5c8.js"],"component---theme-src-templates-posts-tsx":["/component---theme-src-templates-posts-tsx-0544cd22590f1126a144.js"],"component---theme-src-templates-tag-tsx":["/component---theme-src-templates-tag-tsx-538acdd95d17278693dd.js"]};/*]]>*/</script><script src="/polyfill-25cf05b7fad03f114865.js" nomodule=""></script><script src="/component---theme-src-templates-post-tsx-5ceb473ccfd9d725e5c8.js" async=""></script><script src="/commons-163e26c0e5bce56e925e.js" async=""></script><script src="/fa5f8105-689aa33d25e6e356ccaa.js" async=""></script><script src="/styles-7d4153d260c0197f0043.js" async=""></script><script src="/app-6124a287738eddf542a4.js" async=""></script><script src="/framework-5dc1caea2c5fd4bcd10a.js" async=""></script><script src="/webpack-runtime-7e670d5ffa1abcedb118.js" async=""></script></body></html>