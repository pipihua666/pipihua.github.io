{"componentChunkName":"component---theme-src-templates-post-tsx","path":"/nginx-hooks4","result":{"data":{"post":{"id":"3c1c5d98-03b7-531c-8407-f014a30fb580","headings":[{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":2}],"frontmatter":{"title":"Hooks核心04","path":"/nginx-hooks4","tags":["React"],"excerpt":"进一步认识Hooks：如果正确理解函数组件的生命周期","created":"2021-06-08 23:27","createdPretty":"08 June, 2021","updated":"2021-06-08 23:27","updatedPretty":"08 June, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABjmW2iseN/8QAGRABAQEBAQEAAAAAAAAAAAAAAQIDAAQU/9oACAEBAAEFAoyaDOmjxapWtvG9yfVff//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAcEAACAQUBAAAAAAAAAAAAAAAAARESIUFCgeH/2gAIAQEABj8CuUpSzVdIk8MH/8QAGhABAAIDAQAAAAAAAAAAAAAAAQARIUFxUf/aAAgBAQABPyFmChJZn4kuDwYpsPMSoCHBKtKf/9oADAMBAAIAAwAAABCoD//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EIf/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPxAp/8QAHhABAQABBAMBAAAAAAAAAAAAAREAMUFRkSFxgaH/2gAIAQEAAT8QQQoV2ySO1Gz3xgBVeUnQ4WsjSY+85M+DzFfzAALDdJes/9k=","aspectRatio":1.4388489208633093,"src":"/static/d5b9838617fd49995727c5592f50b92b/f2cbb/header.jpg","srcSet":"/static/d5b9838617fd49995727c5592f50b92b/8850c/header.jpg 200w,\n/static/d5b9838617fd49995727c5592f50b92b/da113/header.jpg 400w,\n/static/d5b9838617fd49995727c5592f50b92b/f2cbb/header.jpg 800w,\n/static/d5b9838617fd49995727c5592f50b92b/c26c2/header.jpg 1200w,\n/static/d5b9838617fd49995727c5592f50b92b/9352a/header.jpg 1600w,\n/static/d5b9838617fd49995727c5592f50b92b/4fb49/header.jpg 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"忘掉-class-组件的声明周期\" style=\"position:relative;\"><a href=\"#%E5%BF%98%E6%8E%89-class-%E7%BB%84%E4%BB%B6%E7%9A%84%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F\" aria-label=\"忘掉 class 组件的声明周期 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>忘掉 class 组件的声明周期</h2>\n<blockquote>\n<p>在函数组件中你要思考的方式永远是:<b>当某个状态发生变化时，我要做什么</b>，而不再是在 class 组件中的某个生命周期方法中我要做什么。</p>\n</blockquote>\n<h2 id=\"重新思考组件的生命周期\" style=\"position:relative;\"><a href=\"#%E9%87%8D%E6%96%B0%E6%80%9D%E8%80%83%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F\" aria-label=\"重新思考组件的生命周期 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>重新思考组件的生命周期</h2>\n<h3 id=\"构造函数\" style=\"position:relative;\"><a href=\"#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0\" aria-label=\"构造函数 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>构造函数</h3>\n<blockquote>\n<p>在 class 中有个方法叫<code class=\"language-text\">constructor</code>，也就是构造函数，在里面我们会做一些初始化的事情，其实就是<b>在其他代码执行之前的一次性初始工作</b>。</p>\n</blockquote>\n<p>我们可以在函数组件中使用<code class=\"language-text\">useRef</code>来实现一个 useSinleton 这样的一次性执行某段代码的自定义 hook，代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">useSinleton</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 使用called ref来标记callback是否被执行过</span>\n  <span class=\"token keyword\">const</span> called <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 如果执行过，则直接返回</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>called<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n  <span class=\"token comment\">// 第一次调用直接执行</span>\n  <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 标记执行过</span>\n  called<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>那么我们就可以这样去使用：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> useSinleton <span class=\"token keyword\">from</span> <span class=\"token string\">'./useSinleton'</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-variable function\">Mydemo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 使用自定义hook</span>\n    <span class=\"token function\">useSinleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"这段代码只执行一次！\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">My demo</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"三种常用的生命周期方法\" style=\"position:relative;\"><a href=\"#%E4%B8%89%E7%A7%8D%E5%B8%B8%E7%94%A8%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%96%B9%E6%B3%95\" aria-label=\"三种常用的生命周期方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>三种常用的生命周期方法</h3>\n<blockquote>\n<ul>\n<li>在类组件中,<code class=\"language-text\">componentDidMount</code>,<code class=\"language-text\">componentWillUnmout</code>,<code class=\"language-text\">componentDidUpdate</code>最为常用<br></li>\n<li>在函数组件中，这三者可以统一到 useEffect 这个 hook,正如 useEffect 这个字面函数，其作用就是触发副作用，即在组件每次 render 之后去执行。</li>\n</ul>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 等价componentDidMount,componentDidUpdate</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 等价componentWillUnmout</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>deps<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><b>可以看到,useEffect 接收的 callback 参数，可以返回一个用于清理资源的函数，从而在下一次同样的 useEffect 被执行之前被调用</b></p>\n<ol>\n<li>useEffect(callback)，这个 hook 接收 callback，只有在依赖项发生变化时才被执行。而 <code class=\"language-text\">componentDidUpdate</code> 则一定会执行。</li>\n<li>callback 返回的函数（一般用于清理工作）在下一次依赖项发生变化时以及组件销毁<b>「之前」</b>执行，而 <code class=\"language-text\">componentWillUnmout</code> 只有在组件销毁时执行。</li>\n</ol>\n<h2 id=\"思考：useeffect-如果实现只有在组件销毁时或组件挂载完成时才执行\" style=\"position:relative;\"><a href=\"#%E6%80%9D%E8%80%83%EF%BC%9Auseeffect-%E5%A6%82%E6%9E%9C%E5%AE%9E%E7%8E%B0%E5%8F%AA%E6%9C%89%E5%9C%A8%E7%BB%84%E4%BB%B6%E9%94%80%E6%AF%81%E6%97%B6%E6%88%96%E7%BB%84%E4%BB%B6%E6%8C%82%E8%BD%BD%E5%AE%8C%E6%88%90%E6%97%B6%E6%89%8D%E6%89%A7%E8%A1%8C\" aria-label=\"思考：useeffect 如果实现只有在组件销毁时或组件挂载完成时才执行 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>思考：useEffect 如果实现只有在组件销毁时或组件挂载完成时才执行?</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 关键是依赖项是空数组,表示render完后只执行一次</span>\n<span class=\"token comment\">// 如果有依赖项，则在render后依赖项变化，再去执行return的销毁函数，然后是callback函数</span></code></pre></div>"},"primaryTag":{"name":"React","color":null}},"pageContext":{"postId":"3c1c5d98-03b7-531c-8407-f014a30fb580","primaryTag":"React"}},"staticQueryHashes":["1116962356","2275848304","3097946992","3138592700","3462520645"]}