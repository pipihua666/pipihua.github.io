{"componentChunkName":"component---src-templates-blog-post-js","path":"/react-code-spliting/","result":{"data":{"site":{"siteMetadata":{"title":"皮皮花的博客"}},"markdownRemark":{"id":"f52ff944-a5e9-5a03-afbb-ce22971e1394","excerpt":"引言 衡量网站的性能的指标有很多，其中有项重要的指标就是网站的首屏时间，而代码分割却是优化首屏时间最通用的方法 三种通用的代码拆分方法（基于 webpack） 入口点：使用配置手动拆分代码 防止重复：使用重复数据删除和拆分块 动态导入：通过模块内的内联函数调用拆分代码 动态导入（react-loadable…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 308px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.16455696202532%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABAv/EABYBAQEBAAAAAAAAAAAAAAAAAAIBA//aAAwDAQACEAMQAAABNwHFm6HR/wD/xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIREP/aAAgBAQABBQKqkbx7I+//xAAWEQADAAAAAAAAAAAAAAAAAAAAARP/2gAIAQMBAT8BkiaP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABIB/9oACAECAQE/AbVr/8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEgITH/2gAIAQEABj8Cpmx//8QAFxABAQEBAAAAAAAAAAAAAAAAAQARYf/aAAgBAQABPyHAYx5MO0mFtv/aAAwDAQACAAMAAAAQw8//xAAWEQEBAQAAAAAAAAAAAAAAAAABEDH/2gAIAQMBAT8QCdh//8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/EBZL/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBUXH/2gAIAQEAAT8QGFxzcgCzfTFloH5FLrPQwVcz/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"react.jpeg\"\n        title=\"react.jpeg\"\n        src=\"/static/5d305fe6bd8b15bed34145006896fc8f/3a5b9/image.jpg\"\n        srcset=\"/static/5d305fe6bd8b15bed34145006896fc8f/ff44c/image.jpg 158w,\n/static/5d305fe6bd8b15bed34145006896fc8f/3a5b9/image.jpg 308w\"\n        sizes=\"(max-width: 308px) 100vw, 308px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<blockquote>\n<p>引言</p>\n</blockquote>\n<p>衡量网站的性能的指标有很多，其中有项重要的指标就是网站的首屏时间，而代码分割却是优化首屏时间最通用的方法</p>\n<blockquote>\n<p>三种通用的代码拆分方法（基于 webpack）</p>\n</blockquote>\n<ol>\n<li>入口点：使用<a href=\"https://webpack.js.org/configuration/entry-context\"><code class=\"language-text\">entry</code></a>配置手动拆分代码</li>\n<li>防止重复：使用<a href=\"https://webpack.js.org/plugins/split-chunks-plugin/\"><code class=\"language-text\">SplitChunksPlugin</code></a>重复数据删除和拆分块</li>\n<li>动态导入：通过模块内的内联函数调用拆分代码</li>\n</ol>\n<br />\n<a name=\"J0hBy\"></a>\n<h4>动态导入（<strong>react-loadable</strong>）有以下概念</h4>\n<blockquote>\n<ol>\n<li>动态导入的组件自动进行性能优异的代码分割</li>\n<li><strong>所支持的是组件的动态导入，而不是路由的动态导入</strong></li>\n<li>基本思想是组件的按需加载</li>\n<li>注意：要在 react 中使用 import()，需要安装@babel/plugin-syntax-dynamic-import 插件，并在 babel 配置中引入</li>\n<li>注意：import 的路径是相对路径，不能添加绝对路径</li>\n<li>注意：要使用魔法注释需要配置（webpack 的 SplitChunkPlugin 插件，webpack 默认已配置，开箱即用）</li>\n<li>react 中的动态导入还有：react 原生 React.lazy（v16.6），原生 Suspense，库 Loadable Component</li>\n</ol>\n</blockquote>\n<p><a name=\"xRYgO\"></a></p>\n<h4>配合 react-router-dom 实现 react 的路由组件按需加载</h4>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> Loadable <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-loadable\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 懒加载路由</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AsyncComponent</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">component</span> <span class=\"token operator\">=></span>\n  <span class=\"token function\">Loadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    loader<span class=\"token operator\">:</span> lazyLoad<span class=\"token punctuation\">[</span>component<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 加载promise来加载组件</span>\n    loading<span class=\"token operator\">:</span> MyLoadingComponent<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 当加载进行中或者错误时加载的组件</span>\n    delay<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 加载loading组件之前的延迟，防止闪屏</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> lazyLoad <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">home</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token comment\">// webpackChunkName（代码分割后的代码块名）</span>\n  \t<span class=\"token comment\">// 添加webpackPrefetch：（未来可能需要的资源）</span>\n  \t<span class=\"token comment\">//   这将导致将&lt;link rel=\"prefetch\" href=\"home.js\">其附加在页面的开头</span>\n    <span class=\"token comment\">//   这将指示浏览器在空闲时间预取home.js文件</span>\n    <span class=\"token comment\">// 不配置预加载和预取提取则按需加载</span>\n    <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"home\" */</span> <span class=\"token comment\">/* webpackPrefetch: true */</span> <span class=\"token string\">'./home'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">detail</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  \t<span class=\"token comment\">// webpackPreload（当前导航期间可能需要的资源）</span>\n    <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"detail\" /* webpackPreload: true */</span>  <span class=\"token operator\">*</span><span class=\"token operator\">/</span> <span class=\"token string\">'./detail'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Switch</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/app/home<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">AsyncComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"home\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/app/detail<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">AsyncComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"detail\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Switch</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<blockquote>\n<p>官网</p>\n</blockquote>\n<ul>\n<li><a href=\"https://webpack.js.org/guides/code-splitting/\">webpack 代码分割官网</a></li>\n<li><a href=\"https://github.com/jamiebuilds/react-loadable#preloading\">react-loadable 仓库</a></li>\n<li><a href=\"https://webpack.js.org/api/module-methods/#import-1\">import()文档</a></li>\n<li><a href=\"https://zh-hans.reactjs.org/docs/code-splitting.html\">react 的 lazy 代码分割</a></li>\n</ul>","frontmatter":{"title":"react性能优化之代码分割","date":"February 20, 2021","description":"react性能优化之代码分割动态导入"}},"previous":{"fields":{"slug":"/react-deployment/"},"frontmatter":{"title":"nginx 部署 react 项目"}},"next":{"fields":{"slug":"/nginx/"},"frontmatter":{"title":"深入浅出nginx"}}},"pageContext":{"id":"f52ff944-a5e9-5a03-afbb-ce22971e1394","previousPostId":"ff763373-5335-5bcf-b830-05af62c56ee9","nextPostId":"091d4c4b-48b4-5dc6-93d1-8ae00f47bf8c"}},"staticQueryHashes":["2841359383","3122794013"]}