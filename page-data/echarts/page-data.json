{"componentChunkName":"component---src-templates-blog-post-js","path":"/echarts/","result":{"data":{"site":{"siteMetadata":{"title":"皮皮花的博客"}},"markdownRemark":{"id":"4098f454-5f5e-57a6-9999-258feacd5be9","excerpt":"前言 作为一个今年刚毕业的弟弟来说，刚接到这个需求真是又兴奋，又紧张。\n兴奋的是可视化是我觉得非常炫酷的一个功能，做好的一定会很有成就感，\n紧张的是组内只有我一个前端，而且还是一个刚毕业的弟中弟，有很多还需要请教大佬才知道的。\n不管了，冲就完事了！萨斯给！\n可视化技术栈：react，echarts，react-for…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAciUTlDCi//EABkQAAEFAAAAAAAAAAAAAAAAAAEAAhARMf/aAAgBAQABBQINFI7P/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAQUBAAAAAAAAAAAAAAAAAQARICIxMv/aAAgBAQAGPwIXGOuo/wD/xAAbEAACAgMBAAAAAAAAAAAAAAAAAREhEDFRYf/aAAgBAQABPyF5ltng0uCsJnL2f//aAAwDAQACAAMAAAAQ3w//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QTZv/xAAXEQADAQAAAAAAAAAAAAAAAAABEBEh/9oACAECAQE/EJpX/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARQSExcdH/2gAIAQEAAT8QABcI6M9+QI09AlGxXDg0h1MnZP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dandelion-2817950_1280.jpg\"\n        title=\"dandelion-2817950_1280.jpg\"\n        src=\"/static/b57b22b6622b0c15a7547a6516702a5b/828fb/echarts.jpg\"\n        srcset=\"/static/b57b22b6622b0c15a7547a6516702a5b/ff44c/echarts.jpg 158w,\n/static/b57b22b6622b0c15a7547a6516702a5b/a6688/echarts.jpg 315w,\n/static/b57b22b6622b0c15a7547a6516702a5b/828fb/echarts.jpg 630w,\n/static/b57b22b6622b0c15a7547a6516702a5b/0ede0/echarts.jpg 945w,\n/static/b57b22b6622b0c15a7547a6516702a5b/3ac88/echarts.jpg 1260w,\n/static/b57b22b6622b0c15a7547a6516702a5b/eea4a/echarts.jpg 1280w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span>\n<a name=\"VmEzg\"></a></p>\n<h4>前言</h4>\n<blockquote>\n<p>作为一个今年刚毕业的弟弟来说，刚接到这个需求真是又兴奋，又紧张。\n兴奋的是可视化是我觉得非常炫酷的一个功能，做好的一定会很有成就感，\n紧张的是组内只有我一个前端，而且还是一个刚毕业的弟中弟，有很多还需要请教大佬才知道的。\n不管了，冲就完事了！萨斯给！\n可视化技术栈：react，echarts，react-for-echarts，sass</p>\n</blockquote>\n<p><a name=\"3gFyR\"></a></p>\n<h4>布局（这里采用的是我在实际项目中的配置）</h4>\n<hr>\n<ol>\n<li>设置项目的最小宽度 min-width,确保项目不会过于小导致布局混乱</li>\n<li>横向自适应宽度：采用 ant-design 的栅栏布局</li>\n<li>\n<p>纵向自适应高度，我一开始采用的是 rem 的适应方案，可是发现有如下问题</p>\n<ul>\n<li>rem 方案使用的是<a href=\"https://www.njleonzhang.com/2018/08/15/flexible-pc-full-screen.html\">这篇文章的方案</a>，大家可以看看工程运用那里，我关于 rem 的计算方案并不是采用的该文章的方法，如果你使用的是 vscode，那有款 cssrem 的插件很适合你</li>\n<li>会修改根元素的 font-size，容易导致项目的其他页面字体大小有问题（可通过修改 document.body.fontSize 来解决）</li>\n<li>如果放在大屏上，比如分辨率为 1920*1080 以上，屏幕下方会留白（对 rem 方案的不熟练）</li>\n</ul>\n</li>\n<li>于是，我采用的是 vh 的方案，查看<a href=\"https://caniuse.com/?search=vh\">caniuse</a>，发现兼容性还不错</li>\n</ol>\n<p><a name=\"IF4ph\"></a></p>\n<h4>可视化组件的背景图片</h4>\n<hr>\n<p><br />svg 作为背景图片带来的坑：<br />一开始 ued 给我的切的 svg，也没做过可视化，不太懂，也是欣然接受并使用的 svg 作为背景图片，可是发现调整屏幕的分辨率，组件自适应了，但是背景图却有问题，<b>高度和宽度一致是按照一定比例来缩放的。后来发现原来这是 svg 的特性，怪不得很适合用来做 icon。</b><br /><br />于是我使用了<a href=\"https://cloudconvert.com/svg-to-png\">svg-to-png</a>，采用 png 来设置背景图片，并通过调整 css 来实现背景图片覆盖整个组件。</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@mixin</span> <span class=\"token function\">background</span><span class=\"token punctuation\">(</span>$urlImg<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>$urlImg<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 100% 100%<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"z2ibq\"></a></p>\n<h4>世界地图并实现地图下钻</h4>\n<hr>\n<ol>\n<li>\n<p>首先得把世界地图和各个国家的地图找到，这是一个很庞大的工作。而且以前的地图和现在的地图并非一致，请合理使用（毕竟地球的板块是在不断的运动中的）。</p>\n<ul>\n<li><a href=\"http://datav.aliyun.com/tools/atlas/#&#x26;lat=30.332329214580188&#x26;lng=106.72278672066881&#x26;zoom=3.5\">中国->国、省、市地图 Json</a>（由于有 datav 官方维护，地图数据新）</li>\n<li><a href=\"https://hxkj.vip/demo/echartsMap/\">中国->省、市、区/县地图 Json</a>（地图数据新）</li>\n<li><a href=\"https://github.com/pissang/starbucks/tree/gh-pages/json\">世界->各个国家的地图 Json（包括世界地图）</a>(地图数据旧)</li>\n<li><a href=\"https://geojson-maps.ash.ms/\">世界->各个国家的地图 Json（不包括世界地图）</a>（地图数据较新）</li>\n<li><a href=\"https://img.hcharts.cn/mapdata/\">全世界地图数据集</a>（只更新到了 2015 年的数据）</li>\n<li><a href=\"http://geojson.io/#map=2/20.0/0.0\">当你找到 json 的地图，放上来看看是否一致</a>（权威地图，地图数据新）</li>\n<li>如果不懂 geoJson 规范，可看<a href=\"https://www.oschina.net/translate/geojson-spec\">GeoJSON 格式规范说明</a></li>\n</ul>\n</li>\n<li>找到了地图 json，下钻实现</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 获取地图json注册地图</span>\n<span class=\"token comment\">// map为json所对应的名称（比如：世界地图为world,中国地图为China）</span>\n<span class=\"token function-variable function\">registerMap</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">map</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 由于json是存在静态资源中的</span>\n  <span class=\"token keyword\">const</span> path_env <span class=\"token operator\">=</span>\n    process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"development\"</span>\n      <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/public/json/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>map<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.json</span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/assets/public/json/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>map<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.json</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span>path_env<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      echarts<span class=\"token punctuation\">.</span><span class=\"token function\">registerMap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"world\"</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 使用的是echarts-for-react，this.echartsReact获取到的是该图表实例</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>echartsReact<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">\"restore\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"OmSJq\"></a></p>\n<h4>词云</h4>\n<blockquote>\n<p>我采用的库是<a href=\"https://github.com/mcc108/TagCloud#readme\">TagCloud</a>,同事推荐的一个小巧，可定制的库，挺好用的。</p>\n</blockquote>\n<p><a name=\"vtI9Q\"></a></p>\n<h4>自定义一个时钟</h4>\n<blockquote>\n<ol>\n<li>使用一个组件来显示时钟，保证时钟的渲染在该组件内进行，不影响其他组件</li>\n<li>字体样式采用免费可商用的<a href=\"https://www.uisdc.com/uisdc-first-free-font\">「优设标题黑」</a></li>\n</ol>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> PureComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> dayjs <span class=\"token keyword\">from</span> <span class=\"token string\">\"dayjs\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DataVisual</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PureComponent</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    time<span class=\"token operator\">:</span> <span class=\"token function\">dayjs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YYYY.MM.DD HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  timer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        time<span class=\"token operator\">:</span> <span class=\"token function\">dayjs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YYYY.MM.DD HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> display<span class=\"token operator\">:</span> <span class=\"token string\">\"inline-block\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"2QaXU\"></a></p>\n<h4>使用@font-face</h4>\n<blockquote>\n<p><a name=\"d41d8cd9\"></a></p>\n</blockquote>\n<h3></h3>\n<blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/@font-face\">MDN</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@font-face</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> electronicNumber<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">src</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font/DS-DIGI-1.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font//DS-DIGIB-2.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font//DS-DIGII-3.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font/DS-DIGIT-4.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.myFontFace</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> electronicNumber<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"suEmG\"></a></p>\n<h4>使用@media</h4>\n<blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media\">MDN</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@mixin</span> <span class=\"token function\">screenMedia</span><span class=\"token punctuation\">(</span>$fontSize<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n  // 如果小于1440px，则font-size生效\n  // <span class=\"token property\">同理min-width</span><span class=\"token punctuation\">:</span>1440px，如果大于1440px，则font-size生效\n  <span class=\"token atrule\"><span class=\"token rule\">@media</span> screen <span class=\"token keyword\">and</span> <span class=\"token punctuation\">(</span><span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> 1440px<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> $fontSize<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.mymMedia</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">screenMedia</span><span class=\"token punctuation\">(</span>20px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>最后</h4>\n<blockquote>\n<p>文章针对前端可视化的大屏展示，根据需求来完善文章，欢迎各位大佬评论哦。\n如果有需要修改文章的内容，我会改进。\n附上一张性能图片，小弟还没做过这方面的优化。\n<a href=\"https://juejin.im/post/6844903552070975495\">使用 chrome performance 查看页面性能</a> > <a href=\"https://web.dev/rail/#goals-and-guidelines\">著名的 RAIL model</a></p>\n</blockquote>","frontmatter":{"title":"前端大屏可视化","date":"February 20, 2021","description":"从0开始的基于echarts的可视化大屏开发"}},"previous":{"fields":{"slug":"/design-patterns/"},"frontmatter":{"title":"【前端必会】设计与模式"}},"next":{"fields":{"slug":"/element-a/"},"frontmatter":{"title":"通过a标签同源和跨域下载服务器文件"}}},"pageContext":{"id":"4098f454-5f5e-57a6-9999-258feacd5be9","previousPostId":"56d86820-34ca-5f2f-b97f-41d8534640d0","nextPostId":"12d315f9-126b-5663-a8bd-396d1e801619"}},"staticQueryHashes":["2841359383","3122794013"]}