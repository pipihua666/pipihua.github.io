{"componentChunkName":"component---src-templates-blog-post-js","path":"/http/","result":{"data":{"site":{"siteMetadata":{"title":"皮皮花的博客"}},"markdownRemark":{"id":"b20889ff-7b5e-5b9a-b6c2-f6c6b8dd3a19","excerpt":"首先让我们来了解一下 http 的请求报文和响应报文   再向您献上一张 http 请求的流程图   Redirect（资源重定向）的 HTTP 响应头部 Location:”（后面接跳转的 URI 路径） 通过 response.write(302,{ Location:‘/new’ })返回的 xhr.status…","html":"<p><a name=\"e970dab8\"></a></p>\n<h4>首先让我们来了解一下 http 的请求报文和响应报文</h4>\n<p><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/da49442a0e71569330996cf2fcde50c1/a7a19/http.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.848101265822784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVQY001PaY+DIBD1//+41iuKaxWwtYqAeIDnJu7b7pdNJpPhzbwDzy1u3dZlXcZp1L2a7bTtG5A/EIVhtjNWUknnrPsgwM1gvOM8dK+VVo8i94M740xIgcIp5HrTq141bRPHcckoaJAexgEdfG+apzAKSUYSkuBIdKKT3bt5+77/ql/Vk9/utyRN8kcOXV4xJOUVx8F+7B4EKKN4FGUhVQer8/uEQ5oSJIQJVq1opeyGwbjVXdeFD7RC/JIRm1cV45DllLGSUvSvPKeMf5gNpGGVEgJ1rXVvTEoy4CB61lkkH6cJ/f8wWzuMpn7XQRhGcRwEQRhFCfJkGf6vlIL0D9pJSG45vahuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"http\"\n        title=\"http\"\n        src=\"/static/da49442a0e71569330996cf2fcde50c1/f058b/http.png\"\n        srcset=\"/static/da49442a0e71569330996cf2fcde50c1/c26ae/http.png 158w,\n/static/da49442a0e71569330996cf2fcde50c1/6bdcf/http.png 315w,\n/static/da49442a0e71569330996cf2fcde50c1/f058b/http.png 630w,\n/static/da49442a0e71569330996cf2fcde50c1/40601/http.png 945w,\n/static/da49442a0e71569330996cf2fcde50c1/78612/http.png 1260w,\n/static/da49442a0e71569330996cf2fcde50c1/a7a19/http.png 1323w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /></p>\n<p><a name=\"c76a254f\"></a></p>\n<h4>再向您献上一张 http 请求的流程图</h4>\n<p><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/226664588d9551f1dce70bbfeb894e83/f8915/httpRequest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQY03VR2XKDMBDj/7+xnbZJmmDwAb69virDDE8po4H1SoLVMpVagNrqWxxs/Y+dpFIhhtYbcKpba+cR9cyYVPKUnoJLOcxCCutM710bbcwofPDLuu56LzXjzoWIKaLAW3pvZ6e2MezE5QakXJQ288pDTD5ExqX1IVHetNXOg4WGrYJKVbt5zgvIYWZc/b6WSFmo/ePrpl1wIf08XkpbF9P9yZ6Mg50XcXu8IpFQ2+f3TVs/zIlo5TxR6seFvBgbg+1a42isEUfmEbXhUXKhha/oozOBgPNaOFrDLIW2BhBSApRp7PLICWUk5Mjjy9caLzOWb60NMTrvjLUA5fz2L/4BgwvPrlvqCxAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"httpRequest\"\n        title=\"httpRequest\"\n        src=\"/static/226664588d9551f1dce70bbfeb894e83/f058b/httpRequest.png\"\n        srcset=\"/static/226664588d9551f1dce70bbfeb894e83/c26ae/httpRequest.png 158w,\n/static/226664588d9551f1dce70bbfeb894e83/6bdcf/httpRequest.png 315w,\n/static/226664588d9551f1dce70bbfeb894e83/f058b/httpRequest.png 630w,\n/static/226664588d9551f1dce70bbfeb894e83/f8915/httpRequest.png 748w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /></p>\n<p><a name=\"a8b0534a\"></a></p>\n<h4>Redirect（资源重定向）的 HTTP 响应头部</h4>\n<blockquote>\n<ul>\n<li>Location:”（后面接跳转的 URI 路径）</li>\n<li>通过 response.write(302,{ Location:‘/new’ })返回的 xhr.status>=300&#x26;&#x26;xhr.status&#x3C;400 才能进行重定向</li>\n</ul>\n</blockquote>\n<p><a name=\"94d0159f\"></a></p>\n<h4>Cache-Contorl 的含义和使用的 HTTP 响应头部</h4>\n<blockquote>\n<ul>\n<li>可缓存性：<br />|<strong>public</strong>|http 经过的地方都能够进行缓存  |<br />|<strong>private</strong>|只有发起请求的浏览器才能够进行缓存|<br />|<strong>no-cache</strong>|本地可以缓存，但是需要在服务端验证过后才能使用|</li>\n<li>到期：<br />|<strong>max-age=<second></strong>| 浏览器缓存多长时间到期 |<br />|<strong>s-maxage=<second></strong>|代理服务器缓存的到期时间|<br />|  <strong>max-stale=<second></strong>| 在 max-age 到期之后，在 max-stale 期限之内还是可以取缓存 |</li>\n<li>重新验证：（使用较少）<br />|<strong>must-revalidate</strong>|   在 max-age 过期之后必须到原服务端发起请求来验证此缓存是否过期了，而不能直接使用本地的缓存|<br />|<strong>proxy-revalidate</strong>|使用在缓存服务器，在缓存过期之后到原服务端请求验证缓存是否过期了，而不能直接使用本地的缓存|</li>\n<li>其他：<br />|<strong>no-store</strong>|本地和代理服务器都不能缓存，永远只能到服务端拿取新的内容才能使用|<br />|<strong>no-transform</strong>|指定代理服务器不能修改服务端返回的内容|</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>服务器缓存的验证更新机制：<br />| <strong>Last-Modified</strong> （上一次修改时间）| 在服务端返回 Last-Modified，浏览器在下一次请求的时候会带上<strong>If-Modified-Since</strong> 与服务器的 Last-Modified 对比，如果相等，那么资源没有被修改过，服务器则告诉浏览器直接使用缓存|<br />|<strong>Etag</strong>（数据签名：对静态资源进行 hash 计算的到唯一值的签名）|在服务器返回 Etag，浏览器在下一次请求的时候会带上<strong>If-None-Match</strong>与服务器的 Etag 进行对比，如果相等，那么资源没有被修改过，服务器告诉浏览器直接使用缓存|</li>\n</ul>\n</blockquote>\n<p><a name=\"5c13213b\"></a></p>\n<h4>CORS 跨域请求的 HTTP 响应头部</h4>\n<p><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/157a5c1636af09bd03e30e5838a11366/f8915/cors.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQoz5WR646EIAyFff9X1H8z3lEBQVDEmY+wO5lsZpNd0iic9rSnbXHGU69aSqm1DmeIV8QAV7OCZzvCkfEfViitRjFy5mXej/16XNnxeDsfmYlsN+u8U6ve3BZj/C3uM7kqS6lUVVbTNFEEwf8gG2v4LXL5K+27r6+eGQlkLn73rw5JysywnJ3UObvzlniaxZXIUsuu7/thABVCoB/fKIau6+q6xms2Y51lqMk3j03T3u53govzTFth1HTOSjAQ6sNPeZXkwpMtsEi+zntk5hUWKAGFnMWgvG0bijB8mDxfs4CJ8cw1QghP+LsK6h+JDWIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cors\"\n        title=\"cors\"\n        src=\"/static/157a5c1636af09bd03e30e5838a11366/f058b/cors.png\"\n        srcset=\"/static/157a5c1636af09bd03e30e5838a11366/c26ae/cors.png 158w,\n/static/157a5c1636af09bd03e30e5838a11366/6bdcf/cors.png 315w,\n/static/157a5c1636af09bd03e30e5838a11366/f058b/cors.png 630w,\n/static/157a5c1636af09bd03e30e5838a11366/f8915/cors.png 748w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /></p>\n<blockquote>\n<ul>\n<li><strong>Access-Control-Allow-Origin</strong>:支持跨域的 URI</li>\n<li><strong>Access-Control-Allow-Headers</strong>:跨域请求支持的请求头（由于 cors 跨域对请求头和请求方法存在限制，所以需要服务端来进行处理才能使用相应的请求头和请求方法）</li>\n<li><strong>Access-Control-Allow-Methods</strong>:跨域请求支持的请求方法（eg:‘PUT,DELETE,POST’）</li>\n<li><strong>Access-Control-Max-Age</strong>:1000   意思是在 1000s 内的以上跨域（包括跨域支持的头部和请求方法）都不用发送 cors 预请求来验证，可以直接发送正式请求</li>\n<li><strong>注意</strong>：如果在 cors 跨域时，服务端不设定允许的请求头或者请求方法返回，浏览器虽然可以接收返回的信息，但是为了安全考虑，是不会显示内容的。</li>\n<li><strong>注意</strong>：由于浏览器会为了安全着想，在发送除了 PUT,HEAD,POST 方法，和 Content-Type 为 text-plian,multipart/form-data,application/x-www-form-urlencoded 类型以外的 cors 限制发送的请求时，会先在发送正式请求之前发送一个预请求（method 方法为 OPTION）来获取服务端允许的请求域，请求方法，请求头等信息。<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 584px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eb6dc096a0510b40f77cfc659d047aeb/e05eb/res.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0ElEQVQoz12S25KiQBBE/f/v2pjnEeXaIDTNTUBFBFFQ2IO4TuxoBVHQnZVZWbXKy9z1XNMyHeF0t26apuf4JMZpJD7JEp/TJVb90F+7q3CFihThB/4+35fHMk7iU3XKi3yfZ6EKkzTh1LKtc32myuP5eIEfQ9M23+tv3dDh52mZpvJlnMYyDEzbCKS8dl17bYlzXUP2w3zv77f7TdtoVIVWOM42MP6IryiMYNvnRd+fx2c7/fuN4/ifbErqxpbOAxnYjm1LR4/MNEmLsjhWp6JI0ky9YE+Qnypv8KW5INuwDG/nbbYbTdOiUFV1dTgeZChtIeI0adsGDtxpXgkQgKthGPq+3/k77mX7DKmIxypoyZMswTOqqFiF0Wyb8ITrCWiosuKMDD+jJIriuU/EK6VmjdOEt9eurZsLCTrfbb9mhuErZgsPQwYDGH4K+9KH53g6UhQvUFRfam4TA/9XMvfMC3isZkjCdZgWsr2daznW4j+66P/D+dttRmXZJszcY7bVuQKTZimBEGZJ4FDb4VWDhGXz3sx82upbtLFbPMtDCYzm8QwjWSw+snBLOfKl4Z8lYT03+oZuaR61a20NjFpSSVQsKzl3+5i7ZTqgeP0LFD3ReIVXndUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"res\"\n        title=\"res\"\n        src=\"/static/eb6dc096a0510b40f77cfc659d047aeb/e05eb/res.png\"\n        srcset=\"/static/eb6dc096a0510b40f77cfc659d047aeb/c26ae/res.png 158w,\n/static/eb6dc096a0510b40f77cfc659d047aeb/6bdcf/res.png 315w,\n/static/eb6dc096a0510b40f77cfc659d047aeb/e05eb/res.png 584w\"\n        sizes=\"(max-width: 584px) 100vw, 584px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ul>\n</blockquote>\n<p><a name=\"9e50c3f6\"></a></p>\n<h4>Cookie 的 HTTP 响应头部</h4>\n<blockquote>\n<ul>\n<li>服务端通过在响应头中设置<strong>set-Cookie</strong>，设置 Cookie</li>\n<li>键值对，可以通过’[]‘设置多个 cookie</li>\n<li>浏览器的下一次请求的时候会带上</li>\n<li>同域才能发送 cookie</li>\n<li>cookie 的属性：<br />|<strong>max-age</strong>和<strong>expires</strong>| 设置过期时间 |<br />|<strong>Secure</strong>|只能通过 https 发送|<br />|  <strong>HttpOnly</strong>|无法通过 document.cookie 或者其他脚本程序访问，防止 xrs 攻击  |</li>\n</ul>\n</blockquote>\n<p><a name=\"2bb7644c\"></a></p>\n<h4>Connection（TCP 连接）的 HTTP 响应头部</h4>\n<blockquote>\n<ul>\n<li><strong>HTTP1.1</strong>一般只有 6 个 TCP 的并发链接,其他的连接会阻塞</li>\n<li><strong>Connection:‘close’</strong>   没有长连接，在每一次请求完毕之后关闭 TCP 连接，有新请求时创建一个新的 TCP 连接</li>\n<li><strong>Connection:‘keep-alive’</strong>   有长连接，在六个 TCP 连接中如果有一个连接完成数据传输，则将那个 TCP 连接给下一个请求用</li>\n</ul>\n</blockquote>\n<p><a name=\"8c43a26b\"></a></p>\n<h4>CSP（ Content-Security-Policy:）的 HTTP 响应头部</h4>\n<blockquote>\n<p>作用：</p>\n<ol>\n<li>限制网页资源的获取（从哪里获取，请求发到什么地方）</li>\n<li>限制报告资源获取越权（当获取到不应该获取的资源时候，给网页一些报告）</li>\n</ol>\n</blockquote>\n<blockquote>\n<p>限制方式：</p>\n<ul>\n<li>defalut-src:(限制全局)<br />| http |   只能通过 http 进行加载|<br />|http https|只能通过 http 或者 https 进行加载|<br />| ’self’ | 只能通过本域名的进行加载 |<br />|http.baidu.com|可以限定制定的网站进行加载|</li>\n<li>制定资源类型:<br />1.connet-src:请求发现的目标进行限制<br />2.img-src:图片可以从哪些网址加载<br />3.font-src:字体从哪里加载<br />4.script-src:脚本资源从哪里进行加载<br />…网页可以从外部加载的都可以进行资源的限制</li>\n<li>.form-action   ‘\\self’:对 form 表单提交的 action 进行限制</li>\n<li>report-uri  + 服务器的路径（可以向服务区提交加载错误的信息）</li>\n<li>Content-Security-Policy-Report-Only:（虽然检测到资源不想加载，但还是可以加载）<br />…</li>\n</ul>\n</blockquote>\n<p><a name=\"5a32a534\"></a></p>\n<h4>数据协商：客户端和服务端协商声明所需要的数据类型（以下是 HTTP 请求头部）</h4>\n<blockquote>\n<ul>\n<li>Accept:浏览器能够处理的 MIME 类型</li>\n<li>Accept-Charset:浏览器能够显示的字符编码</li>\n<li>Accept-Encoding:浏览器能够处理的压缩编码</li>\n<li>Accept-Language:浏览器当前设置的语言</li>\n<li>Connection:浏览器与服务器之间连接的类型</li>\n<li>Cookie:当前页面设置的任何 cookie</li>\n<li>Host:发出请求页面所在的域</li>\n<li>Referer:发出请求页面的 URI</li>\n<li>User-Agent:浏览器的用户代理字符串</li>\n</ul>\n</blockquote>\n<p><br />延伸阅读：<br />CSP 扩展：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP\">CSP 内容安全策略</a><br />HTTPS（图解 HTTPS，写的挺好的博客）：<a href=\"https://blog.csdn.net/forezp/article/details/89666603\">HTPPS</a><br />HTTP2：<a href=\"https://juejin.im/post/5b88a4f56fb9a01a0b31a67e\">HTTP2 网络质和量的提升</a></p>","frontmatter":{"title":"你该知道的http","date":"February 20, 2021","description":"http重要知识点"}},"previous":{"fields":{"slug":"/highLight/"},"frontmatter":{"title":"react高亮显示关键词"}},"next":{"fields":{"slug":"/long-list-of-react/"},"frontmatter":{"title":"在React项目中，如何优雅的优化长列表"}}},"pageContext":{"id":"b20889ff-7b5e-5b9a-b6c2-f6c6b8dd3a19","previousPostId":"f87de9a5-c4b1-5764-945f-de4c7618fd11","nextPostId":"272d5071-ec39-5eda-9967-7f1541b46076"}},"staticQueryHashes":["2841359383","3122794013"]}