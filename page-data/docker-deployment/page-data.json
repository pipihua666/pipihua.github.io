{"componentChunkName":"component---theme-src-templates-post-tsx","path":"/docker-deployment","result":{"data":{"post":{"id":"dc19db67-d63d-5583-be25-d77e1c8a8fcb","headings":[{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":3}],"frontmatter":{"title":"使用docker部署react项目到服务器","path":"/docker-deployment","tags":["DevOps"],"excerpt":"使用docker部署react项目到服务器,并完成与后端容器的通信，通信过程中遇到了不能访问上游服务器的问题。","created":"2021-04-14T00:00:00.000Z","createdPretty":"14 April, 2021","updated":"2021-04-15T00:00:00.000Z","updatedPretty":"15 April, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACYUlEQVQ4y61TTW8SYRDmz3jyoMajd49e9OLFg8Y/4Ec4eDA18WJaK9GWYDCBGpPWdLESoVDaBtqCltJSYJfdxfKRVMECy37wcTB2H2eB3UJbbx4m8747s888z8y8Nq3F6f/TbKrE4rRRwDorZPLQn+TkBtbMDe4j+bbzqlBA78p5vUvnnszpf1SBPN3VAnlR77QKuqoUdbVX1DWN7+cP/mV1AxCmmVXoZwg/d1BupLH/Yw8Mt45KLY3D0hoKqXlUoq/QDrxAJzIHRUxC04SBMonDGKAJ2pU5VOoCFhMMXm9P4cLCDG4texDzO7HzfgKzEQdepqcR9z9C03EXUmSBQEVL8hg74yw3slBLIXCzbtz2TOHKl7ewxxmEKtvophlI08/h97jxkJuHn3ejdxCBIgsjgH2wkUGQ5GzkIxxv7Ljkc+FGeA7VegYdI9Y5QKfM4Ng1gZz3HXL1FLrad2s4NpOVZjKk6XWUDIphHvdmwrgadOJ6wEM93e33VmkSe60ItcgQsxh9E/sTNzFslty+dBbNZhl8YwnV0BPc+eDCxc8uXPY54WVXAeqTbK6NXICi5K1hqK2ByiFDujTzJOkbftWCeJqN4ebqM1zzuzG5F0S0FIf96xKOjN5a7cmNETGV2qzFbLCQPrkRSjzG/Q0ffHwCk7tBhMQNoMXDm1nBgy1fn2F7qOr0hpwAGkGFh5BcRjy/CUlmcUxBJhWCJ7KI6IoPm1sBrGfWqHBu7GWcARxdG60t4jctqcFAomcl1/ZRLSdRLCRwSF45ypx5mv9mOExSTiW2qfFdYm/4seLnyDXsL3yh3JleIuEaAAAAAElFTkSuQmCC","aspectRatio":1.3793103448275863,"src":"/static/cd2fed732da0d690be8178f64aad459d/90823/dinosaur.png","srcSet":"/static/cd2fed732da0d690be8178f64aad459d/dc47e/dinosaur.png 200w,\n/static/cd2fed732da0d690be8178f64aad459d/9f2d5/dinosaur.png 400w,\n/static/cd2fed732da0d690be8178f64aad459d/90823/dinosaur.png 800w,\n/static/cd2fed732da0d690be8178f64aad459d/77647/dinosaur.png 1200w,\n/static/cd2fed732da0d690be8178f64aad459d/f8d4f/dinosaur.png 1600w,\n/static/cd2fed732da0d690be8178f64aad459d/4ce6a/dinosaur.png 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<blockquote>\n<p>看此文章前需要您具备 docker，linux，makefile ,nginx 的基础知识</p>\n</blockquote>\n<h2 id=\"镜像准备\" style=\"position:relative;\"><a href=\"#%E9%95%9C%E5%83%8F%E5%87%86%E5%A4%87\" aria-label=\"镜像准备 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>镜像准备</h2>\n<h3 id=\"编写-makefile\" style=\"position:relative;\"><a href=\"#%E7%BC%96%E5%86%99-makefile\" aria-label=\"编写 makefile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>编写 Makefile</h3>\n<div class=\"gatsby-highlight\" data-language=\"makefile\"><pre class=\"language-makefile\"><code class=\"language-makefile\"><span class=\"token comment\"># 这个名称在拉取镜像的时候有用哦</span>\nimagePath <span class=\"token operator\">=</span> [你的harbor地址]/[镜像名]<span class=\"token punctuation\">:</span>[镜像版本号]\n<span class=\"token symbol\">push-webapp</span><span class=\"token punctuation\">:</span>\n\tyarn build\n\tdocker build -t <span class=\"token variable\">$</span><span class=\"token punctuation\">{</span>imagePath<span class=\"token punctuation\">}</span> .\n\tdocker push <span class=\"token variable\">$</span><span class=\"token punctuation\">{</span>imagePath<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"编写-dockerfile\" style=\"position:relative;\"><a href=\"#%E7%BC%96%E5%86%99-dockerfile\" aria-label=\"编写 dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>编写 Dockerfile</h3>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># nginx的版本可以自行选择</span>\n<span class=\"token keyword\">FROM</span> nginx<span class=\"token punctuation\">:</span>1.19<span class=\"token punctuation\">-</span>alpine\n<span class=\"token keyword\">COPY</span> ./nginx.conf /etc/nginx/nginx.conf\n<span class=\"token keyword\">COPY</span> ./dist/ /opt/www/\n<span class=\"token keyword\">ENTRYPOINT</span> nginx <span class=\"token punctuation\">-</span>g <span class=\"token string\">\"daemon off;\"</span>\n<span class=\"token keyword\">EXPOSE</span> 80</code></pre></div>\n<h3 id=\"编写-nignxconf\" style=\"position:relative;\"><a href=\"#%E7%BC%96%E5%86%99-nignxconf\" aria-label=\"编写 nignxconf permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>编写 nignx.conf</h3>\n<blockquote>\n<p>主要是在 nginx.conf 文件的 server 块中修改或添加以下代理就可以了</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token comment\"># 指定静态文件夹的根目录</span>\n<span class=\"token keyword\">root</span> <span class=\"token operator\">/</span>opt<span class=\"token operator\">/</span>www<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># api_url 为后端容器的ip地址,api_port为容器开启的服务端口</span>\n<span class=\"token keyword\">location</span> <span class=\"token operator\">~</span> <span class=\"token operator\">/</span>api<span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">proxy_pass</span> <span class=\"token keyword\">http</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span><span class=\"token punctuation\">[</span>api_url<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span>api_port<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">proxy_set_header</span> real_ip <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\"># 因为是单页应用，所以需要总是返回index.html文件</span>\n<span class=\"token keyword\">location</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try_files</span> <span class=\"token variable\">$uri</span> <span class=\"token operator\">/</span><span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"在服务器端运行镜像\" style=\"position:relative;\"><a href=\"#%E5%9C%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F\" aria-label=\"在服务器端运行镜像 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>在服务器端运行镜像</h2>\n<h3 id=\"拉取镜像\" style=\"position:relative;\"><a href=\"#%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F\" aria-label=\"拉取镜像 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>拉取镜像</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 上面打的镜像变量名imagePath</span>\ndocker pull <span class=\"token punctuation\">[</span>imagePath<span class=\"token punctuation\">]</span></code></pre></div>\n<h3 id=\"以守护态形式运行镜像\" style=\"position:relative;\"><a href=\"#%E4%BB%A5%E5%AE%88%E6%8A%A4%E6%80%81%E5%BD%A2%E5%BC%8F%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F\" aria-label=\"以守护态形式运行镜像 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>以守护态形式运行镜像</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 这里的-p是映射主机80端口到容器的80端口,dockerfile中的EXPOSE是容器暴露的端口</span>\ndocker run --name <span class=\"token punctuation\">[</span>容器名<span class=\"token punctuation\">]</span> -d -p <span class=\"token number\">80</span>:80 <span class=\"token punctuation\">[</span>imagePath的镜像id<span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"遇到的问题以及解决方法\" style=\"position:relative;\"><a href=\"#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95\" aria-label=\"遇到的问题以及解决方法 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>遇到的问题以及解决方法</h2>\n<h3 id=\"nignx-无法访问上游服务器\" style=\"position:relative;\"><a href=\"#nignx-%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E4%B8%8A%E6%B8%B8%E6%9C%8D%E5%8A%A1%E5%99%A8\" aria-label=\"nignx 无法访问上游服务器 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nignx 无法访问上游服务器</h3>\n<ul>\n<li>一开始我配置的<code class=\"language-text\">proxy_pass http://[api_url]:[api_port]</code>中的<code class=\"language-text\">api_url</code>是 127.0.0.1，导致打开页面报网关错误的问题，大佬一看就肯定知道啥原因了。<br></li>\n<li>经过排查，docker 容器的网络是通过 linux 的 namespace 进行隔离的，默认的桥接情况下，每个容器都有自己的一块独立的网卡，学过 linux 的肯定知道 127.0.0.1 是 lo 回环网卡的地址，所以是访问不到后端服务的（QAQ，我这里的错误就是误认为后端服务和前端服务同用宿主机的网卡了,hahahah~）。</li>\n<li>\n<p>解决方案：</p>\n<ul>\n<li>使用宿主机的 ip + 后端服务的端口(相当于外部访问宿主机的后端服务，转了一圈~)</li>\n<li>如果是同一网桥 docker0 中，可以将请求地址改成后端服务在网段中的地址（具体地址可以进容器查看，也可以通过<code class=\"language-text\">docker network inspect bridge</code>,bridge 是网桥的名称，可以通过<code class=\"language-text\">docker netword ls</code>查看所有的网桥）</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"nginx-部署单页应用遇到白屏问题\" style=\"position:relative;\"><a href=\"#nginx-%E9%83%A8%E7%BD%B2%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8%E9%81%87%E5%88%B0%E7%99%BD%E5%B1%8F%E9%97%AE%E9%A2%98\" aria-label=\"nginx 部署单页应用遇到白屏问题 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nginx 部署单页应用遇到白屏问题</h3>\n<p>可以查看<a href=\"http://localhost:8001/nginx-deployment\"> nginx 部署 react 项目</a></p>\n<h2 id=\"docker-一共有四种网络模式\" style=\"position:relative;\"><a href=\"#docker-%E4%B8%80%E5%85%B1%E6%9C%89%E5%9B%9B%E7%A7%8D%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F\" aria-label=\"docker 一共有四种网络模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker 一共有四种网络模式:</h2>\n<h3 id=\"host-模式\" style=\"position:relative;\"><a href=\"#host-%E6%A8%A1%E5%BC%8F\" aria-label=\"host 模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>host 模式</h3>\n<ul>\n<li>设置命令:<code class=\"language-text\">--net=host</code></li>\n<li>详细说明: 容器不会获得一个独立的 network namespace，而是与宿主机共用一个 network namespace，容器不会虚拟出自己的网卡、配置自己的 ip 等，而是使用宿主机的 ip 和端口。</li>\n</ul>\n<blockquote>\n<p>应用场景:当网络不应与 Docker 主机隔离，但又希望容器的其他方面隔离时，主机网络是最佳选择。</p>\n</blockquote>\n<h3 id=\"container-模式\" style=\"position:relative;\"><a href=\"#container-%E6%A8%A1%E5%BC%8F\" aria-label=\"container 模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>container 模式</h3>\n<ul>\n<li>设置命令: <code class=\"language-text\">--net=container</code></li>\n<li>详细说明:指定新创建的容器和已经存在的一个容器共享一个 network namespace，而不是和宿主机共享，新创建的容器不会创建自己的网卡、配置自己的 ip，而是和指定的容器共享 ip、端口等。两个容器除网络方面相同外，其他的如文件系统、进程列表等还是隔离的。</li>\n</ul>\n<h3 id=\"none-模式\" style=\"position:relative;\"><a href=\"#none-%E6%A8%A1%E5%BC%8F\" aria-label=\"none 模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>none 模式</h3>\n<ul>\n<li>设置命令:<code class=\"language-text\">--net=none</code></li>\n<li>详细说明:容器拥有自己的 network namespace，但是并未对容器进行任何网络配置，需要手工为容器添加网卡、配置 ip 等。可以使用 pipework 工具为容器指定 ip 等信息</li>\n</ul>\n<blockquote>\n<p>应用场景：第三方网络插件使您可以将 docker 与专用网络集成。</p>\n</blockquote>\n<h3 id=\"bridge-模式\" style=\"position:relative;\"><a href=\"#bridge-%E6%A8%A1%E5%BC%8F\" aria-label=\"bridge 模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>bridge 模式</h3>\n<ul>\n<li>设置命令:<code class=\"language-text\">--net=bridge</code></li>\n<li>详细说明:bridge 模式是容器默认的网络模式，该模式会为每个容器分配独立的 network namespace，设置 ip、路由等信息，默认会将容器连接到一个虚拟网桥交换机 docker0 上，容器之间组成一个局域网，可以相互访问。</li>\n</ul>\n<blockquote>\n<p>应用场景:当您需要多个容器在同一 docker 主机上进行通信时，最好使用用户定义的网桥网络。用户定义的网桥网络的容器会自动将所有端口彼此公开，而不会向外界公开任何端口。默认网桥网络上运行相同的应用程序堆栈，则需要使用-p 或–publish 标志分别打开 Web 端口和数据库端口。这意味着 docker 主机需要通过其他方式阻止对数据库端口的访问。</p>\n</blockquote>"},"primaryTag":{"name":"DevOps","color":null}},"pageContext":{"postId":"dc19db67-d63d-5583-be25-d77e1c8a8fcb","primaryTag":"DevOps"}},"staticQueryHashes":["1116962356","2275848304","3097946992","3138592700","3462520645"]}