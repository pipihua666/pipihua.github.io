{"componentChunkName":"component---theme-src-templates-posts-tsx","path":"/","result":{"pageContext":{"posts":[{"id":"debde2f7-3ff2-58ee-8792-c84056613d22","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"k8s持久化存储实现前端oem需求","path":"/oem","tags":["Kubernetes"],"excerpt":"前端根据licence显示不同的背景图和文字信息.","created":"2021-02-21 15:00","createdPretty":"21 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"21 February, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQozwEZA+b8ALCNXufixuXhx+Xix+XiyePUqeHFiOLSqOTjyuXiyOXhxuXhxuXgxOXgxOXgwuXfweXfweXfweXduuPUqACjfU/j2bXk3sDk4MTk17HgwHzfu3LeuHDk2rbk3sDl38Ll4MTm4sfm4sXm4sXm4sPm4cHn4cDk27fWv48AjGEz1K5q48F74MB93bp21rJu4MB83bhv3Lhu28KN6ObL5Ny64M+h4M+i3caT2r+G2Lp+0rF2z6turYFIAJBlN9OrZcylYtawadGoYcKYWN68d9y2bdOsZL2aY9fEl9y+f9GmXc6jWdGmXcygWMWcV7uOTMGVUruQTwCUZjSzh0u3jlHbtWvMo164jk/euXHft2zTrGW3jE3Tq2PasWbOpFzQplzRqGDKn1nTrWfHnVnEl1TDllMAh1UsgFEsilsyq31EroJIqX5Fs41Vr4hQsohOpnpFsIZMtYtPrIFIsIVLsohNsYRKqXxGsINIsINItIhLAEoiI00jI1IoI1guJVctJVkxJl45LF42KlgvJ10zKVwzKVUtJl82KmM8LmY8K1UsJlkuJF00KVQsJlEqJQBZLSQ+HSI8GSFIISN4UDmddUqxi1mge1ZbNC1DGx9GHB9sRTajf1e1j1qme0lgNys9GSE7GCBRKSWNYj0AdD8lOBsiNRYgUisno3hFu45N2rJnyZ9aYzgtSyEiSyIif1Y8xplTx5pTyp5XcEMwUyUiQRshaT8tm29BAHpJKkMlJTAUIEUjJZ9+WNCsa9u4c8eiZV42LE0jIz4ZIF05MdOxct68etOydG1EM1kpIz0aIVY0LnVQOQCWXi9kPy4oDB5jPC7RsHTjwnzhv3reuXCMZUI/GB9DHSCTcU7p0Zbn0JfnzIyfdkpMICE5FR91TjakekcAXS8kRCAhOhkgWTIom3RFqoJLq4NMimI4WjQoQh4jQRwgf15BwKRvxKdzpINVYT0tQBwgQSAkWTMpgVcyAHVJMJlzSpVwSqF/VKGAVauKWqODV5d5Uph7V5t7Vpd5VJt9VrGRXbKRXp9/VY50VIJnTZF2VpF2V5R5WdJzgcS6sLzOAAAAAElFTkSuQmCC","aspectRatio":1.5625,"src":"/static/67770bd9ce3b813d3f9c5e3fbab1e18f/0853f/bridge.png","srcSet":"/static/67770bd9ce3b813d3f9c5e3fbab1e18f/14156/bridge.png 125w,\n/static/67770bd9ce3b813d3f9c5e3fbab1e18f/d6e47/bridge.png 250w,\n/static/67770bd9ce3b813d3f9c5e3fbab1e18f/0853f/bridge.png 500w,\n/static/67770bd9ce3b813d3f9c5e3fbab1e18f/ce627/bridge.png 750w,\n/static/67770bd9ce3b813d3f9c5e3fbab1e18f/9dbcf/bridge.png 1000w,\n/static/67770bd9ce3b813d3f9c5e3fbab1e18f/87046/bridge.png 1920w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<h2 id=\"技术栈\" style=\"position:relative;\"><a href=\"#%E6%8A%80%E6%9C%AF%E6%A0%88\" aria-label=\"技术栈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>技术栈</h2>\n<ul>\n<li>react，docker，k8s</li>\n</ul>\n<h2 id=\"需求\" style=\"position:relative;\"><a href=\"#%E9%9C%80%E6%B1%82\" aria-label=\"需求 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>需求</h2>\n<ul>\n<li>前端实现界面的 licence 控制，根据 licence 显示不同的背景和文字信息，并且不用重新编译前端镜像，达到可以在宿主机上随时都可以定制的需求</li>\n</ul>\n<h2 id=\"需求分析\" style=\"position:relative;\"><a href=\"#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90\" aria-label=\"需求分析 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>需求分析</h2>\n<ul>\n<li>创建一个 oem 文件夹，存放不同的 licence 的 index.json 和图片，前端通过 ajax 可以直接请求本地的文件（这里是 index.json） k8s 在宿主机上持久化本地存储的方式来进行需求开发再合适不过。）</li>\n</ul>\n<h2 id=\"目前官方支持的-3-种本地存储方案如下：\" style=\"position:relative;\"><a href=\"#%E7%9B%AE%E5%89%8D%E5%AE%98%E6%96%B9%E6%94%AF%E6%8C%81%E7%9A%84-3-%E7%A7%8D%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88%E5%A6%82%E4%B8%8B%EF%BC%9A\" aria-label=\"目前官方支持的 3 种本地存储方案如下： permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>目前官方支持的 3 种本地存储方案如下：</h2>\n<h3 id=\"emptydir\" style=\"position:relative;\"><a href=\"#emptydir\" aria-label=\"emptydir permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>emptyDir</h3>\n<ol>\n<li>pod 在节点上运行时初始化的空卷，pod 中的所有容器都可以访问到该卷。</li>\n<li>pod 从节点上删除时，该卷也会被删除(注意：容器奔溃不会导致 pod 从节点上删除，因此容器奔溃时 emptyDir 是安全的）。</li>\n</ol>\n<p>pod 示例：</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>pod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>image\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /cache   // pod中的emptyDir路径\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cache<span class=\"token punctuation\">-</span>volume\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cache<span class=\"token punctuation\">-</span>volume\n      <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"hostpath（适合我的需求）\" style=\"position:relative;\"><a href=\"#hostpath%EF%BC%88%E9%80%82%E5%90%88%E6%88%91%E7%9A%84%E9%9C%80%E6%B1%82%EF%BC%89\" aria-label=\"hostpath（适合我的需求） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>hostPath（适合我的需求）</h3>\n<ol>\n<li>pod 中的文件夹与宿主机上的文件夹相互映射，如果宿主机没有则到 pod 映射，如果 pod 没有则到宿主机映射，如果都没有则默认空文件夹</li>\n<li>宿主机上映射的文件夹的修改会自动同步到 pod 中。</li>\n<li>pod 即使从节点上被删除了（比如：pod 重启），该卷还是会持久化在宿主机上。</li>\n</ol>\n<p>pod 示例：</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>pod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>image\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>image\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /opt/nginx/oem  // pod路径\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> oem   // 映射宿主机的volume名称\n  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> oem\n      <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /data/oem    // 宿主机路径</code></pre></div>\n<p>但是还有一点问题，就是 pod 每次重启了，会重新创建 pod 中的 oem 文件夹，这里就是/opt/nginx/oem,那么宿主机上的文件夹/data/oem 也会随着 pod 的重启而替换，所以这需要在 pod 重启的容器中添加一个 command 指令<br /></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>image\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> my<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>image\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">\"sh\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"-c\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">\"cp -r -n /opt/assets/public/oem /opt/nginx/ &amp;&amp; nginx -g 'daemon off;'\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /opt/nginx/oem\n          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> oem</code></pre></div>\n<ol>\n<li>/opt/assets/public/oem 是容器中的模版文件夹</li>\n<li><code class=\"language-text\">cp -r -n</code> 如果 pod 中存在/opt/nginx/oem 就不复制（保证每次重启 pod 都是用的宿主机上的 oem 文件夹），也就是初始化 pod 的时候会创建该文件夹</li>\n<li>镜像的 cp 命令升级：\n<code class=\"language-text\">RUN sed -i &#39;s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g&#39; /etc/apk/repositories \\ &amp;&amp; apk add --no-cache coreutils</code>\n（如果 nginx:1.17-alpine 的版本太老，没办法 cp -n）</li>\n<li>至此，需求完成。</li>\n</ol>\n<h3 id=\"local-persistent-volume\" style=\"position:relative;\"><a href=\"#local-persistent-volume\" aria-label=\"local persistent volume permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Local Persistent Volume</h3>\n<p>指的就是利用机器上的磁盘来存放业务需要持久化的数据，和远端存储类似，此时数据依然独立于 Pod 的生命周期，即使业务 Pod 被删除，数据也不会丢失。</p>\n<h2 id=\"local-persistent-volume-和-hostpath-的区别\" style=\"position:relative;\"><a href=\"#local-persistent-volume-%E5%92%8C-hostpath-%E7%9A%84%E5%8C%BA%E5%88%AB\" aria-label=\"local persistent volume 和 hostpath 的区别 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Local Persistent Volume 和 hostPath 的区别</h2>\n<ol>\n<li>HostPath:调度程序可能会将引用 HostPath 卷的 pod 移至其他节点，从而导致数据丢失。</li>\n<li>Local Persistent: 调度程序可确保始终将使用本地持久卷的容器调度到同一节点。</li>\n</ol>\n<h2 id=\"图形化\" style=\"position:relative;\"><a href=\"#%E5%9B%BE%E5%BD%A2%E5%8C%96\" aria-label=\"图形化 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>图形化</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 638px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a8a1e63f4096f24083f3fc17f70493a2/41be6/volumes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/klEQVQoz5WP/2sScRjH75+q/RDUMogIahT0YzHcFlswTBexqXO2iL79sB9i6c473SJkUJHBtDvNb0vnSueZuDZZ3cfpfU5y80tN0DvvvD4mGxP2Sw8vHt4PPC8eHqz/Lvg/NOCsbveSPn9uooCptOCCDqh04LwWdDMKXVQn0a9hB8wFh29fPcdjp0bZK1PghhlcnmSvm8BVA0B9wACuGdm+O+zpsR76xli0f0a7O/qieFHPYSYSmh1wdgnOLkKTnZuxd8IMWUDdSMApnJsmod7GGXDORPIoTBOckeQncV5P8FhbFmWpQ1sSa/XG2/XsPM3Me76+pBlXfCeT37P6GAuVsNIbFi+TZIuKIrVlAVmKLGKCKB5RPmg8eBcfIcL3nOtDePjxh2RoszBoDWhfxxC3LH4PwyptuSkI3X1MPFaVg+YjV2LYFtK8igzbgs9XmMgWHMID40ufEeqFgDeVQ/I/t1M9cq3efPg+cdu+en85NkKuPu3InBoP6pyxCWdscCFApcAJMpqklgjL9eXgFuH5tkilbe7Um/B2NM3h7pSDSiOsK0w0w8mSdOgeyg1BVJTWXLL0bK0UzZZd8XwkW7Fu7N+k4dqPP26Gp9NF73btyZdfR2d7LiuSmCnVP7LVUK7qBxXfzz3qe969mf+0UwrkqkFQ8edqMfi7dezNv2/b5msmRtbiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"volumes\"\n        title=\"volumes\"\n        src=\"/static/a8a1e63f4096f24083f3fc17f70493a2/41be6/volumes.png\"\n        srcset=\"/static/a8a1e63f4096f24083f3fc17f70493a2/5a46d/volumes.png 300w,\n/static/a8a1e63f4096f24083f3fc17f70493a2/0a47e/volumes.png 600w,\n/static/a8a1e63f4096f24083f3fc17f70493a2/41be6/volumes.png 638w\"\n        sizes=\"(max-width: 638px) 100vw, 638px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://segmentfault.com/a/1190000022860937\">Kubernetes 本地持久化方案</a></li>\n</ul>"},{"id":"6800558a-9d73-5926-b456-8a0a037ead02","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"深入浅出HTTP","path":"/http","tags":["Network"],"excerpt":"http 重要知识点.","created":"2021-02-20 21:45","createdPretty":"20 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"20 February, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAdXwaDIkFn//xAAZEAEBAQEBAQAAAAAAAAAAAAABAhIDADH/2gAIAQEAAQUC2YonHShppy9Hz9//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAgEBPwGn/8QAGxAAAgEFAAAAAAAAAAAAAAAAAAEQESExYZH/2gAIAQEABj8Cul2MFBLUf//EABkQAQADAQEAAAAAAAAAAAAAAAEAESExQf/aAAgBAQABPyGl8hsCblNIXOI4exW2XHnk2jj/2gAMAwEAAgADAAAAELTv/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAEDAQE/EMR//8QAFREBAQAAAAAAAAAAAAAAAAAAERD/2gAIAQIBAT8QFP/EABsQAQACAwEBAAAAAAAAAAAAAAEAESExUUGh/9oACAEBAAE/EEIgEaM6+wnGPGlFMOOkHJWNEuR7L4YlONVFUz//2Q==","aspectRatio":1.5060240963855422,"src":"/static/a101ba1b43ab0f98316295a93ab9c5fb/ba9ae/fog.jpg","srcSet":"/static/a101ba1b43ab0f98316295a93ab9c5fb/86d0f/fog.jpg 125w,\n/static/a101ba1b43ab0f98316295a93ab9c5fb/520da/fog.jpg 250w,\n/static/a101ba1b43ab0f98316295a93ab9c5fb/ba9ae/fog.jpg 500w,\n/static/a101ba1b43ab0f98316295a93ab9c5fb/72227/fog.jpg 750w,\n/static/a101ba1b43ab0f98316295a93ab9c5fb/5c39c/fog.jpg 1000w,\n/static/a101ba1b43ab0f98316295a93ab9c5fb/b1e91/fog.jpg 1920w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<h2 id=\"首先让我们来了解一下-http-的请求报文和响应报文\" style=\"position:relative;\"><a href=\"#%E9%A6%96%E5%85%88%E8%AE%A9%E6%88%91%E4%BB%AC%E6%9D%A5%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B-http-%E7%9A%84%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E5%92%8C%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87\" aria-label=\"首先让我们来了解一下 http 的请求报文和响应报文 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>首先让我们来了解一下 http 的请求报文和响应报文</h2>\n<p><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/da49442a0e71569330996cf2fcde50c1/a7a19/http.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.999999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVQY001PaY+DIBD1//+41iuKaxWwtYqAeIDnJu7b7pdNJpPhzbwDzy1u3dZlXcZp1L2a7bTtG5A/EIVhtjNWUknnrPsgwM1gvOM8dK+VVo8i94M740xIgcIp5HrTq141bRPHcckoaJAexgEdfG+apzAKSUYSkuBIdKKT3bt5+77/ql/Vk9/utyRN8kcOXV4xJOUVx8F+7B4EKKN4FGUhVQer8/uEQ5oSJIQJVq1opeyGwbjVXdeFD7RC/JIRm1cV45DllLGSUvSvPKeMf5gNpGGVEgJ1rXVvTEoy4CB61lkkH6cJ/f8wWzuMpn7XQRhGcRwEQRhFCfJkGf6vlIL0D9pJSG45vahuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"http\"\n        title=\"http\"\n        src=\"/static/da49442a0e71569330996cf2fcde50c1/c1b63/http.png\"\n        srcset=\"/static/da49442a0e71569330996cf2fcde50c1/5a46d/http.png 300w,\n/static/da49442a0e71569330996cf2fcde50c1/0a47e/http.png 600w,\n/static/da49442a0e71569330996cf2fcde50c1/c1b63/http.png 1200w,\n/static/da49442a0e71569330996cf2fcde50c1/a7a19/http.png 1323w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /></p>\n<p><a name=\"c76a254f\"></a></p>\n<h2 id=\"再向您献上一张-http-请求的流程图\" style=\"position:relative;\"><a href=\"#%E5%86%8D%E5%90%91%E6%82%A8%E7%8C%AE%E4%B8%8A%E4%B8%80%E5%BC%A0-http-%E8%AF%B7%E6%B1%82%E7%9A%84%E6%B5%81%E7%A8%8B%E5%9B%BE\" aria-label=\"再向您献上一张 http 请求的流程图 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>再向您献上一张 http 请求的流程图</h2>\n<p><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 748px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/226664588d9551f1dce70bbfeb894e83/f8915/httpRequest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBElEQVQY03VR2XKDMBDj/7+xnbZJmmDwAb69virDDE8po4H1SoLVMpVagNrqWxxs/Y+dpFIhhtYbcKpba+cR9cyYVPKUnoJLOcxCCutM710bbcwofPDLuu56LzXjzoWIKaLAW3pvZ6e2MezE5QakXJQ288pDTD5ExqX1IVHetNXOg4WGrYJKVbt5zgvIYWZc/b6WSFmo/ePrpl1wIf08XkpbF9P9yZ6Mg50XcXu8IpFQ2+f3TVs/zIlo5TxR6seFvBgbg+1a42isEUfmEbXhUXKhha/oozOBgPNaOFrDLIW2BhBSApRp7PLICWUk5Mjjy9caLzOWb60NMTrvjLUA5fz2L/4BgwvPrlvqCxAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"httpRequest\"\n        title=\"httpRequest\"\n        src=\"/static/226664588d9551f1dce70bbfeb894e83/f8915/httpRequest.png\"\n        srcset=\"/static/226664588d9551f1dce70bbfeb894e83/5a46d/httpRequest.png 300w,\n/static/226664588d9551f1dce70bbfeb894e83/0a47e/httpRequest.png 600w,\n/static/226664588d9551f1dce70bbfeb894e83/f8915/httpRequest.png 748w\"\n        sizes=\"(max-width: 748px) 100vw, 748px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /></p>\n<p><a name=\"a8b0534a\"></a></p>\n<h2 id=\"redirect（资源重定向）的-http-响应头部\" style=\"position:relative;\"><a href=\"#redirect%EF%BC%88%E8%B5%84%E6%BA%90%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%89%E7%9A%84-http-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8\" aria-label=\"redirect（资源重定向）的 http 响应头部 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redirect（资源重定向）的 HTTP 响应头部</h2>\n<blockquote>\n<ul>\n<li>Location:''（后面接跳转的 URI 路径）</li>\n<li>通过 response.write(302,{ Location:'/new' })返回的 xhr.status>=300&#x26;&#x26;xhr.status&#x3C;400 才能进行重定向</li>\n</ul>\n</blockquote>\n<p><a name=\"94d0159f\"></a></p>\n<h2 id=\"cache-contorl-的含义和使用的-http-响应头部\" style=\"position:relative;\"><a href=\"#cache-contorl-%E7%9A%84%E5%90%AB%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8%E7%9A%84-http-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8\" aria-label=\"cache contorl 的含义和使用的 http 响应头部 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache-Contorl 的含义和使用的 HTTP 响应头部</h2>\n<blockquote>\n<ul>\n<li>可缓存性：<br />|<strong>public</strong>|http 经过的地方都能够进行缓存  |<br />|<strong>private</strong>|只有发起请求的浏览器才能够进行缓存|<br />|<strong>no-cache</strong>|本地可以缓存，但是需要在服务端验证过后才能使用|</li>\n<li>到期：<br />|<strong>max-age=<second></strong>| 浏览器缓存多长时间到期 |<br />|<strong>s-maxage=<second></strong>|代理服务器缓存的到期时间|<br />|  <strong>max-stale=<second></strong>| 在 max-age 到期之后，在 max-stale 期限之内还是可以取缓存 |</li>\n<li>重新验证：（使用较少）<br />|<strong>must-revalidate</strong>|   在 max-age 过期之后必须到原服务端发起请求来验证此缓存是否过期了，而不能直接使用本地的缓存|<br />|<strong>proxy-revalidate</strong>|使用在缓存服务器，在缓存过期之后到原服务端请求验证缓存是否过期了，而不能直接使用本地的缓存|</li>\n<li>其他：<br />|<strong>no-store</strong>|本地和代理服务器都不能缓存，永远只能到服务端拿取新的内容才能使用|<br />|<strong>no-transform</strong>|指定代理服务器不能修改服务端返回的内容|</li>\n</ul>\n</blockquote>\n<blockquote>\n<ul>\n<li>服务器缓存的验证更新机制：<br />| <strong>Last-Modified</strong> （上一次修改时间）| 在服务端返回 Last-Modified，浏览器在下一次请求的时候会带上<strong>If-Modified-Since</strong> 与服务器的 Last-Modified 对比，如果相等，那么资源没有被修改过，服务器则告诉浏览器直接使用缓存|<br />|<strong>Etag</strong>（数据签名：对静态资源进行 hash 计算的到唯一值的签名）|在服务器返回 Etag，浏览器在下一次请求的时候会带上<strong>If-None-Match</strong>与服务器的 Etag 进行对比，如果相等，那么资源没有被修改过，服务器告诉浏览器直接使用缓存|</li>\n</ul>\n</blockquote>\n<p><a name=\"5c13213b\"></a></p>\n<h2 id=\"cors-跨域请求的-http-响应头部\" style=\"position:relative;\"><a href=\"#cors-%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82%E7%9A%84-http-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8\" aria-label=\"cors 跨域请求的 http 响应头部 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CORS 跨域请求的 HTTP 响应头部</h2>\n<p><br /><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 748px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/157a5c1636af09bd03e30e5838a11366/f8915/cors.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQoz5WR646EIAyFff9X1H8z3lEBQVDEmY+wO5lsZpNd0iic9rSnbXHGU69aSqm1DmeIV8QAV7OCZzvCkfEfViitRjFy5mXej/16XNnxeDsfmYlsN+u8U6ve3BZj/C3uM7kqS6lUVVbTNFEEwf8gG2v4LXL5K+27r6+eGQlkLn73rw5JysywnJ3UObvzlniaxZXIUsuu7/thABVCoB/fKIau6+q6xms2Y51lqMk3j03T3u53govzTFth1HTOSjAQ6sNPeZXkwpMtsEi+zntk5hUWKAGFnMWgvG0bijB8mDxfs4CJ8cw1QghP+LsK6h+JDWIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cors\"\n        title=\"cors\"\n        src=\"/static/157a5c1636af09bd03e30e5838a11366/f8915/cors.png\"\n        srcset=\"/static/157a5c1636af09bd03e30e5838a11366/5a46d/cors.png 300w,\n/static/157a5c1636af09bd03e30e5838a11366/0a47e/cors.png 600w,\n/static/157a5c1636af09bd03e30e5838a11366/f8915/cors.png 748w\"\n        sizes=\"(max-width: 748px) 100vw, 748px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span><br /></p>\n<blockquote>\n<ul>\n<li><strong>Access-Control-Allow-Origin</strong>:支持跨域的 URI</li>\n<li><strong>Access-Control-Allow-Headers</strong>:跨域请求支持的请求头（由于 cors 跨域对请求头和请求方法存在限制，所以需要服务端来进行处理才能使用相应的请求头和请求方法）</li>\n<li><strong>Access-Control-Allow-Methods</strong>:跨域请求支持的请求方法（eg:'PUT,DELETE,POST'）</li>\n<li><strong>Access-Control-Max-Age</strong>:1000   意思是在 1000s 内的以上跨域（包括跨域支持的头部和请求方法）都不用发送 cors 预请求来验证，可以直接发送正式请求</li>\n<li><strong>注意</strong>：如果在 cors 跨域时，服务端不设定允许的请求头或者请求方法返回，浏览器虽然可以接收返回的信息，但是为了安全考虑，是不会显示内容的。</li>\n<li><strong>注意</strong>：由于浏览器会为了安全着想，在发送除了 PUT,HEAD,POST 方法，和 Content-Type 为 text-plian,multipart/form-data,application/x-www-form-urlencoded 类型以外的 cors 限制发送的请求时，会先在发送正式请求之前发送一个预请求（method 方法为 OPTION）来获取服务端允许的请求域，请求方法，请求头等信息。<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 584px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eb6dc096a0510b40f77cfc659d047aeb/e05eb/res.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0ElEQVQoz12S25KiQBBE/f/v2pjnEeXaIDTNTUBFBFFQ2IO4TuxoBVHQnZVZWbXKy9z1XNMyHeF0t26apuf4JMZpJD7JEp/TJVb90F+7q3CFihThB/4+35fHMk7iU3XKi3yfZ6EKkzTh1LKtc32myuP5eIEfQ9M23+tv3dDh52mZpvJlnMYyDEzbCKS8dl17bYlzXUP2w3zv77f7TdtoVIVWOM42MP6IryiMYNvnRd+fx2c7/fuN4/ifbErqxpbOAxnYjm1LR4/MNEmLsjhWp6JI0ky9YE+Qnypv8KW5INuwDG/nbbYbTdOiUFV1dTgeZChtIeI0adsGDtxpXgkQgKthGPq+3/k77mX7DKmIxypoyZMswTOqqFiF0Wyb8ITrCWiosuKMDD+jJIriuU/EK6VmjdOEt9eurZsLCTrfbb9mhuErZgsPQwYDGH4K+9KH53g6UhQvUFRfam4TA/9XMvfMC3isZkjCdZgWsr2daznW4j+66P/D+dttRmXZJszcY7bVuQKTZimBEGZJ4FDb4VWDhGXz3sx82upbtLFbPMtDCYzm8QwjWSw+snBLOfKl4Z8lYT03+oZuaR61a20NjFpSSVQsKzl3+5i7ZTqgeP0LFD3ReIVXndUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"res\"\n        title=\"res\"\n        src=\"/static/eb6dc096a0510b40f77cfc659d047aeb/e05eb/res.png\"\n        srcset=\"/static/eb6dc096a0510b40f77cfc659d047aeb/5a46d/res.png 300w,\n/static/eb6dc096a0510b40f77cfc659d047aeb/e05eb/res.png 584w\"\n        sizes=\"(max-width: 584px) 100vw, 584px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ul>\n</blockquote>\n<p><a name=\"9e50c3f6\"></a></p>\n<h2 id=\"cookie-的-http-响应头部\" style=\"position:relative;\"><a href=\"#cookie-%E7%9A%84-http-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8\" aria-label=\"cookie 的 http 响应头部 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cookie 的 HTTP 响应头部</h2>\n<blockquote>\n<ul>\n<li>服务端通过在响应头中设置<strong>set-Cookie</strong>，设置 Cookie</li>\n<li>键值对，可以通过'[]'设置多个 cookie</li>\n<li>浏览器的下一次请求的时候会带上</li>\n<li>同域才能发送 cookie</li>\n<li>cookie 的属性：<br />|<strong>max-age</strong>和<strong>expires</strong>| 设置过期时间 |<br />|<strong>Secure</strong>|只能通过 https 发送|<br />|  <strong>HttpOnly</strong>|无法通过 document.cookie 或者其他脚本程序访问，防止 xrs 攻击  |</li>\n</ul>\n</blockquote>\n<p><a name=\"2bb7644c\"></a></p>\n<h2 id=\"connection（tcp-连接）的-http-响应头部\" style=\"position:relative;\"><a href=\"#connection%EF%BC%88tcp-%E8%BF%9E%E6%8E%A5%EF%BC%89%E7%9A%84-http-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8\" aria-label=\"connection（tcp 连接）的 http 响应头部 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connection（TCP 连接）的 HTTP 响应头部</h2>\n<blockquote>\n<ul>\n<li><strong>HTTP1.1</strong>一般只有 6 个 TCP 的并发链接,其他的连接会阻塞</li>\n<li><strong>Connection:'close'</strong>   没有长连接，在每一次请求完毕之后关闭 TCP 连接，有新请求时创建一个新的 TCP 连接</li>\n<li><strong>Connection:'keep-alive'</strong>   有长连接，在六个 TCP 连接中如果有一个连接完成数据传输，则将那个 TCP 连接给下一个请求用</li>\n</ul>\n</blockquote>\n<p><a name=\"8c43a26b\"></a></p>\n<h2 id=\"csp（-content-security-policy）的-http-响应头部\" style=\"position:relative;\"><a href=\"#csp%EF%BC%88-content-security-policy%EF%BC%89%E7%9A%84-http-%E5%93%8D%E5%BA%94%E5%A4%B4%E9%83%A8\" aria-label=\"csp（ content security policy）的 http 响应头部 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSP（ Content-Security-Policy:）的 HTTP 响应头部</h2>\n<blockquote>\n<p>作用：</p>\n<ol>\n<li>限制网页资源的获取（从哪里获取，请求发到什么地方）</li>\n<li>限制报告资源获取越权（当获取到不应该获取的资源时候，给网页一些报告）</li>\n</ol>\n</blockquote>\n<blockquote>\n<p>限制方式：</p>\n<ul>\n<li>defalut-src:(限制全局)<br />| http |   只能通过 http 进行加载|<br />|http https|只能通过 http 或者 https 进行加载|<br />| 'self' | 只能通过本域名的进行加载 |<br />|http.baidu.com|可以限定制定的网站进行加载|</li>\n<li>制定资源类型:<br />1.connet-src:请求发现的目标进行限制<br />2.img-src:图片可以从哪些网址加载<br />3.font-src:字体从哪里加载<br />4.script-src:脚本资源从哪里进行加载<br />..................网页可以从外部加载的都可以进行资源的限制</li>\n<li>.form-action   '\\self':对 form 表单提交的 action 进行限制</li>\n<li>report-uri  + 服务器的路径（可以向服务区提交加载错误的信息）</li>\n<li>Content-Security-Policy-Report-Only:（虽然检测到资源不想加载，但还是可以加载）<br />................</li>\n</ul>\n</blockquote>\n<p><a name=\"5a32a534\"></a></p>\n<h2 id=\"数据协商：客户端和服务端协商声明所需要的数据类型（以下是-http-请求头部）\" style=\"position:relative;\"><a href=\"#%E6%95%B0%E6%8D%AE%E5%8D%8F%E5%95%86%EF%BC%9A%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8D%8F%E5%95%86%E5%A3%B0%E6%98%8E%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%EF%BC%88%E4%BB%A5%E4%B8%8B%E6%98%AF-http-%E8%AF%B7%E6%B1%82%E5%A4%B4%E9%83%A8%EF%BC%89\" aria-label=\"数据协商：客户端和服务端协商声明所需要的数据类型（以下是 http 请求头部） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>数据协商：客户端和服务端协商声明所需要的数据类型（以下是 HTTP 请求头部）</h2>\n<blockquote>\n<ul>\n<li>Accept:浏览器能够处理的 MIME 类型</li>\n<li>Accept-Charset:浏览器能够显示的字符编码</li>\n<li>Accept-Encoding:浏览器能够处理的压缩编码</li>\n<li>Accept-Language:浏览器当前设置的语言</li>\n<li>Connection:浏览器与服务器之间连接的类型</li>\n<li>Cookie:当前页面设置的任何 cookie</li>\n<li>Host:发出请求页面所在的域</li>\n<li>Referer:发出请求页面的 URI</li>\n<li>User-Agent:浏览器的用户代理字符串</li>\n</ul>\n</blockquote>\n<p><br />延伸阅读：<br />CSP 扩展：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP\">CSP 内容安全策略</a><br />HTTPS（图解 HTTPS，写的挺好的博客）：<a href=\"https://blog.csdn.net/forezp/article/details/89666603\">HTPPS</a><br />HTTP2：<a href=\"https://juejin.im/post/5b88a4f56fb9a01a0b31a67e\">HTTP2 网络质和量的提升</a></p>"},{"id":"930e25a1-7f60-5290-844c-2605d687279f","headings":[{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"react 高亮显示关键词","path":"/gatsby-antd","tags":["React"],"excerpt":"react 高亮显示关键词，不用库，原生显示","created":"2021-02-20 21:45","createdPretty":"20 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"20 February, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQozwEZA+b8ACgTGkcuL15GQUItMjgkLUUvMjgjJ0MnKV06NXdUSJZzY6qMe6uRgpV2ZY1tXYNkWHBPRnJSSV8+Ol0/QAAxGR1DKihcQj41HyMuGyJELCxBJyhOMC5oRTyHZlmmh3ioi3i5oZGXeWaAXk5xUEdmRj9xUEdjQTtXNzYAOh8fPSIjPiEkNh4iOCImRCorOiAlVDUycEs9qYt70LmpqIt5ood3im1ce1pPakhBXj45Xz86YT86Ti8wADUZHkUkI0YlJTQbIT8lKE0vLzsgJlc2MoVeTMOol8arnKOEdpByZoFgU39cUGRCPFc3NFQ1NFM0Mlk3NAA8Gh9AHiJFIiU5HSJDJilPLy5CJShZNzKHY1bPtafMsaShhHmMal15U0d4UkdhPjdXNzNVNTNRLy9TMTIAPxofOxsfQSAjOB0iSSkqTSwsSSkrZUE7hmRZtJmRrpWPlXZqdlJIcExCdlFGWzg1SSstRyktRSYpVC0tAFIqKkAgIkEiIzogI08uLUQmKz4gJVw3L41qW7WbhLGYgo5rXWJAOWNAPGZAO1AtLzsfJjwhKD0gJ04mKAB6TDN9Tz52Sz5WMi1aOCdpRCpzUDuefW7Kp4a2m1m7oWWujXZ6WE1ZOTJIKyhKLCxQLzBIKi5KKi1RLy8AaEIuek8zfk8vek00fVpMsZJ55cOr17OTo4ZOn4ZFmIA+gmk5tZN5yKeTlnZiclI9SSwmSSspUTAvRCYoAFg1JG9HM6B1XdawmPneyP/m0uC8l8ymW9e0ZeLBceG/btO0Z7eWXtOvkvHKr9OrjqJ6ZYJYS1QwLysWHwCjd2LSpovsxqnyz7Hwx6jGnHqbdz20kknDn1POqljbtmDKpFSbfD1vUDCFYU+cc2GLZFhqSUdDKC8kER4AvI1zypx+v5FzsIJoh19LXD8nZkoqb1AxdlgxeFkwknE5nns8fV4wZEcrSi8lUjU1NiArLxsoXEBBhGNaAHlOQ5ZpVZFjUFs4MTUfGkYwIVQ6I0kxI0oyJEIqIz8pIE0zJFQ3JzIfICUXHhwQGi8bI4FeVaiAbp54Z2aDFUbWy7m4AAAAAElFTkSuQmCC","aspectRatio":1.5060240963855422,"src":"/static/133cf3c23846178c742207aa20a64dab/0853f/tree.png","srcSet":"/static/133cf3c23846178c742207aa20a64dab/14156/tree.png 125w,\n/static/133cf3c23846178c742207aa20a64dab/d6e47/tree.png 250w,\n/static/133cf3c23846178c742207aa20a64dab/0853f/tree.png 500w,\n/static/133cf3c23846178c742207aa20a64dab/ce627/tree.png 750w,\n/static/133cf3c23846178c742207aa20a64dab/9dbcf/tree.png 1000w,\n/static/133cf3c23846178c742207aa20a64dab/87046/tree.png 1920w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<h2 id=\"正则表达式转义，你会用到的\" style=\"position:relative;\"><a href=\"#%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BD%AC%E4%B9%89%EF%BC%8C%E4%BD%A0%E4%BC%9A%E7%94%A8%E5%88%B0%E7%9A%84\" aria-label=\"正则表达式转义，你会用到的 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>正则表达式转义，你会用到的</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 正则特殊字符转义</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> escapeRegexp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>string <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  <span class=\"token function\">String</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\^$*+?.()|[\\]{}]</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\\\\$&amp;\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"针对关键词进行高亮\" style=\"position:relative;\"><a href=\"#%E9%92%88%E5%AF%B9%E5%85%B3%E9%94%AE%E8%AF%8D%E8%BF%9B%E8%A1%8C%E9%AB%98%E4%BA%AE\" aria-label=\"针对关键词进行高亮 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>针对关键词进行高亮</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> escapeRegexp <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"Utils/string\"</span>\n\n<span class=\"token comment\">// 针对关键词进行高亮</span>\n<span class=\"token comment\">// 正则匹配有可能会涉及到特定字符</span>\n<span class=\"token comment\">// targetVal 要高亮的目标字符串</span>\n<span class=\"token comment\">// 高亮关键词</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">hightLight</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">targetVal<span class=\"token punctuation\">,</span> highLightValue</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n  <span class=\"token keyword\">let</span> hasHighLight <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n  hasHighLight <span class=\"token operator\">=</span> highLightValue<span class=\"token punctuation\">.</span><span class=\"token function\">some</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token function\">escapeRegexp</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"i\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 不区分大小写</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>targetVal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>hasHighLight<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;span style=\"color:black;background:#f6e58d\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>targetVal<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    res <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>targetVal<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> res\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"针对字符串进行高亮\" style=\"position:relative;\"><a href=\"#%E9%92%88%E5%AF%B9%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9B%E8%A1%8C%E9%AB%98%E4%BA%AE\" aria-label=\"针对字符串进行高亮 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>针对字符串进行高亮</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 根据搜索条件替换字符串关键词高亮标签</span>\n<span class=\"token comment\">// 针对长字符串的高亮显示</span>\n<span class=\"token comment\">// 返回的数组可以用React.createElement('pre',null,stringReplaceMark(targetVal,highLighValue))</span>\n<span class=\"token function-variable function\">stringReplaceMark</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">targetVal<span class=\"token punctuation\">,</span> highLightValue</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> replaceVal <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>highLightValue<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> highLightValue<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    highLightValue<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token function\">escapeRegexp</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"i\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token comment\">// 高亮替换的字符</span>\n      <span class=\"token keyword\">const</span> isReplaced <span class=\"token operator\">=</span> targetVal<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> targetVal<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span>\n      <span class=\"token comment\">// 将字符串从高亮的位置切割成数组，好用上面的isReplaced插入到数组的分割空位中</span>\n      <span class=\"token keyword\">const</span> replaceArr <span class=\"token operator\">=</span> targetVal<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> length <span class=\"token operator\">=</span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>replaceArr<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> replaceArr<span class=\"token punctuation\">.</span>length\n      replaceArr<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item<span class=\"token punctuation\">,</span> index</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        replaceVal<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 在空位插入高亮标签，不在最后插入</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index <span class=\"token operator\">!==</span> length <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> isReplaced<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          replaceVal<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>span style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> color<span class=\"token operator\">:</span> <span class=\"token string\">\"black\"</span><span class=\"token punctuation\">,</span> background<span class=\"token operator\">:</span> <span class=\"token string\">\"#f6e58d\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n              <span class=\"token punctuation\">{</span>isReplaced<span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    replaceVal<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>targetVal<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> replaceVal\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><br />推荐：<br /></p>\n<ul>\n<li><a href=\"https://github.com/benjamingr/RegExp.escape\">正则转义相关地址</a></li>\n</ul>"},{"id":"e5837e5a-27ad-52d2-8124-ef093d70df6e","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"Gatsby配置antd","path":"/gatsby-antd","tags":["Gatsby"],"excerpt":"想试试Gatsby配置antd吗？.","created":"2021-02-20 21:45","createdPretty":"20 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"20 February, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADDklEQVQozyWS62/TZhSH/W9Amzixnfhuv3Ziv3ZSx04cN6FNaEsaVDEUiYIoUztpQ+rQAK2MbdyvgYAIEKCIcmnSbKTtUlqpodAVWjah0glpH4aQ+ALij5infTk60tHzO0dHD+LB0Xxv7sfRw/dL155O/fJ7o9Gq1Rcnq0+rk8v12uKjR6vTjddP5tZmp188/nXfrt3eAEZxAYL0ezAP4g9iI4O76zdvrcw0XjZn1540X80311vzK43HU+Xrrxdm7xTP//TdgbFv9w/v2SXKAKdwhgtiAV+b34MwLHn06/0PiqXntdqr2ZmNxYW/l1sf/lz954/62sLJd6ut8pljo1996diGFVMJGhfFoCpTfgLdhHoQWWJvHjlSPXe2euHc3I3y4vit1dq9jd/q7188/Lxx903zwVBhoCeT6rSNZBySDL7FBF3xkNts8rUjmsKN7By4c2xspnR6qVJcGS8tVS6uTZTWq9ffTFXeNipDX/QJIqVBXpZZIwIGt1m9jkrS2GYXjmmCj8QEwHU75nAhP37iwPrkpZd3T/1VPf926uy76WKz/EM+68gSk07AfLcxMuDk0zr9P2zrAs2SrMDQPAkkzojIM1cPfn5e/rh05dPy5Y/PipXjw3FDEQE9uL27Mw739tuFbASGSCKAIgbkePcqDaRsPZuKOpY6uqe3NfH93O1Dy7Wx989+PvpNvyiwLBfcmetKJyKDvbFCBnYolMDjiBpiXNi2lK6kFtHFWIdUyKXCiuTYZtzUcz1WX8ZSFMAJVCKmRnXZMUBPQqYY3Ed4ETeSE0io8kYUqCqXMMPZVAcPWC0SVjVZlLikFe1OW4JIh0O8DgFU2M4Y8Ad9ba4kKOEL0Lgc4t1UCIWIBhxT7cukdvRvSztGNm3mtjqddocImFBYVFUgySxUGH/At9nnQdoxbzvmISjMHUsyoyp8V1JPxqOWqSsQuNWORzNp04opiiLSHBmgCYLEvDj637ddy9r8XpRAXekoLggkxrFg3NQglEFIBDIfVsVU0kiYihzmXTfb/R4vgbqIu/lfBW8J6zAaKoIAAAAASUVORK5CYII=","aspectRatio":1.5060240963855422,"src":"/static/30f8dd521a640f8b2bb6aabf077ebb50/0853f/sweet.png","srcSet":"/static/30f8dd521a640f8b2bb6aabf077ebb50/14156/sweet.png 125w,\n/static/30f8dd521a640f8b2bb6aabf077ebb50/d6e47/sweet.png 250w,\n/static/30f8dd521a640f8b2bb6aabf077ebb50/0853f/sweet.png 500w,\n/static/30f8dd521a640f8b2bb6aabf077ebb50/ce627/sweet.png 750w,\n/static/30f8dd521a640f8b2bb6aabf077ebb50/9dbcf/sweet.png 1000w,\n/static/30f8dd521a640f8b2bb6aabf077ebb50/87046/sweet.png 1920w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<blockquote>\n<p>相信国内的 react 用户都是 antd 的忠实爱好者，此教程实践可行</p>\n</blockquote>\n<h2 id=\"首先安装必须的-npm-包\" style=\"position:relative;\"><a href=\"#%E9%A6%96%E5%85%88%E5%AE%89%E8%A3%85%E5%BF%85%E9%A1%BB%E7%9A%84-npm-%E5%8C%85\" aria-label=\"首先安装必须的 npm 包 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>首先安装必须的 npm 包</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install --save gatsby-plugin-antd less less-loader babel-plugin-import</code></pre></div>\n<h2 id=\"将以下代码添加到-gatsby-nodejs-中\" style=\"position:relative;\"><a href=\"#%E5%B0%86%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%E6%B7%BB%E5%8A%A0%E5%88%B0-gatsby-nodejs-%E4%B8%AD\" aria-label=\"将以下代码添加到 gatsby nodejs 中 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>将以下代码添加到 gatsby-node.js 中</h2>\n<ul>\n<li>babel-plugin-import 配置 antd 按需加载组件</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreateBabelConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> actions <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  actions<span class=\"token punctuation\">.</span><span class=\"token function\">setBabelPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">\"babel-plugin-import\"</span><span class=\"token punctuation\">,</span>\n    options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      libraryName<span class=\"token operator\">:</span> <span class=\"token string\">\"antd\"</span><span class=\"token punctuation\">,</span>\n      style<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"将以下代码添加到-gatsby-configjs-的插件组中\" style=\"position:relative;\"><a href=\"#%E5%B0%86%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%E6%B7%BB%E5%8A%A0%E5%88%B0-gatsby-configjs-%E7%9A%84%E6%8F%92%E4%BB%B6%E7%BB%84%E4%B8%AD\" aria-label=\"将以下代码添加到 gatsby configjs 的插件组中 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>将以下代码添加到 gatsby-config.js 的插件组中</h2>\n<ul>\n<li>modifyVars 可自行修改 antd 的样式</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\n    resolve: &quot;gatsby-plugin-antd&quot;,\n    options: {\n      style: true,\n    },\n},\n{\n    resolve: `gatsby-plugin-less`,\n    options: {\n      modifyVars: {\n          &quot;primary-color&quot;: &quot;#da3043&quot;,\n          &quot;font-family&quot;: &quot;Arial&quot;,\n          &quot;layout-body-background&quot;: &quot;#66ff79&quot;,\n      },\n      lessOptions: {\n          javascriptEnabled: true,\n      },\n    },\n}</code></pre></div>\n<h2 id=\"-最后一起康康我的-packagejson-吧\" style=\"position:relative;\"><a href=\"#-%E6%9C%80%E5%90%8E%E4%B8%80%E8%B5%B7%E5%BA%B7%E5%BA%B7%E6%88%91%E7%9A%84-packagejson-%E5%90%A7\" aria-label=\" 最后一起康康我的 packagejson 吧 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🤔 最后一起康康我的 package.json 吧</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  &quot;dependencies&quot;: {\n    &quot;antd&quot;: &quot;^4.12.3&quot;,\n    &quot;babel-plugin-import&quot;: &quot;^1.13.3&quot;,\n    &quot;gatsby&quot;: &quot;^2.32.3&quot;,\n    &quot;gatsby-image&quot;: &quot;^2.11.0&quot;,\n    &quot;gatsby-plugin-antd&quot;: &quot;^2.2.0&quot;,\n    &quot;gatsby-plugin-feed&quot;: &quot;^2.13.0&quot;,\n    &quot;gatsby-plugin-google-analytics&quot;: &quot;^2.11.0&quot;,\n    &quot;gatsby-plugin-less&quot;: &quot;^4.7.0&quot;,\n    &quot;gatsby-plugin-manifest&quot;: &quot;^2.12.0&quot;,\n    &quot;gatsby-plugin-offline&quot;: &quot;^3.10.0&quot;,\n    &quot;gatsby-plugin-react-helmet&quot;: &quot;^3.10.0&quot;,\n    &quot;gatsby-plugin-sharp&quot;: &quot;^2.14.1&quot;,\n    &quot;gatsby-remark-copy-linked-files&quot;: &quot;^2.10.0&quot;,\n    &quot;gatsby-remark-images&quot;: &quot;^3.11.0&quot;,\n    &quot;gatsby-remark-prismjs&quot;: &quot;^3.13.0&quot;,\n    &quot;gatsby-remark-responsive-iframe&quot;: &quot;^2.11.0&quot;,\n    &quot;gatsby-remark-smartypants&quot;: &quot;^2.10.0&quot;,\n    &quot;gatsby-source-filesystem&quot;: &quot;^2.11.0&quot;,\n    &quot;gatsby-transformer-remark&quot;: &quot;^2.16.0&quot;,\n    &quot;gatsby-transformer-sharp&quot;: &quot;^2.12.0&quot;,\n    &quot;less&quot;: &quot;^4.1.1&quot;,\n    &quot;less-loader&quot;: &quot;^8.0.0&quot;,\n    &quot;prismjs&quot;: &quot;^1.22.0&quot;,\n    &quot;react&quot;: &quot;^16.12.0&quot;,\n    &quot;react-dom&quot;: &quot;^16.12.0&quot;,\n    &quot;react-helmet&quot;: &quot;^5.2.1&quot;,\n    &quot;typeface-merriweather&quot;: &quot;0.0.72&quot;,\n    &quot;typeface-montserrat&quot;: &quot;0.0.75&quot;\n  },\n  &quot;devDependencies&quot;: {\n    &quot;gh-pages&quot;: &quot;^3.1.0&quot;,\n    &quot;prettier&quot;: &quot;2.2.1&quot;\n  },</code></pre></div>"},{"id":"1d58f57f-1d9f-596b-ad1f-9f1e410012a8","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"前端大屏可视化","path":"/visualization","tags":["Echarts"],"excerpt":"从零开始的基于echarts的可视化大屏开发.","created":"2021-02-20 21:45","createdPretty":"20 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"20 February, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAciUTlDCi//EABkQAAEFAAAAAAAAAAAAAAAAAAEAAhARMf/aAAgBAQABBQINFI7P/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhAAAQUBAAAAAAAAAAAAAAAAAQARICIxMv/aAAgBAQAGPwIXGOuo/wD/xAAbEAACAgMBAAAAAAAAAAAAAAAAAREhEDFRYf/aAAgBAQABPyF5ltng0uCsJnL2f//aAAwDAQACAAMAAAAQ3w//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QTZv/xAAXEQADAQAAAAAAAAAAAAAAAAABEBEh/9oACAECAQE/EJpX/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARQSExcdH/2gAIAQEAAT8QABcI6M9+QI09AlGxXDg0h1MnZP/Z","aspectRatio":2.232142857142857,"src":"/static/b57b22b6622b0c15a7547a6516702a5b/ba9ae/echarts.jpg","srcSet":"/static/b57b22b6622b0c15a7547a6516702a5b/86d0f/echarts.jpg 125w,\n/static/b57b22b6622b0c15a7547a6516702a5b/520da/echarts.jpg 250w,\n/static/b57b22b6622b0c15a7547a6516702a5b/ba9ae/echarts.jpg 500w,\n/static/b57b22b6622b0c15a7547a6516702a5b/72227/echarts.jpg 750w,\n/static/b57b22b6622b0c15a7547a6516702a5b/5c39c/echarts.jpg 1000w,\n/static/b57b22b6622b0c15a7547a6516702a5b/e2de3/echarts.jpg 1280w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<h2 id=\"技术栈\" style=\"position:relative;\"><a href=\"#%E6%8A%80%E6%9C%AF%E6%A0%88\" aria-label=\"技术栈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>技术栈</h2>\n<blockquote>\n<p>可视化技术栈：react，echarts，react-for-echarts，sass</p>\n</blockquote>\n<p><a name=\"3gFyR\"></a></p>\n<h2 id=\"开始布局啦！\" style=\"position:relative;\"><a href=\"#%E5%BC%80%E5%A7%8B%E5%B8%83%E5%B1%80%E5%95%A6%EF%BC%81\" aria-label=\"开始布局啦！ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>开始布局啦！</h2>\n<hr>\n<ol>\n<li>设置项目的最小宽度 min-width,确保项目不会过于小导致布局混乱</li>\n<li>横向自适应宽度：采用 ant-design 的栅栏布局</li>\n<li>\n<p>纵向自适应高度，我一开始采用的是 rem 的适应方案，可是发现有如下问题</p>\n<ul>\n<li>rem 方案使用的是<a href=\"https://www.njleonzhang.com/2018/08/15/flexible-pc-full-screen.html\">这篇文章的方案</a>，大家可以看看工程运用那里，我关于 rem 的计算方案并不是采用的该文章的方法，如果你使用的是 vscode，那有款 cssrem 的插件很适合你</li>\n<li>会修改根元素的 font-size，容易导致项目的其他页面字体大小有问题（可通过修改 document.body.fontSize 来解决）</li>\n<li>如果放在大屏上，比如分辨率为 1920*1080 以上，屏幕下方会留白（对 rem 方案的不熟练）</li>\n</ul>\n</li>\n<li>于是，我采用的是 vh 的方案，查看<a href=\"https://caniuse.com/?search=vh\">caniuse</a>，发现兼容性还不错</li>\n</ol>\n<p><a name=\"IF4ph\"></a></p>\n<h2 id=\"可视化组件的背景图片\" style=\"position:relative;\"><a href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%BB%84%E4%BB%B6%E7%9A%84%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87\" aria-label=\"可视化组件的背景图片 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>可视化组件的背景图片</h2>\n<hr>\n<h3 id=\"svg-作为背景图片带来的坑\" style=\"position:relative;\"><a href=\"#svg-%E4%BD%9C%E4%B8%BA%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%9D%91\" aria-label=\"svg 作为背景图片带来的坑 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>svg 作为背景图片带来的坑</h3>\n<p>一开始 ued 给我的切的 svg，也没做过可视化，不太懂，也是欣然接受并使用的 svg 作为背景图片，可是发现调整屏幕的分辨率，组件自适应了，但是背景图却有问题，<b>高度和宽度一致是按照一定比例来缩放的。后来发现原来这是 svg 的特性，怪不得很适合用来做 icon。</p>\n<h3 id=\"于是改变背景图方案\" style=\"position:relative;\"><a href=\"#%E4%BA%8E%E6%98%AF%E6%94%B9%E5%8F%98%E8%83%8C%E6%99%AF%E5%9B%BE%E6%96%B9%E6%A1%88\" aria-label=\"于是改变背景图方案 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>于是改变背景图方案</h3>\n<p>使用了<a href=\"https://cloudconvert.com/svg-to-png\">svg-to-png</a>，采用 png 来设置背景图片，并通过调整 css 来实现背景图片覆盖整个组件,完美的实现了背景图跟随组件自适应。</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@mixin</span> <span class=\"token function\">background</span><span class=\"token punctuation\">(</span>$urlImg<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background-image</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span>$urlImg<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-size</span><span class=\"token punctuation\">:</span> 100% 100%<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-repeat</span><span class=\"token punctuation\">:</span> no-repeat<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"z2ibq\"></a></p>\n<h2 id=\"世界地图并实现地图下钻\" style=\"position:relative;\"><a href=\"#%E4%B8%96%E7%95%8C%E5%9C%B0%E5%9B%BE%E5%B9%B6%E5%AE%9E%E7%8E%B0%E5%9C%B0%E5%9B%BE%E4%B8%8B%E9%92%BB\" aria-label=\"世界地图并实现地图下钻 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>世界地图并实现地图下钻</h2>\n<hr>\n<ol>\n<li>\n<p>首先得把世界地图和各个国家的地图找到，这是一个很庞大的工作。而且以前的地图和现在的地图并非一致，请合理使用（毕竟地球的板块是在不断的运动中的）。</p>\n<ul>\n<li><a href=\"http://datav.aliyun.com/tools/atlas/#&#x26;lat=30.332329214580188&#x26;lng=106.72278672066881&#x26;zoom=3.5\">中国->国、省、市地图 Json</a>（由于有 datav 官方维护，地图数据新）</li>\n<li><a href=\"https://hxkj.vip/demo/echartsMap/\">中国->省、市、区/县地图 Json</a>（地图数据新）</li>\n<li><a href=\"https://github.com/pissang/starbucks/tree/gh-pages/json\">世界->各个国家的地图 Json（包括世界地图）</a>(地图数据旧)</li>\n<li><a href=\"https://geojson-maps.ash.ms/\">世界->各个国家的地图 Json（不包括世界地图）</a>（地图数据较新）</li>\n<li><a href=\"https://img.hcharts.cn/mapdata/\">全世界地图数据集</a>（只更新到了 2015 年的数据）</li>\n<li><a href=\"http://geojson.io/#map=2/20.0/0.0\">当你找到 json 的地图，放上来看看是否一致</a>（权威地图，地图数据新）</li>\n<li>如果不懂 geoJson 规范，可看<a href=\"https://www.oschina.net/translate/geojson-spec\">GeoJSON 格式规范说明</a></li>\n</ul>\n</li>\n<li>找到了地图 json，下钻实现</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 获取地图json注册地图</span>\n<span class=\"token comment\">// map为json所对应的名称（比如：世界地图为world,中国地图为China）</span>\n<span class=\"token function-variable function\">registerMap</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">map</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 由于json是存在静态资源中的</span>\n  <span class=\"token keyword\">const</span> path_env <span class=\"token operator\">=</span>\n    process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"development\"</span>\n      <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/public/json/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>map<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.json</span><span class=\"token template-punctuation string\">`</span></span>\n      <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/assets/public/json/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>map<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.json</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span>path_env<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      echarts<span class=\"token punctuation\">.</span><span class=\"token function\">registerMap</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"world\"</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">finally</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 使用的是echarts-for-react，this.echartsReact获取到的是该图表实例</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>echartsReact<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">\"restore\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"OmSJq\"></a></p>\n<h2 id=\"词云\" style=\"position:relative;\"><a href=\"#%E8%AF%8D%E4%BA%91\" aria-label=\"词云 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>词云</h2>\n<blockquote>\n<p>我采用的库是<a href=\"https://github.com/mcc108/TagCloud#readme\">TagCloud</a>,同事推荐的一个小巧，可定制的库，挺好用的。</p>\n</blockquote>\n<p><a name=\"vtI9Q\"></a></p>\n<h2 id=\"自定义一个时钟\" style=\"position:relative;\"><a href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%97%B6%E9%92%9F\" aria-label=\"自定义一个时钟 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>自定义一个时钟</h2>\n<blockquote>\n<ol>\n<li>使用一个组件来显示时钟，保证时钟的渲染在该组件内进行，不影响其他组件</li>\n<li>字体样式采用免费可商用的<a href=\"https://www.uisdc.com/uisdc-first-free-font\">「优设标题黑」</a></li>\n</ol>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> PureComponent <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> dayjs <span class=\"token keyword\">from</span> <span class=\"token string\">\"dayjs\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DataVisual</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">PureComponent</span> <span class=\"token punctuation\">{</span>\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    time<span class=\"token operator\">:</span> <span class=\"token function\">dayjs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YYYY.MM.DD HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  timer <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n\n  <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        time<span class=\"token operator\">:</span> <span class=\"token function\">dayjs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"YYYY.MM.DD HH:mm:ss\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">componentWillUnmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>timer<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> display<span class=\"token operator\">:</span> <span class=\"token string\">\"inline-block\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"2QaXU\"></a></p>\n<h2 id=\"使用font-face\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8font-face\" aria-label=\"使用font face permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用@font-face</h2>\n<blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/@font-face\">MDN</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@font-face</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> electronicNumber<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">src</span><span class=\"token punctuation\">:</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font/DS-DIGI-1.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font//DS-DIGIB-2.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font//DS-DIGII-3.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">,</span> <span class=\"token url\"><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token string url\">\"./font/DS-DIGIT-4.ttf\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.myFontFace</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> electronicNumber<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a name=\"suEmG\"></a></p>\n<h2 id=\"使用media（设置响应式）\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8media%EF%BC%88%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E5%BC%8F%EF%BC%89\" aria-label=\"使用media（设置响应式） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用@media（设置响应式）</h2>\n<blockquote>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media\">MDN</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@mixin</span> <span class=\"token function\">screenMedia</span><span class=\"token punctuation\">(</span>$fontSize<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n  // 如果小于1440px，则font-size生效\n  // <span class=\"token property\">同理min-width</span><span class=\"token punctuation\">:</span>1440px，如果大于1440px，则font-size生效\n  <span class=\"token atrule\"><span class=\"token rule\">@media</span> screen <span class=\"token keyword\">and</span> <span class=\"token punctuation\">(</span><span class=\"token property\">max-width</span><span class=\"token punctuation\">:</span> 1440px<span class=\"token punctuation\">)</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">font-size</span><span class=\"token punctuation\">:</span> $fontSize<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.mymMedia</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token atrule\"><span class=\"token rule\">@include</span> <span class=\"token function\">screenMedia</span><span class=\"token punctuation\">(</span>20px<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"最后\" style=\"position:relative;\"><a href=\"#%E6%9C%80%E5%90%8E\" aria-label=\"最后 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>最后</h2>\n<blockquote>\n<p>文章针对前端可视化的大屏展示，根据需求来完善文章，欢迎各位大佬评论哦。<br/>\n如果有需要修改文章的内容，我会改进。<br/>\n附上一张性能图片，没做这方面的优化。<br/> > <a href=\"https://juejin.im/post/6844903552070975495\">使用 chrome performance 查看页面性能</a> <br> > <a href=\"https://web.dev/rail/#goals-and-guidelines\">著名的 RAIL model</a></p>\n</blockquote>"},{"id":"b7b05ae4-f8d0-56db-ad71-47d36764786f","headings":[{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"通过a标签同源和跨域下载服务器文件","path":"/download","tags":["Download"],"excerpt":"通过a标签同源和跨域下载服务器文件.","created":"2021-02-20 21:45","createdPretty":"20 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"20 February, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADmklEQVQozw3N2VMadwDA8d/CIoiCyqGJUdQk6lBtm2Smk2nsGKNJvAJRUaygMYJFQAW5bzYCsosgqJwSWREFNFbJ2VGZTNpJm+ShM+lD+//Ut+/T5wuSSGPGXbuPteeCd7fdzSnPtby/7VWw6X2UcbZZ8quPlkLYQUPtppmZc5aeotQvG1V/R5pO0bZztA24lq571JxsRP7144fDyFjY2VA8DhciXVmMtYexMr6rKXd71N6acNSc+0s/r1P/SdR8jTWco83v0BZgVlQbZ9nH+LMvxXfFoxBm4Lx9kX6Dy/ZDnUns2+deLu65ueX8JmFl/obBfwXB72s1xVXuWw/3bLURGFUtiGUo4hW/L2T/PC1kYsaDvXR+L5PP4NntcG6tA3dfizkbAhoybiacLINdCzVnaz5xcl+v1IO5aYbTzMsmPa9zyY9v8me4/Y/oyMmmMhxNZbawE/+VI5S942ZGjXDGQswipIvY1rF3DY3bpjowOUYd5QOHnnt+jAfMw+ticCiB/rWCT6Gu9MrNIzd45aflvJW4g5oyV+w46XEbJa5nhBZY/gU6EPLLBPxSiYiy4XlkXRgYuw3U96n56ZL/EFAI3DmMaXMJJBvTx+2MqPly0lEdtVJCWuaynGaXwQBTfWdT3tAruAszbP+zJ4I+bm87MPbCRTWhsCkPBhPoim89sPbc9xDVMzBTlXORYldUmOaYS0/J4KVvcN/Tv2K4Y1C0nh6lXuxsScd+lHbT4rPlqaA+Ho2v+VD/sjaAdOvmYYuaqp2jG2Rso6xONc0GBaz3YHUgifboFU1Dg5fSYenLzLrXykuHtHjItBsL5LfjeNiDGG8syYFDRzKpyrUKtkrCkAhZwDbb5FC1uqzXh3llo4/L5ZILnuXWlfgdHfiGPoQIN1xjWwG5U9tsWqRgDorLSrdpOepfasf5FUA0ShULaQIBsauTrJTUz4jLHfOkHQfRNANU0mpkqcWuarQuVNlUdS4DO+SmYQgd0V/SSDniISYYH4EG+uD7PdS+HopIUNl9FxL0A83PxCkepJikhqycLFZ+gBK8Ojqiq3RbYYsONskZmsnLU48vzvyye53EH24ReL0E4RD0qBe+10HquA3d+h7wHpAjFtZnHP6UAH4tUSMnLiogmRRSTVNko7ThhyQg6KNMjJC7foIFfEijJC3r6ufFVyZ4ZNFQyeADWDkO8nYoZyGoRQT5FDQ/R1DIoaciaGKYMNhP+B/mm1rnL6s4ygAAAABJRU5ErkJggg==","aspectRatio":1.3297872340425532,"src":"/static/24ad03741385d8cca4ad09d32942ecd9/0853f/download.png","srcSet":"/static/24ad03741385d8cca4ad09d32942ecd9/14156/download.png 125w,\n/static/24ad03741385d8cca4ad09d32942ecd9/d6e47/download.png 250w,\n/static/24ad03741385d8cca4ad09d32942ecd9/0853f/download.png 500w,\n/static/24ad03741385d8cca4ad09d32942ecd9/ce627/download.png 750w,\n/static/24ad03741385d8cca4ad09d32942ecd9/9dbcf/download.png 1000w,\n/static/24ad03741385d8cca4ad09d32942ecd9/87046/download.png 1920w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<h2 id=\"同源下载推荐\" style=\"position:relative;\"><a href=\"#%E5%90%8C%E6%BA%90%E4%B8%8B%E8%BD%BD%E6%8E%A8%E8%8D%90\" aria-label=\"同源下载推荐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>同源下载(推荐)</h2>\n<ul>\n<li>优点是：通过浏览器的默认行为下载，不会阻塞</li>\n<li>缺点是：必须是同源下载，不过现在都是 webpack 和 nignx 代理，所以推荐这种下载方式</li>\n<li>简单说说：如果响应头添加 <code class=\"language-text\">Content-Disposition</code>，可不使用 <code class=\"language-text\">download</code>，两者都可以阻止浏览器默认打开文件，而不是下载文件的行为，但是前者优先级比后者高</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 从远程url下载文件(同源)\n * @param {string} url -远程的url和参数\n * @param {string} filename -下载到本地的文件名\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">downLoadFile</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> filename<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> origin <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/api/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">const</span> aLink <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span>\n  aLink<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span>\n  aLink<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> origin\n  aLink<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> filename\n  aLink<span class=\"token punctuation\">.</span>target <span class=\"token operator\">=</span> <span class=\"token string\">\"_black\"</span>\n  aLink<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">\"application/octet-stream\"</span> <span class=\"token comment\">// 让浏览器知道是二进制</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>aLink<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 如果不挂载到body上，火狐浏览器会失效</span>\n  aLink<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>aLink<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"跨域下载\" style=\"position:relative;\"><a href=\"#%E8%B7%A8%E5%9F%9F%E4%B8%8B%E8%BD%BD\" aria-label=\"跨域下载 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>跨域下载</h2>\n<ul>\n<li>缺点是：要等 blob 封装完成才能下载，如果想实现前端流式下载，可参考<a href=\"https://segmentfault.com/a/1190000021367378\">fetch 方法</a></li>\n<li>优点是：可以携带 Cookie 和请求体 实现动态下载</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 获取 blob\n * @param {string} url -目标文件地址\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getBlob</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    xhr<span class=\"token punctuation\">.</span>responseType <span class=\"token operator\">=</span> <span class=\"token string\">\"blob\"</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 下载blob工具函数\n * @param {string} blob -文件流\n * @param {string} filename -下载的文件名\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">saveAs</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">blob<span class=\"token operator\">:</span> Blob<span class=\"token punctuation\">,</span> filename<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>msSaveOrOpenBlob<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    navigator<span class=\"token punctuation\">.</span><span class=\"token function\">msSaveBlob</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> anchor <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span>\n    anchor<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span>\n    anchor<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> filename\n\n    anchor<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span>\n    body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>anchor<span class=\"token punctuation\">)</span>\n\n    anchor<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>anchor<span class=\"token punctuation\">)</span>\n\n    window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>anchor<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 用户调用的下载函数\n * @param {string} url -目标文件地址（跨域）\n * @param {string} newFilename -想要保存的文件名称\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">download</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> newFilename<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> blob<span class=\"token operator\">:</span> Blob <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getBlob</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">saveAs</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">,</span> newFilename<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://juejin.im/post/6844903763359039501\">一个很全面的实现前端文件下载的博客</a></li>\n<li><a href=\"https://juejin.im/post/6844904069958467592\">前端下载文件的 5 中方法对比</a></li>\n<li><a href=\"https://www.npmjs.com/package/jszip\">前端 zip 压缩文件/文件夹并下载到本地</a></li>\n</ul>"},{"id":"31fe1a76-fd5b-5be5-9451-35ec236efa7f","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"Creating content","path":"/creating-content","tags":["Theme"],"excerpt":"How to create pages, posts and manage tags.","created":"2019-07-21T00:00:00.000Z","createdPretty":"21 July, 2019","updated":"2019-07-21T00:00:00.000Z","updatedPretty":"21 July, 2019","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABAv/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAEnRdhEGP/EABoQAQADAAMAAAAAAAAAAAAAAAEAAhIDISL/2gAIAQEAAQUC0tNedMqdcaxus//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABoQAQEAAgMAAAAAAAAAAAAAAAEAEBEyYYH/2gAIAQEABj8C27epLgvkxj//xAAaEAACAwEBAAAAAAAAAAAAAAAAAREhQTGh/9oACAEBAAE/IUqtW3DGKw3NE1Td1CI5VuDCZ9P/2gAMAwEAAgADAAAAEG8f/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAEDAQE/ELiv/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8QiP/EABwQAQACAgMBAAAAAAAAAAAAAAEAESFBMWFxwf/aAAgBAQABPxBdRsw9Ht5jY5a3dBvW5jiZGMkoK2cBXCbguxDyl+RukaAQE//Z","aspectRatio":1.5060240963855422,"src":"/static/cc1f089eb63cfc4875592c93258021f6/ba9ae/cover.jpg","srcSet":"/static/cc1f089eb63cfc4875592c93258021f6/86d0f/cover.jpg 125w,\n/static/cc1f089eb63cfc4875592c93258021f6/520da/cover.jpg 250w,\n/static/cc1f089eb63cfc4875592c93258021f6/ba9ae/cover.jpg 500w,\n/static/cc1f089eb63cfc4875592c93258021f6/72227/cover.jpg 750w,\n/static/cc1f089eb63cfc4875592c93258021f6/5c39c/cover.jpg 1000w,\n/static/cc1f089eb63cfc4875592c93258021f6/4c00a/cover.jpg 7952w","sizes":"(max-width: 500px) 100vw, 500px"}}}},"html":"<p>Content in Nehalem is served by the <a href=\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\">gatsby-transformer-remark</a> plugin. But to\ncreate content it's not necessary to deal with GraphQL queries and instead create simple markdown files.</p>\n<h2 id=\"the-content-directory\" style=\"position:relative;\"><a href=\"#the-content-directory\" aria-label=\"the content directory permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The content directory</h2>\n<p>When starting Nehalem the first time it will create a <code class=\"language-text\">content</code> directory - and this is where the fun happens. If a markdown file is\ninterpreted as post or static file depends on it's directory:</p>\n<ul>\n<li>put posts under <code class=\"language-text\">content/posts</code></li>\n<li>put pages under <code class=\"language-text\">content/pages</code></li>\n</ul>\n<h2 id=\"creating-posts\" style=\"position:relative;\"><a href=\"#creating-posts\" aria-label=\"creating posts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating posts</h2>\n<p>Posts do have a slightly longer frontmatter than pages:</p>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token front-matter-block\"><span class=\"token punctuation\">---</span>\n<span class=\"token font-matter yaml language-yaml\"><span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Post title\"</span>\n<span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/path-to-the-post\"</span>\n<span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"of\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"tags\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token key atrule\">featuredImage</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"./cover.jpg\"</span>\n<span class=\"token key atrule\">excerpt</span><span class=\"token punctuation\">:</span> An excerpt what to expect from this post.\n<span class=\"token key atrule\">created</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2019-07-29</span>\n<span class=\"token key atrule\">updated</span><span class=\"token punctuation\">:</span> <span class=\"token datetime number\">2019-07-29</span></span>\n<span class=\"token punctuation\">---</span></span></code></pre></div>\n<h2 id=\"creating-pages\" style=\"position:relative;\"><a href=\"#creating-pages\" aria-label=\"creating pages permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Creating pages</h2>\n<p>The pages frontmatter is slightly shorter:</p>\n<div class=\"gatsby-highlight\" data-language=\"markdown\"><pre class=\"language-markdown\"><code class=\"language-markdown\"><span class=\"token front-matter-block\"><span class=\"token punctuation\">---</span>\n<span class=\"token font-matter yaml language-yaml\"><span class=\"token key atrule\">title</span><span class=\"token punctuation\">:</span> Page title\n<span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/path-to-the-path\"</span>\n<span class=\"token key atrule\">excerpt</span><span class=\"token punctuation\">:</span> An excerpt what to expect from this page.</span>\n<span class=\"token punctuation\">---</span></span>\n\nThe <span class=\"token code keyword\">`excerpt`</span> is used for SEO!</code></pre></div>\n<h2 id=\"tags\" style=\"position:relative;\"><a href=\"#tags\" aria-label=\"tags permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tags</h2>\n<p>Tags are handled slightly different than posts and pages; they're stored in a <code class=\"language-text\">tags.yml</code> which must be located in the content directory.</p>\n<blockquote>\n<p>It's highly recommended to register all tags used within posts in this file!</p>\n</blockquote>\n<p>The <code class=\"language-text\">tags.yml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Tag1\n  <span class=\"token key atrule\">color</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"#ff0000\"</span>\n  <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> ./assets/images/tag1icon.svg\n  <span class=\"token key atrule\">featured</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Tag2\n  <span class=\"token key atrule\">color</span><span class=\"token punctuation\">:</span> <span class=\"token comment\">#00ffee</span>\n  <span class=\"token key atrule\">icon</span><span class=\"token punctuation\">:</span> ./assets/images/tag2icon.svg\n  <span class=\"token key atrule\">featured</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<p><code class=\"language-text\">color</code> is used to change the appearance for the subheader on the tag archive for this specific tag. If <code class=\"language-text\">featured</code> is set to <code class=\"language-text\">true</code> the\ntag will be shown on the front page.</p>\n<hr>\n<p><em>Cover by <a href=\"https://unsplash.com/@anniespratt\">@anniespratt</a></em></p>"}],"postsPerPage":5}},"staticQueryHashes":["1116962356","2275848304","3138592700","3462520645","444477021","545095672"]}