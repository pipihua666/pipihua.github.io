{"componentChunkName":"component---theme-src-templates-post-tsx","path":"/babel-plugin","result":{"data":{"post":{"id":"7b7aa993-9a12-5964-b531-8fe72307fbc3","headings":[{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2},{"depth":3},{"depth":2},{"depth":3},{"depth":2}],"frontmatter":{"title":"从实现一个babel插件来理解babel","path":"/babel-plugin","tags":["JavaScript"],"excerpt":"1. babel的基础知识<br/> 2. babel插件开发基础<br/> 3. 如何编写一个babel插件","created":"2021-12-11 22:55","createdPretty":"11 December, 2021","updated":"2022-02-13 21:44","updatedPretty":"13 February, 2022","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFBP/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAGfQxqZqiRP/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAAyISEf/aAAgBAQABBQKtd4gUeGxuVOu5/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BiP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAQACAwAAAAAAAAAAAAAAAAARUQEQIf/aAAgBAQAGPwKluShjX//EABgQAQADAQAAAAAAAAAAAAAAAAEAESEx/9oACAEBAAE/IbDvWWRSmYhBDuIydvYsyp//2gAMAwEAAgADAAAAEGcP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERIf/aAAgBAwEBPxB1pR//xAAVEQEBAAAAAAAAAAAAAAAAAAARAP/aAAgBAgEBPxBJv//EABsQAQEAAwEBAQAAAAAAAAAAAAERACExUUFx/9oACAEBAAE/EG3DKSo/uJUOjtFnzucKEqXj5vGIgE2mSIUXePQIeuf/2Q==","aspectRatio":1.5037593984962405,"src":"/static/4b86db0ad8febddf103143b72dd9c64d/f2cbb/header.jpg","srcSet":"/static/4b86db0ad8febddf103143b72dd9c64d/8850c/header.jpg 200w,\n/static/4b86db0ad8febddf103143b72dd9c64d/da113/header.jpg 400w,\n/static/4b86db0ad8febddf103143b72dd9c64d/f2cbb/header.jpg 800w,\n/static/4b86db0ad8febddf103143b72dd9c64d/c26c2/header.jpg 1200w,\n/static/4b86db0ad8febddf103143b72dd9c64d/9352a/header.jpg 1600w,\n/static/4b86db0ad8febddf103143b72dd9c64d/4fb49/header.jpg 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>自动在 try-catch 块中添加 错误捕获方法</p>\n<h2 id=\"先了解一下-babel-的基础知识\" style=\"position:relative;\"><a href=\"#%E5%85%88%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B-babel-%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86\" aria-label=\"先了解一下 babel 的基础知识 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>先了解一下 babel 的基础知识</h2>\n<h3 id=\"官方文档才是最好的教程\" style=\"position:relative;\"><a href=\"#%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E6%89%8D%E6%98%AF%E6%9C%80%E5%A5%BD%E7%9A%84%E6%95%99%E7%A8%8B\" aria-label=\"官方文档才是最好的教程 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>官方文档才是最好的教程</h3>\n<ul>\n<li><a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#stopping-traversal\">babel-handbook</a></li>\n</ul>\n<h3 id=\"获取代码的-ast\" style=\"position:relative;\"><a href=\"#%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81%E7%9A%84-ast\" aria-label=\"获取代码的 ast permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>获取代码的 AST</h3>\n<ul>\n<li><a href=\"https://astexplorer.net/\">AST Explorer</a>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB35CQf//EABYQAAMAAAAAAAAAAAAAAAAAAAABEP/aAAgBAQABBQIc/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFhAAAwAAAAAAAAAAAAAAAAAAABBB/9oACAEBAAE/ISV//9oADAMBAAIAAwAAABDzz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABgQAQEBAQEAAAAAAAAAAAAAAAEAEVFx/9oACAEBAAE/EMOEBPVl/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ast\"\n        title=\"ast\"\n        src=\"/static/7e6ba71ad7e2a59bab88f362476225a8/e5166/astexplorer.jpg\"\n        srcset=\"/static/7e6ba71ad7e2a59bab88f362476225a8/f93b5/astexplorer.jpg 300w,\n/static/7e6ba71ad7e2a59bab88f362476225a8/b4294/astexplorer.jpg 600w,\n/static/7e6ba71ad7e2a59bab88f362476225a8/e5166/astexplorer.jpg 1200w,\n/static/7e6ba71ad7e2a59bab88f362476225a8/d9c39/astexplorer.jpg 1800w,\n/static/7e6ba71ad7e2a59bab88f362476225a8/48f41/astexplorer.jpg 1997w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></li>\n</ul>\n<h3 id=\"babel-是什么？\" style=\"position:relative;\"><a href=\"#babel-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F\" aria-label=\"babel 是什么？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>babel 是什么？</h3>\n<blockquote>\n<p>这里引用官方的话说，Babel 是一个 JavaScript 编译器，特别是一个源代码到源代码的编译器，通常被称为“转译器”。这意味着你给 Babel 一些 JavaScript 代码，Babel 修改代码，并生成新的代码。</p>\n</blockquote>\n<h3 id=\"babel-的工作流程\" style=\"position:relative;\"><a href=\"#babel-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B\" aria-label=\"babel 的工作流程 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>babel 的工作流程</h3>\n<ol>\n<li>\n<p>解析</p>\n<ul>\n<li>使用<a href=\"https://babeljs.io/docs/en/babel-parser\">@babel/parser</a>解析器进行词法和语法解析，生成 AST</li>\n</ul>\n</li>\n<li>\n<p>转换（babel-plugin 工作在这一层）</p>\n<ul>\n<li>使用<a href=\"https://babeljs.io/docs/en/babel-traverse\">@babel/traverse</a>对 AST 进行深度遍历，并且提供钩子来协助我们在遍历到某种 AST 节点的时候进行处理，比如<code class=\"language-text\">callExpression</code>等</li>\n</ul>\n</li>\n<li>\n<p>生成</p>\n<ul>\n<li>使用<a href=\"https://babeljs.io/docs/en/babel-generator\">@babel/generator</a>将处理后的 AST 转换成最终可以在浏览器上运行的代码和源码映射(sourcemap)</li>\n</ul>\n</li>\n</ol>\n<p>总结成以下图片：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 661px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb5eda83d9946e7738f69d04b2797c39/0012b/babel%E6%B5%81%E7%A8%8B.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABv0lEQVQoz01RO2iaYRS9WGi3UEq7JKRbCbRQbDN1cghkremSaAcriNChi1Ohk9ClhDyEDMFBISB0EGdxFVq0Kqjg+/34fx+/T1QQ1NtzpYR+cDj/d777fffc89N4PL7qdDousLvdbr9nZur3+7bhcFgYjUaZwWBgEi2VSr2ZTCZuTdMupbZcLh+JHo1G96fTqV/TBgrO72g+n3OtVmMUMR7wSFG3262J1mq1REuKls1mLZvNhmezGa/Xa1YU5bvo8Xjcpqgq53I57vV6TJVKxVitVj+Az8CvIpEIZTIZPZzcAjf5fP61z+cTbReTmOHciIanpVLpIBgMwuGfh/V6/Qsm+dlsNu0EJ1ugAyUSCVqtVrpkMknSXQBXW3Y6nbRcLu91OBXW/eN7iMMHhBUKhV56vd6nIgYCgcfI8RscncPlBfiz6MjqDPiFrH5DPxUN99/h21UoFK4Rzw+y2+3kcDjIarU+MxgMT+Rxv9//HIeM3BjjMMZsyGVVVXONRmOrIcOyaGj2FQ1kz4vFgum/tQfs6PV6CofDj/DHT5DVRzxiQfExHEskbxG8B4486XT6MBaLUbFYfIH9JzQ1gc1/AT7tlEOeo4pzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"babel的工作流程\"\n        title=\"babel的工作流程\"\n        src=\"/static/bb5eda83d9946e7738f69d04b2797c39/0012b/babel%E6%B5%81%E7%A8%8B.png\"\n        srcset=\"/static/bb5eda83d9946e7738f69d04b2797c39/5a46d/babel%E6%B5%81%E7%A8%8B.png 300w,\n/static/bb5eda83d9946e7738f69d04b2797c39/0a47e/babel%E6%B5%81%E7%A8%8B.png 600w,\n/static/bb5eda83d9946e7738f69d04b2797c39/0012b/babel%E6%B5%81%E7%A8%8B.png 661w\"\n        sizes=\"(max-width: 661px) 100vw, 661px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"开发-babel-插件你需要知道哪些库\" style=\"position:relative;\"><a href=\"#%E5%BC%80%E5%8F%91-babel-%E6%8F%92%E4%BB%B6%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E5%93%AA%E4%BA%9B%E5%BA%93\" aria-label=\"开发 babel 插件你需要知道哪些库 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>开发 babel 插件你需要知道哪些库</h3>\n<ul>\n<li><a href=\"https://babeljs.io/docs/en/babel-types\">@babel/types</a>：一个用于 AST 节点的 Lodash 工具库，它包含构造、验证以及变换 AST 节点的方法。这个库提供了 babel AST 所有节点类型，用户可以使用这个库构造出一个新的 AST 节点，或者判断某个节点是什么类型等。</li>\n<li><a href=\"https://babeljs.io/docs/en/babel-template\">@babel/template</a>：它不像@babel/types 通过生成 AST 节点的方式来处理 AST 节点，它能让你编写<b>字符串</b>形式且带有占位符的代码来替代手动编码，尤其是生成大规模 AST 的时候。</li>\n<li><a href=\"https://babeljs.io/docs/en/babel-core\">@babel/core</a>：babel 工作流程中三个插件的合体。</li>\n</ul>\n<h2 id=\"babel-插件开发基础\" style=\"position:relative;\"><a href=\"#babel-%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80\" aria-label=\"babel 插件开发基础 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>babel 插件开发基础</h2>\n<h3 id=\"如何访问到需要处理的-ast-节点\" style=\"position:relative;\"><a href=\"#%E5%A6%82%E4%BD%95%E8%AE%BF%E9%97%AE%E5%88%B0%E9%9C%80%E8%A6%81%E5%A4%84%E7%90%86%E7%9A%84-ast-%E8%8A%82%E7%82%B9\" aria-label=\"如何访问到需要处理的 ast 节点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>如何访问到需要处理的 AST 节点</h3>\n<p>babel 在使用<code class=\"language-text\">@babel/traverse</code>对 AST 进行深度优先遍历时，会访问每个 AST 节点，这个便跟我们的 visitor（访问器模式） 有关了，这就是 babel 暴露给开发者的核心。<br /></p>\n<p>看图 1，catch 块的 AST 节点名为 CatchClause，所以我们可以根据以下方式访问到 catch 块:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">visitor<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">CatchClause</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path<span class=\"token punctuation\">,</span>state</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>具体有哪些节点可看这个链接：<a href=\"https://github.com/babel/babel/blob/master/packages/babel-parser/ast/spec.md#programs\">babel-ast-node</a>。不过一般我们都是通过 <a href=\"https://astexplorer.net/\">AST Explorer</a> 来直接转化成我们想知道的节点名。</p>\n<h3 id=\"如何获取到-ast-节点\" style=\"position:relative;\"><a href=\"#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E5%88%B0-ast-%E8%8A%82%E7%82%B9\" aria-label=\"如何获取到 ast 节点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>如何获取到 AST 节点</h3>\n<p>当我们如上文访问一个函数调用表达式时，babel 会向我们的方法传递一些参数：<code class=\"language-text\">CatchClause(path,state){}</code>，其中<code class=\"language-text\">path</code>对象便是我们获取 AST 节点的入口，其中<code class=\"language-text\">path</code>对象比较重要的属性有以下：</p>\n<ul>\n<li>node 当前 AST 节点信息</li>\n<li>parent 父节点的 AST 节点信息</li>\n<li>parentNode 父节点的 path 信息，通过这个属性可以一路向上找</li>\n<li>scope 作用域</li>\n<li>context 当前 traverse 的上下文</li>\n</ul>\n<p>通过 <code class=\"language-text\">path.node</code> ，我们便拿到了一个 AST 节点。</p>\n<h3 id=\"如何操作-ast-节点\" style=\"position:relative;\"><a href=\"#%E5%A6%82%E4%BD%95%E6%93%8D%E4%BD%9C-ast-%E8%8A%82%E7%82%B9\" aria-label=\"如何操作 ast 节点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>如何操作 AST 节点</h3>\n<p>由于 JavaScript 对于对象是地址引用，因此我们想要操作 AST 只要操作这个 node 对象即可，更详细的说是通过<code class=\"language-text\">path</code>对象来操作 AST 节点，不需要额外有其他返回操作，babel 会使用原来的引用。<br/></p>\n<p>但是直接对 node 对象（也就是 AST 节点）进行操作成本不低，特别是需要构造出一些比较复杂的 AST 节点对原节点 进行 插入（增）替换（改）等操作的时候。所以 @babel/types 也贴心的提供了诸多构造出一个新的 AST 节点的方法，比如：</p>\n<ul>\n<li>构造一个 解构对象 ： t.spreadElement(t.identifier(data))</li>\n<li>构造一个 对象表达式： t.objectExpression([t.spreadElement(t.identifier(data))])</li>\n<li>在节点内新增一行注释： t.addComment(node, 'inner', 'commment')</li>\n<li>...</li>\n</ul>\n<p>这样我们便实现了对 AST 节点的增删改查。如果你的 AST 极其复杂，可以考虑使用上文提到的 @babel/template 来将一段字符串转化为 AST 节点，从而不必再从一个一个最原始的节点开始构造。</p>\n<h2 id=\"开发我们的-babel-插件吧\" style=\"position:relative;\"><a href=\"#%E5%BC%80%E5%8F%91%E6%88%91%E4%BB%AC%E7%9A%84-babel-%E6%8F%92%E4%BB%B6%E5%90%A7\" aria-label=\"开发我们的 babel 插件吧 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>开发我们的 babel 插件吧</h2>\n<p>假设我们的.babelrc 为：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n   <span class=\"token string\">\"babel-catch-plugin\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"logger\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"console\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"method\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"log\"</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>那我们可以编写插件如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// babel-core会向函数注入babel-types和babel-template属性</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">babelCatchPlugin</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> types<span class=\"token operator\">:</span> t<span class=\"token punctuation\">,</span> template <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">\"babel-catch-plugin\"</span><span class=\"token punctuation\">,</span>\n    visitor<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">CatchClause</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">path<span class=\"token punctuation\">,</span> state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// babel配置的options</span>\n        <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> state<span class=\"token punctuation\">.</span>opts\n        <span class=\"token comment\">// 获取catch块函数的参数，假设我们这里把错误命名为 e</span>\n        <span class=\"token keyword\">const</span> error <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>param\n        <span class=\"token comment\">// 生成logger的ast节点,console.log(e)</span>\n        <span class=\"token keyword\">const</span> ast <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span><span class=\"token function\">ast</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>options<span class=\"token punctuation\">.</span>logger<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>method<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 插入ast树</span>\n        path<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unshiftContainer</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">,</span> ast<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> babelCatchPlugin</code></pre></div>\n<h3 id=\"从问题完善插件\" style=\"position:relative;\"><a href=\"#%E4%BB%8E%E9%97%AE%E9%A2%98%E5%AE%8C%E5%96%84%E6%8F%92%E4%BB%B6\" aria-label=\"从问题完善插件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>从问题完善插件</h3>\n<ol>\n<li>catch 块中如果已经有错误捕获了，就不添加了。</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 我们可以通过遍历当前节点下的ast，如果存在错误捕获就提前return</span>\n<span class=\"token keyword\">let</span> isFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n\nouterPath<span class=\"token punctuation\">.</span><span class=\"token function\">traverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">MemberExpression</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">innerPath</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">.</span><span class=\"token function\">isIdentifier</span><span class=\"token punctuation\">(</span>innerPath<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>property<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> options<span class=\"token punctuation\">.</span>logger <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      isFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n      <span class=\"token comment\">// innerPath.stop()结束遍历，innerPath.skip()结束当前path遍历</span>\n      innerPath<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isFlag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>为什么 catch(E)和 catch(_)会报 babel-template 错误？</li>\n</ol>\n<p>因为你直接用的是 <code class=\"language-text\">template</code>而不是通过 <code class=\"language-text\">template.ast</code> 生成 ast 节点。<code class=\"language-text\">template</code> 中可接收拥有占位符的字符串生 AST 节点，下划线_ , % 和大写字符都是占位符的关键词。而<code class=\"language-text\">template.ast</code>不管占位符，直接将传入的字符串转化为 AST 节点。</p>\n<ol start=\"3\">\n<li>visitor 函数的参数 state 和 this 对象有啥区别?</li>\n</ol>\n<p>两者都是保存的是访问当前节点文件的信息，没有区别，推荐使用 state。</p>\n<h2 id=\"测试插件\" style=\"position:relative;\"><a href=\"#%E6%B5%8B%E8%AF%95%E6%8F%92%E4%BB%B6\" aria-label=\"测试插件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>测试插件</h2>\n<p>我喜欢通过主动编译的形式测试插件，可以转化自己所有想测试的代码。</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"babel ./test/index.js -o ./test/test.js --config-file ./test/.babelrc \"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<ul>\n<li>创建一个 test 文件夹存想测试的代码在 index.js 中</li>\n<li>配置引用了当前插件编译后过文件夹的 .babelrc 文件</li>\n<li>npm run test</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>转化成：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>以上方式简单粗暴，但是会有以下缺点：</p>\n<ol>\n<li>当测试用例过多时，<code class=\"language-text\">./test/index.js</code>文件就会变得很庞大</li>\n<li>每个测试用例没有具体的说明测试的什么，混乱不堪</li>\n<li>当有测试用例不正确时，只能通过肉眼的角度来查找，效率极低</li>\n</ol>\n<p>基于以上原因，强烈建议通过<code class=\"language-text\">babel-plugin-tester</code>来测试 babel 插件</p>\n<h3 id=\"配置-babel-plugin-tester\" style=\"position:relative;\"><a href=\"#%E9%85%8D%E7%BD%AE-babel-plugin-tester\" aria-label=\"配置 babel plugin tester permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>配置 babel-plugin-tester</h3>\n<ol>\n<li><code class=\"language-text\">yarn add babel-plugin-tester jest</code></li>\n<li>新建 src 同级目录 <code class=\"language-text\">test</code>，在 test 目录下新建<code class=\"language-text\">fixtures</code>目录存放测试用例和<code class=\"language-text\">index.test.js</code> 文件配置<code class=\"language-text\">babel-plugin-tester</code></li>\n<li>index.test.js 配置实例如下</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> pluginTester <span class=\"token keyword\">from</span> <span class=\"token string\">\"babel-plugin-tester\"</span>\n<span class=\"token keyword\">import</span> path <span class=\"token keyword\">from</span> <span class=\"token string\">\"path\"</span>\n<span class=\"token keyword\">import</span> babelCatchPlugin <span class=\"token keyword\">from</span> <span class=\"token string\">\"../src\"</span>\n\n<span class=\"token function\">pluginTester</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  plugin<span class=\"token operator\">:</span> babelCatchPlugin<span class=\"token punctuation\">,</span>\n  pluginName<span class=\"token operator\">:</span> <span class=\"token string\">\"babel-catch-plugin\"</span><span class=\"token punctuation\">,</span>\n  title<span class=\"token operator\">:</span> <span class=\"token string\">\"test plugin\"</span><span class=\"token punctuation\">,</span>\n  pluginOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    logger<span class=\"token operator\">:</span> <span class=\"token string\">\"console\"</span><span class=\"token punctuation\">,</span>\n    method<span class=\"token operator\">:</span> <span class=\"token string\">\"log\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 使用 jest 的 snapshot</span>\n  snapshot<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 测试用例读取的目录</span>\n  fixtures<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"__fixtures__\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"4\">\n<li>在 fixtures 中可新建各种用例文件夹，<code class=\"language-text\">code.js</code>则是对插件的输入代码，<code class=\"language-text\">output.js</code>则是期望的输出代码，<code class=\"language-text\">options.json</code>可对插件的 option 进行重新配置，更多 API 查看官网\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65347178d666815892afee7c2dd6377f/747d8/test-tree.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgABBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeIWDIx//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAEQAiH/2gAIAQEAAQUCU6ZHP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAQEBAAAAAAAAAAAAAAAAAEEAIP/aAAgBAQAGPwJnP//EABoQAAMBAAMAAAAAAAAAAAAAAAABETEhUYH/2gAIAQEAAT8hzqejqwXuzkPGU//aAAwDAQACAAMAAAAQUN//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QbX//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAwEBAQEAAAAAAAAAAAABABExIXFBsf/aAAgBAQABPxALQ0ZQh5H1d2RJ6Pqw5X4/sYAUd1il6rP/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test\"\n        title=\"test\"\n        src=\"/static/65347178d666815892afee7c2dd6377f/747d8/test-tree.jpg\"\n        srcset=\"/static/65347178d666815892afee7c2dd6377f/f93b5/test-tree.jpg 300w,\n/static/65347178d666815892afee7c2dd6377f/747d8/test-tree.jpg 470w\"\n        sizes=\"(max-width: 470px) 100vw, 470px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>在 package.json 的 scripts 字段添加<code class=\"language-text\">&quot;test&quot;: &quot;jest --verbose&quot;,</code>，每次需要测试在控制台输入<code class=\"language-text\">yarn test</code>即可</li>\n</ol>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://juejin.cn/post/6844904162237366279\">从 0 到 1 开发并测试 Babel 插件&#x26;Babel 简易源码分析</a></li>\n<li><a href=\"https://github.com/jamiebuilds/babel-handbook/blob/master/translations/en/plugin-handbook.md#toc-state\">babel 官方插件指南</a></li>\n<li><a href=\"https://babeljs.io/docs/en/\">babel 官网</a></li>\n<li><a href=\"https://github.com/babel/babel/blob/master/packages/babel-parser/ast/spec.md#programs\">babel AST 节点</a></li>\n</ul>"},"primaryTag":{"name":"JavaScript","color":"#1e81b0"}},"pageContext":{"postId":"7b7aa993-9a12-5964-b531-8fe72307fbc3","primaryTag":"JavaScript"}},"staticQueryHashes":["1116962356","2275848304","3097946992","3138592700","3462520645"]}