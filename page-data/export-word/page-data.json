{"componentChunkName":"component---theme-src-templates-post-tsx","path":"/export-word","result":{"data":{"post":{"id":"5fe592fe-fa3a-5495-9fe5-3acd5f33e7fd","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":3},{"depth":3},{"depth":2}],"frontmatter":{"title":"四种方式实现在导出word中添加「图表」","path":"/export-word","tags":["Golang"],"excerpt":"1. React前端通过echarts的获取图表的dataUrl实现<br/>2. Nodejs通过无头浏览器截图实现<br/>3. Nodejs结合Canvas和Echarts实现<br/>4. Golang通过模板渲染修改word元数据实现","created":"2021-06-27 17:20","createdPretty":"27 June, 2021","updated":"2021-07-04 17:45","updatedPretty":"04 July, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEBf/EABUBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAHYnrWjQJf/xAAZEAACAwEAAAAAAAAAAAAAAAAAAgEDERL/2gAIAQEAAQUCduVrvWxjNITJP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAABAh/9oACAECAQE/AYf/xAAYEAACAwAAAAAAAAAAAAAAAAABEAARQf/aAAgBAQAGPwImUHi//8QAGhABAQEBAAMAAAAAAAAAAAAAAQARIWGBsf/aAAgBAQABPyEHdc82ak9xOCcxu58Rf//aAAwDAQACAAMAAAAQ/wDv/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EIV//8QAFhEBAQEAAAAAAAAAAAAAAAAAAREQ/9oACAECAQE/EBiJn//EABoQAQEBAAMBAAAAAAAAAAAAAAERACFBUTH/2gAIAQEAAT8QFcLYR5jLZFqX5u3Ni5lxdCXARpDyYIcy28b/2Q==","aspectRatio":1.4285714285714286,"src":"/static/8a183bafd708e36b95af93205201bb79/f2cbb/header.jpg","srcSet":"/static/8a183bafd708e36b95af93205201bb79/8850c/header.jpg 200w,\n/static/8a183bafd708e36b95af93205201bb79/da113/header.jpg 400w,\n/static/8a183bafd708e36b95af93205201bb79/f2cbb/header.jpg 800w,\n/static/8a183bafd708e36b95af93205201bb79/c26c2/header.jpg 1200w,\n/static/8a183bafd708e36b95af93205201bb79/356ef/header.jpg 1280w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>为什么要说说如何在 word 中插入「图表」呢？因为前端熟知的第三方库<a href=\"https://github.com/dolanmiu/docx\">Docx</a>不支持插入「图表」！！！</p>\n<blockquote>\n<p><a href=\"https://github.com/dolanmiu/docx\">Docx</a>这个库提供了优雅的声明式 API，让我们可以使用 JS/TS 轻松生成 <b>「.docx」</b> 文件。此外，它还同时支持 Node.js 和浏览器。</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b81e28982d6b411b8706f9136c30e06b/222f7/docx-chart.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3aAD/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGBAAAgMAAAAAAAAAAAAAAAAAAAEQETH/2gAIAQEAAT8hWxR//9oADAMBAAIAAwAAABDwD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABcQAAMBAAAAAAAAAAAAAAAAAAABEVH/2gAIAQEAAT8QQREYf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"不信你们康康这里\"\n        title=\"不信你们康康这里\"\n        src=\"/static/b81e28982d6b411b8706f9136c30e06b/e5166/docx-chart.jpg\"\n        srcset=\"/static/b81e28982d6b411b8706f9136c30e06b/f93b5/docx-chart.jpg 300w,\n/static/b81e28982d6b411b8706f9136c30e06b/b4294/docx-chart.jpg 600w,\n/static/b81e28982d6b411b8706f9136c30e06b/e5166/docx-chart.jpg 1200w,\n/static/b81e28982d6b411b8706f9136c30e06b/d9c39/docx-chart.jpg 1800w,\n/static/b81e28982d6b411b8706f9136c30e06b/222f7/docx-chart.jpg 1870w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>为了解决这个问题，我想通过这篇文章聊一聊，希望大家不仅能实现前后端导出 word 功能，还能实现在导出的 word 中插入「图表」！本文主讲如何在导出的 word 中插入「图表」,经过漫长的技术实现，分步从前端到后端，从问题衍生到技术优化。主体分为以下四个部分</p>\n<ol>\n<li>React 通过<a href=\"https://github.com/apache/echarts\">echarts</a>的 API<a href=\"https://echarts.apache.org/zh/api.html#echartsInstance.getDataURL\">getDataURL</a>实现</li>\n<li>Node.js 通过<a href=\"https://github.com/puppeteer/puppeteer\">puppeteer</a>headless 浏览器快照功能实现</li>\n<li>Node.js 通过<a href=\"https://github.com/Automattic/node-canvas\">canvas</a>实现（推荐）</li>\n<li>Golang 通过模板渲染<a href=\"https://golang.org/pkg/text/template/\">text/template</a>实现 word 导出和插入「图表」功能(强烈推荐)</li>\n</ol>\n<h2 id=\"docx-的常用-api\" style=\"position:relative;\"><a href=\"#docx-%E7%9A%84%E5%B8%B8%E7%94%A8-api\" aria-label=\"docx 的常用 api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docx 的常用 api</h2>\n<p><a href=\"https://github.com/dolanmiu/docx\" target=\"_blank\">Docx</a> 这个库为开发者提供了许多类，用于创建 Word 中的对应元素，这里我们简单介绍几个常见的类：</p>\n<ul>\n<li><a href=\"https://docx.js.org/#/usage/document\" target=\"_blank\">Document</a>：用于创建新的 Word 文档；</li>\n<li><a href=\"https://docx.js.org/#/usage/sections\" target=\"_blank\">Sections</a>：用于创建区块，一个区块包括一个或多个段落；</li>\n<li><a href=\"https://docx.js.org/#/usage/paragraph\" target=\"_blank\">Paragraph</a>：用于创建新的段落；</li>\n<li><a href=\"https://docx.js.org/#/usage/text\" target=\"_blank\">Text Run</a>：用于创建文本，支持设置加粗、斜体和下划线样式；</li>\n<li><a href=\"https://docx.js.org/#/usage/images\" target=\"_blank\">Image Run</a>：用于创建图片，支持浮动和内联的定位；</li>\n<li><a href=\"https://docx.js.org/#/usage/tables\" target=\"_blank\">Tables</a>：用于创建表格，支持设置表格每一行和每个表格单元的内容。</li>\n</ul>\n<h2 id=\"react-通过-echarts-的-getdataurl-实现\" style=\"position:relative;\"><a href=\"#react-%E9%80%9A%E8%BF%87-echarts-%E7%9A%84-getdataurl-%E5%AE%9E%E7%8E%B0\" aria-label=\"react 通过 echarts 的 getdataurl 实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React 通过 echarts 的 getDataURL 实现</h2>\n<p>Docx 不能插入「图表」，值得庆幸的是图片还是可以插入的。 Image Run 可以通过 Data URL 和 buffer 插入图片，于是我联想到了 echarts 的「getDataURL」能够获取到图表的 Data Url。按照下面的方法就能实现「图表」图片的 Data URL 生成了。</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">/**\n * @description:通过echarts的实例api生成图表Data URL\n * @param {option} echarts图表的option配置\n * @return {string} Data URL\n */</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getChartDataURL</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">option <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"div\"</span><span class=\"token punctuation\">)</span>\n  container<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token string\">\"container\"</span>\n  container<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span>\n  container<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token string\">\"500px\"</span>\n  container<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token string\">\"500px\"</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> echarts<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 绘制图表</span>\n  <span class=\"token comment\">// 刚开始绘制不出来图表的原因如下：</span>\n  <span class=\"token comment\">// 如果有动画效果的话，生成的图片会是在有动画效果出来以前的样子，就是说数据还没渲染上去，因此导出的图片没有数据。</span>\n  <span class=\"token comment\">// https://blog.csdn.net/qq_35239421/article/details/106526147</span>\n  instance<span class=\"token punctuation\">.</span><span class=\"token function\">setOption</span><span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> dataUrl <span class=\"token operator\">=</span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">getDataURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">\"png\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> dataUrl\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><a href=\"https://github.com/pipihua666/export-word/tree/master/export-frontend\">完整项目参考代码戳这里</a>，代码可直接运行查看，下同！</p>\n</blockquote>\n<h2 id=\"nodejs-通过-puppeteer-headless-浏览器快照功能实现\" style=\"position:relative;\"><a href=\"#nodejs-%E9%80%9A%E8%BF%87-puppeteer-headless-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%BF%AB%E7%85%A7%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0\" aria-label=\"nodejs 通过 puppeteer headless 浏览器快照功能实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Node.js 通过 puppeteer headless 浏览器快照功能实现</h2>\n<p>echarts 只能在浏览器使用（当然你也可以使用在后端封装好的 echarts 库，我没有这样去实现，可在评论区给出你们实现的链接哈！），该怎么办啊！后端还有 headless 浏览器呢。通过 puppeteer 的快照功能实现如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/** * 生成echarts图片 *\n * @param {*} option echarts 选项 *\n *  @returns 图片buffer\n * */</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getEchartsChart</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">option <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 启动浏览器</span>\n  <span class=\"token keyword\">const</span> browser <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> puppeteer<span class=\"token punctuation\">.</span><span class=\"token function\">launch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    args<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"--no-sandbox\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 创建空白页面</span>\n  <span class=\"token keyword\">const</span> page <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">newPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 定义网页模板</span>\n    <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;!DOCTYPE html>\n    &lt;html lang=\"en\">\n      &lt;head>\n        &lt;meta charset=\"UTF-8\">\n        &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n        &lt;title>chart&lt;/title>\n      &lt;/head>\n      &lt;body>\n          &lt;div id=\"container\" style=\"width: 500px;height:500px;\" />\n      &lt;/body>\n    &lt;/html></span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token comment\">// 设置网页源码</span>\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">setContent</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 添加script标签和属性</span>\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">addScriptTag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      path<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>\n        __dirname<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"./node_modules/echarts/dist/echarts.min.js\"</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 网页中执行js代码</span>\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">option</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> myChart <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>echarts<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"container\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      myChart<span class=\"token punctuation\">.</span><span class=\"token function\">setOption</span><span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> option<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 网页中获取id为container的元素</span>\n    <span class=\"token keyword\">let</span> elem <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#container\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 截图元素快照</span>\n    <span class=\"token keyword\">let</span> buffer <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> elem<span class=\"token punctuation\">.</span><span class=\"token function\">screenshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">\"png\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// path: path.resolve(__dirname, './123.png') // 快照的生成路径</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> buffer\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">render echarts chart error: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>err<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 关闭网页</span>\n    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// 关闭浏览器</span>\n    <span class=\"token keyword\">await</span> browser<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><a href=\"https://github.com/pipihua666/export-word/tree/master/export-node\">完整项目参考代码戳这里</a></p>\n</blockquote>\n<h2 id=\"nodejs-通过-canvas-实现\" style=\"position:relative;\"><a href=\"#nodejs-%E9%80%9A%E8%BF%87-canvas-%E5%AE%9E%E7%8E%B0\" aria-label=\"nodejs 通过 canvas 实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Node.js 通过 canvas 实现</h2>\n<p>每次都要通过 headless 浏览器去获取图表的快照，一个请求对应一个 headless 浏览器，这样既不高效，又非常耗费性能。通过独立的 canvas 库设置为 echarts 的容器就能很好的优化了，实现方式如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> echarts <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"echarts\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/** * 生成echarts图片 *\n * @param {*} option echarts 选项 *\n *  @returns 图片buffer\n * */</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getBufferByCanvas</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">option <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//创建一个canvas实例</span>\n  <span class=\"token keyword\">let</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">createCanvas</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">//将canvas实例设置为echarts容器</span>\n  echarts<span class=\"token punctuation\">.</span><span class=\"token function\">setCanvasCreator</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ctx<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">//使用canvas实例为容器创建echarts实例</span>\n  <span class=\"token keyword\">let</span> chart <span class=\"token operator\">=</span> echarts<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">//设置图标实例配置项</span>\n  chart<span class=\"token punctuation\">.</span><span class=\"token function\">setOption</span><span class=\"token punctuation\">(</span>option<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> chart<span class=\"token punctuation\">.</span><span class=\"token function\">getDom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBuffer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><a href=\"https://github.com/pipihua666/export-word/tree/master/export-node\">完整项目参考代码戳这里</a></p>\n</blockquote>\n<h2 id=\"golang-通过模板渲染-实现-word-导出和插入「图表」功能\" style=\"position:relative;\"><a href=\"#golang-%E9%80%9A%E8%BF%87%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93-%E5%AE%9E%E7%8E%B0-word-%E5%AF%BC%E5%87%BA%E5%92%8C%E6%8F%92%E5%85%A5%E3%80%8C%E5%9B%BE%E8%A1%A8%E3%80%8D%E5%8A%9F%E8%83%BD\" aria-label=\"golang 通过模板渲染 实现 word 导出和插入「图表」功能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Golang 通过模板渲染 实现 word 导出和插入「图表」功能</h2>\n<ul>\n<li>为什么要用 Go 呢？因为我们项目后端就用的 Go，Node.js 同样也能这样实现导出和插入图表。还有一个原因是：Go 是真的快啊！</li>\n<li>每次插入「图表」感觉都是插入的图片，这样导出的 word 意义在哪儿？图表只能看，不能修改和交互（→_→）。好了，我看到了你鄙视的小眼神，接下来的模板渲染方法帮你解决这些所有的疑问。</li>\n</ul>\n<h3 id=\"「docx」的特性\" style=\"position:relative;\"><a href=\"#%E3%80%8Cdocx%E3%80%8D%E7%9A%84%E7%89%B9%E6%80%A7\" aria-label=\"「docx」的特性 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>「.docx」的特性</h3>\n<p>.docx 的 word 文档其实就是一个 zip 压缩包(xml 文件的集合)，我们通过把<code class=\"language-text\">example.docx</code>重命名为<code class=\"language-text\">example.zip</code>，然后解压出来，你就可以看到如下文件：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/520910ef39ae6f0dc077699031195661/6a068/1.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcQJIL//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAXEAEAAwAAAAAAAAAAAAAAAAABABAR/9oACAEBAAE/IcgDX//aAAwDAQACAAMAAAAQB8//xAAWEQADAAAAAAAAAAAAAAAAAAABEDH/2gAIAQMBAT8QMX//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAYEAEBAQEBAAAAAAAAAAAAAAABEQAxgf/aAAgBAQABPxCKqD5rgmUvDf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/520910ef39ae6f0dc077699031195661/6a068/1.jpg\"\n        srcset=\"/static/520910ef39ae6f0dc077699031195661/f93b5/1.jpg 300w,\n/static/520910ef39ae6f0dc077699031195661/b4294/1.jpg 600w,\n/static/520910ef39ae6f0dc077699031195661/6a068/1.jpg 960w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><code class=\"language-text\">[Content_Types].xml</code>：该文件用于定义里面每一个 XML 文件的内容类型；</li>\n<li><code class=\"language-text\">_rels</code>：该目录下一般会有一个 「.rels」 后缀的文件，它里面保存了这个目录下各个 Part 之间的关系。<code class=\"language-text\">_rels</code> 目录不止一个，它实际上是有层级的;</li>\n<li><code class=\"language-text\">docProps</code>：该目录下的 XML 文件用于保存 docx 文件的属性；</li>\n<li><code class=\"language-text\">word</code>：该目录下包含了 Word 文档中的内容、字体、样式或主题等信息。</li>\n</ul>\n<p><code class=\"language-text\">word</code>文件夹是我们需要关注并修改为我们的模板文件，可以看到文件夹目录如下：\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f4f520042c79dd92bcfe9b06d685cf8/8e1fc/2.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAcQFEj//xAAXEAADAQAAAAAAAAAAAAAAAAAAARAx/9oACAEBAAEFAo9jP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAAIDAQAAAAAAAAAAAAAAAAABESExQf/aAAgBAQABPyESvCOBdFqEs//aAAwDAQACAAMAAAAQEM//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAfEAEAAgAGAwAAAAAAAAAAAAABABEQITFBUWGBkbH/2gAIAQEAAT8Qq7s9wkFKz27gC0HGAfNf1grVZ//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2\"\n        title=\"2\"\n        src=\"/static/5f4f520042c79dd92bcfe9b06d685cf8/8e1fc/2.jpg\"\n        srcset=\"/static/5f4f520042c79dd92bcfe9b06d685cf8/f93b5/2.jpg 300w,\n/static/5f4f520042c79dd92bcfe9b06d685cf8/b4294/2.jpg 600w,\n/static/5f4f520042c79dd92bcfe9b06d685cf8/8e1fc/2.jpg 900w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><code class=\"language-text\">charts</code>是图表集合</li>\n<li><code class=\"language-text\">document.xml</code>是整个文档的 xml 显示</li>\n</ul>\n<h3 id=\"模板渲染实现-word-导出\" style=\"position:relative;\"><a href=\"#%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93%E5%AE%9E%E7%8E%B0-word-%E5%AF%BC%E5%87%BA\" aria-label=\"模板渲染实现 word 导出 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>模板渲染实现 word 导出</h3>\n<p>我们以下面的 word 文档为例\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3585595c8fbfd869dfc6cfbddd5ebcc6/c0b59/6.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB3GSJbQKP/8QAFhABAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEBAAEFAtq1z//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/AYf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwGn/8QAGBAAAgMAAAAAAAAAAAAAAAAAABAhUYH/2gAIAQEABj8CcUav/8QAHRABAAEEAwEAAAAAAAAAAAAAAREAECFBMVFhcf/aAAgBAQABPyEIXHLqs+2hblp9oNeoRb//2gAMAwEAAgADAAAAELTP/8QAFhEAAwAAAAAAAAAAAAAAAAAAARBh/9oACAEDAQE/EBS//8QAFhEAAwAAAAAAAAAAAAAAAAAAARBh/9oACAECAQE/EDC//8QAHBAAAgMBAAMAAAAAAAAAAAAAAREAIUExEHGB/9oACAEBAAE/ECmjRRQEsT3BzfsETJwJotEU7KHKfj//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"6\"\n        title=\"6\"\n        src=\"/static/3585595c8fbfd869dfc6cfbddd5ebcc6/e5166/6.jpg\"\n        srcset=\"/static/3585595c8fbfd869dfc6cfbddd5ebcc6/f93b5/6.jpg 300w,\n/static/3585595c8fbfd869dfc6cfbddd5ebcc6/b4294/6.jpg 600w,\n/static/3585595c8fbfd869dfc6cfbddd5ebcc6/e5166/6.jpg 1200w,\n/static/3585595c8fbfd869dfc6cfbddd5ebcc6/c0b59/6.jpg 1438w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>一个请求创建一个<code class=\"language-text\">结果模板文件夹</code>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/952574047e011022cb2845f14188dc50/a66e6/3.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAADABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAABwwTB/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAERMf/aAAgBAQABPyEig9P/2gAMAwEAAgADAAAAEPff/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAx/9oACAEDAQE/EDSdv//EABYRAAMAAAAAAAAAAAAAAAAAAAEQMf/aAAgBAgEBPxAxf//EABcQAQEBAQAAAAAAAAAAAAAAAAEhABH/2gAIAQEAAT8QaPbcoIYcjf/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"3\"\n        src=\"/static/952574047e011022cb2845f14188dc50/e5166/3.jpg\"\n        srcset=\"/static/952574047e011022cb2845f14188dc50/f93b5/3.jpg 300w,\n/static/952574047e011022cb2845f14188dc50/b4294/3.jpg 600w,\n/static/952574047e011022cb2845f14188dc50/e5166/3.jpg 1200w,\n/static/952574047e011022cb2845f14188dc50/a66e6/3.jpg 1356w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>把<code class=\"language-text\">源模板文件夹</code>中需要插入数据的地方修改为相应的<code class=\"language-text\">模板语法</code>，在 Go 中就是这样的模板语法<code class=\"language-text\">{{.Title}}</code>，通过把<code class=\"language-text\">源模板文件夹</code>结合数据<b>渲染</b>出最终的文件替换<code class=\"language-text\">结果模板文件夹</code>中的同名文件。比如这里的<code class=\"language-text\">/word/charts/chart1.xml</code>文件（其他 xml 文件同理）</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>cat</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>strRef</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>f</span><span class=\"token punctuation\">></span></span>Sheet1!$A$2:$A$5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>f</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>strCache</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>ptCount</span> <span class=\"token attr-name\">val</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{.ChartData | len | print}}<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n            {{/* 遍历数据ChartData: []Chart{{\"小明\", 100}, {\"小花\", 88}, {\"小红\", 66}} */}}\n            {{range $index, $element := .ChartData}}\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>pt</span> <span class=\"token attr-name\">idx</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{$index | print}}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                {{ /* name */}}\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>v</span><span class=\"token punctuation\">></span></span>{{$element.Key}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>v</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>pt</span><span class=\"token punctuation\">></span></span>\n            {{end}}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>strCache</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>strRef</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>cat</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>val</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>numRef</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>f</span><span class=\"token punctuation\">></span></span>Sheet1!$B$2:$B$5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>f</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>numCache</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>formatCode</span><span class=\"token punctuation\">></span></span>General<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>formatCode</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>ptCount</span> <span class=\"token attr-name\">val</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{.ChartData | len | print}}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n            {{range $index, $element := .ChartData}}\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>pt</span> <span class=\"token attr-name\">idx</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{{$index | print}}<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n                {{/* value */}}\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">c:</span>v</span><span class=\"token punctuation\">></span></span>{{$element.Value}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>v</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>pt</span><span class=\"token punctuation\">></span></span>\n            {{end}}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>numCache</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>numRef</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">c:</span>val</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<ol start=\"3\">\n<li>最后把<code class=\"language-text\">结果模板文件夹</code>的集合压缩为 zip 包，然后重命名为.docx 这就是一个根据数据生成的 word 文档啦！可以直接返回给前端了。最终渲染的 word 文档如下\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ae124d2765508f2b806b00b4af0b0af/63c98/5.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB3LCZXkFH/8QAGhAAAQUBAAAAAAAAAAAAAAAAAQACESAhMf/aAAgBAQABBQLaQ4Ic/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BCf/EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/AVn/xAAXEAADAQAAAAAAAAAAAAAAAAACECCh/9oACAEBAAY/AoPF/8QAGxAAAwACAwAAAAAAAAAAAAAAAAERITEQQbH/2gAIAQEAAT8hwbnoq+K6sCqLbYqLvs//2gAMAwEAAgADAAAAEJ/P/8QAFxEBAAMAAAAAAAAAAAAAAAAAAAERQf/aAAgBAwEBPxCzUv/EABcRAQADAAAAAAAAAAAAAAAAAAABEUH/2gAIAQIBAT8QoxD/xAAeEAEAAgEEAwAAAAAAAAAAAAABABEhMUFRoWFxgf/aAAgBAQABPxCmiIu66Nowyg+CBy3EAGjq2YhGZcu2adT0GfU//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"5\"\n        title=\"5\"\n        src=\"/static/7ae124d2765508f2b806b00b4af0b0af/e5166/5.jpg\"\n        srcset=\"/static/7ae124d2765508f2b806b00b4af0b0af/f93b5/5.jpg 300w,\n/static/7ae124d2765508f2b806b00b4af0b0af/b4294/5.jpg 600w,\n/static/7ae124d2765508f2b806b00b4af0b0af/e5166/5.jpg 1200w,\n/static/7ae124d2765508f2b806b00b4af0b0af/63c98/5.jpg 1392w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n</ol>\n<h3 id=\"优缺点\" style=\"position:relative;\"><a href=\"#%E4%BC%98%E7%BC%BA%E7%82%B9\" aria-label=\"优缺点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>优缺点</h3>\n<ul>\n<li>\n<p>优点：</p>\n<ul>\n<li>这里的图表就可以交互和修改了！</li>\n<li>性能也很好，没有依赖其他第三方库。</li>\n<li>可以根据相应的 xml 修改 word 样式(当然 Docx 也可以)</li>\n</ul>\n</li>\n<li>缺点：每个请求都要生成一个解压后的模板文件夹，如果请求过多，文件夹占用的内存较大。</li>\n</ul>\n<blockquote>\n<p><a href=\"https://github.com/pipihua666/export-word/tree/master/export-node\">完整项目参考代码戳这里</a></p>\n</blockquote>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://juejin.cn/post/6850037262445445134#heading-1\">在前端如何玩转 Word 文档</a></li>\n<li><a href=\"http://xuxiaoyang.site/2019/03/25/node-echarts/\">node+echarts 实现服务器端渲染可视化图表</a></li>\n</ul>"},"primaryTag":{"name":"Golang","color":null}},"pageContext":{"postId":"5fe592fe-fa3a-5495-9fe5-3acd5f33e7fd","primaryTag":"Golang"}},"staticQueryHashes":["1116962356","2275848304","3097946992","3138592700","3462520645"]}