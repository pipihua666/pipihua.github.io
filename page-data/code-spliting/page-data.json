{"componentChunkName":"component---theme-src-templates-post-tsx","path":"/code-spliting","result":{"data":{"post":{"id":"aebdeb8c-2231-53f2-a098-f098579bdd4c","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":2}],"frontmatter":{"title":"react性能优化之代码分割","path":"/code-spliting","tags":["React"],"excerpt":"react性能优化之代码分割动态导入","created":"2021-02-20 21:45","createdPretty":"20 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"11 April, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQozwEZA+b8AEl3lk5+oWqUtpCrxp6wyKO0yaS2zIupx3qgwmSRt0uCqlSFq6a4zpOpwouhvZGiwEhvmStagyhUeihNbwBCbY1Hd5lPfqBqkLCWrMOywtS3yduDqMlxm79jkrdWhqtylrWZrMStucuirsSOoL1jgalNcZtJaY9MaY4AKUdeOF59a4ypi6W9k63CeZ25aZa4VIuxVYitWoirZIipb4yqnau8s7jGeIqnXnaaVXGXU3GXSWeMNVFyAERbcFRuh4ietbG/zai4x3STrFmDokl3lk12lGaFno6crqSosLOztqakp4aJlYqQnqCfq3V4iWJqgVlgdQCSo7Oyu8fJztTV2dzS1trO09jFzNO5wMekrLaVnqaho6e4s67a0cjr4djm29Lr49z07enbz8jDta7Kv7sAn6mwsbi9wMPFycvM09PT397b4N/b393Z3dzZ19TP0svF08rCw7mxwriu0MfBx7uxyruwyryzsqeitq2qAE5ZYlpodXGCkn6OnIWUooaXpYSYqISWpnmFkH2FjoCDiXt6fGNhZFJTVVtbXV9gX2xpZ11bXVNXXEdJTgAnMThBUF1KV2NXYWpnbHNlcn1icoFpe45bbIBNV2Y2OkFFSU9ZX2dYXWRLU1pHTVNNUVg3O0EsLjI7QUgAKzU8PUhRNz0/QUhKS05PR0hIU15jSFBWX216ZnaKNTpBMzc8Q0hNVl1jV1xhRktRNTc5GhobFxcXFRYVACAmKy02PUlUXGFudltoblJcYGZxd2Vrb11gYFxka1lhaEJFRjk6OVlbXmtucVJXXFBVW0JHTTc9RS0zOAAaHSAoLzQzO0I6Q0tGT1RgaXB2f4ZweoBye4F7goaFiY1MS00uMDQ+QUQ8QEVIS09oam9dYGhIUFo5Q00AHSAjICUqKS81QkZOXF9lbGxyY2JpYmRpaGpvdnd8b21xSElNU1VaY2RpW1pef3p7rqejmZKRcW5xTk1UABgZHBocIBweISEiJDU1OTs6PkxKUE1MUFFPU1hUWFxaXV5dYWxrboB/gYaDhJOPjpCNjYiCg3NtcVpUWyR3cmNMxJPGAAAAAElFTkSuQmCC","aspectRatio":1.5037593984962405,"src":"/static/194ac1e7e3b229f5476b4f73c92ffbdf/90823/sea.png","srcSet":"/static/194ac1e7e3b229f5476b4f73c92ffbdf/dc47e/sea.png 200w,\n/static/194ac1e7e3b229f5476b4f73c92ffbdf/9f2d5/sea.png 400w,\n/static/194ac1e7e3b229f5476b4f73c92ffbdf/90823/sea.png 800w,\n/static/194ac1e7e3b229f5476b4f73c92ffbdf/77647/sea.png 1200w,\n/static/194ac1e7e3b229f5476b4f73c92ffbdf/f8d4f/sea.png 1600w,\n/static/194ac1e7e3b229f5476b4f73c92ffbdf/4ce6a/sea.png 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"引言\" style=\"position:relative;\"><a href=\"#%E5%BC%95%E8%A8%80\" aria-label=\"引言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>引言</h2>\n<blockquote>\n<p>衡量网站的性能的指标有很多，其中有项重要的指标就是网站的首屏时间，而代码分割却是优化首屏时间最通用的方法</p>\n</blockquote>\n<h2 id=\"三种通用的代码拆分方法（基于-webpack）\" style=\"position:relative;\"><a href=\"#%E4%B8%89%E7%A7%8D%E9%80%9A%E7%94%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E6%8B%86%E5%88%86%E6%96%B9%E6%B3%95%EF%BC%88%E5%9F%BA%E4%BA%8E-webpack%EF%BC%89\" aria-label=\"三种通用的代码拆分方法（基于 webpack） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>三种通用的代码拆分方法（基于 webpack）</h2>\n<ol>\n<li>入口点：使用<a href=\"https://webpack.js.org/configuration/entry-context\"><code class=\"language-text\">entry</code></a>配置手动拆分代码</li>\n<li>防止重复：使用<a href=\"https://webpack.js.org/plugins/split-chunks-plugin/\"><code class=\"language-text\">SplitChunksPlugin</code></a>重复数据删除和拆分块</li>\n<li>动态导入：通过模块内的内联函数调用拆分代码</li>\n</ol>\n<h2 id=\"动态导入（react-loadable）有以下概念\" style=\"position:relative;\"><a href=\"#%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5%EF%BC%88react-loadable%EF%BC%89%E6%9C%89%E4%BB%A5%E4%B8%8B%E6%A6%82%E5%BF%B5\" aria-label=\"动态导入（react loadable）有以下概念 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>动态导入（<strong>react-loadable</strong>）有以下概念</h2>\n<blockquote>\n<ol>\n<li>动态导入的组件自动进行性能优异的代码分割</li>\n<li><strong>所支持的是组件的动态导入，而不是路由的动态导入</strong></li>\n<li>基本思想是组件的按需加载</li>\n<li>注意：要在 react 中使用 import()，需要安装@babel/plugin-syntax-dynamic-import 插件，并在 babel 配置中引入</li>\n<li>注意：import 的路径是相对路径，不能添加绝对路径</li>\n<li>注意：要使用魔法注释需要配置（webpack 的 SplitChunkPlugin 插件，webpack 默认已配置，开箱即用）</li>\n<li>react 中的动态导入还有：react 原生 React.lazy（v16.6），原生 Suspense，库 Loadable Component</li>\n</ol>\n</blockquote>\n<p><a name=\"xRYgO\"></a></p>\n<h2 id=\"实现\" style=\"position:relative;\"><a href=\"#%E5%AE%9E%E7%8E%B0\" aria-label=\"实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>实现</h2>\n<h3 id=\"配合-react-router-dom-实现-react-的路由组件按需加载\" style=\"position:relative;\"><a href=\"#%E9%85%8D%E5%90%88-react-router-dom-%E5%AE%9E%E7%8E%B0-react-%E7%9A%84%E8%B7%AF%E7%94%B1%E7%BB%84%E4%BB%B6%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD\" aria-label=\"配合 react router dom 实现 react 的路由组件按需加载 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>配合 react-router-dom 实现 react 的路由组件按需加载</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> Loadable <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-loadable\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// 懒加载路由</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">AsyncComponent</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">component</span> <span class=\"token operator\">=></span>\n  <span class=\"token function\">Loadable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    loader<span class=\"token operator\">:</span> lazyLoad<span class=\"token punctuation\">[</span>component<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 加载promise来加载组件</span>\n    loading<span class=\"token operator\">:</span> MyLoadingComponent<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 当加载进行中或者错误时加载的组件</span>\n    delay<span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 加载loading组件之前的延迟，防止闪屏</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> lazyLoad <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">home</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token comment\">// webpackChunkName（代码分割后的代码块名）</span>\n  \t<span class=\"token comment\">// 添加webpackPrefetch：（未来可能需要的资源）</span>\n  \t<span class=\"token comment\">//   这将导致将&lt;link rel=\"prefetch\" href=\"home.js\">其附加在页面的开头</span>\n    <span class=\"token comment\">//   这将指示浏览器在空闲时间预取home.js文件</span>\n    <span class=\"token comment\">// 不配置预加载和预取提取则按需加载</span>\n    <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"home\" */</span> <span class=\"token comment\">/* webpackPrefetch: true */</span> <span class=\"token string\">'./home'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">detail</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  \t<span class=\"token comment\">// webpackPreload（当前导航期间可能需要的资源）</span>\n    <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"detail\" /* webpackPreload: true */</span>  <span class=\"token operator\">*</span><span class=\"token operator\">/</span> <span class=\"token string\">'./detail'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Switch</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/app/home<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">AsyncComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"home\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/app/detail<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">AsyncComponent</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"detail\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Switch</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://webpack.js.org/guides/code-splitting/\">webpack 代码分割官网</a></li>\n<li><a href=\"https://github.com/jamiebuilds/react-loadable#preloading\">react-loadable 仓库</a></li>\n<li><a href=\"https://webpack.js.org/api/module-methods/#import-1\">import()文档</a></li>\n<li><a href=\"https://zh-hans.reactjs.org/docs/code-splitting.html\">react 的 lazy 代码分割</a></li>\n</ul>"},"primaryTag":{"name":"React","color":null}},"pageContext":{"postId":"aebdeb8c-2231-53f2-a098-f098579bdd4c","primaryTag":"React"}},"staticQueryHashes":["1116962356","2275848304","3097946992","3138592700","3462520645"]}