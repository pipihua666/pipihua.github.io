{"componentChunkName":"component---theme-src-templates-post-tsx","path":"/download","result":{"data":{"post":{"id":"d459636c-3533-558a-90f1-6080933d03fa","headings":[{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"通过a标签同源和跨域下载服务器文件","path":"/download","tags":["Download"],"excerpt":"通过a标签同源和跨域下载服务器文件.","created":"2021-02-20 21:45","createdPretty":"20 February, 2021","updated":"2021-04-11T00:00:00.000Z","updatedPretty":"11 April, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADmklEQVQozw3N2VMadwDA8d/CIoiCyqGJUdQk6lBtm2Smk2nsGKNJvAJRUaygMYJFQAW5bzYCsosgqJwSWREFNFbJ2VGZTNpJm+ShM+lD+//Ut+/T5wuSSGPGXbuPteeCd7fdzSnPtby/7VWw6X2UcbZZ8quPlkLYQUPtppmZc5aeotQvG1V/R5pO0bZztA24lq571JxsRP7144fDyFjY2VA8DhciXVmMtYexMr6rKXd71N6acNSc+0s/r1P/SdR8jTWco83v0BZgVlQbZ9nH+LMvxXfFoxBm4Lx9kX6Dy/ZDnUns2+deLu65ueX8JmFl/obBfwXB72s1xVXuWw/3bLURGFUtiGUo4hW/L2T/PC1kYsaDvXR+L5PP4NntcG6tA3dfizkbAhoybiacLINdCzVnaz5xcl+v1IO5aYbTzMsmPa9zyY9v8me4/Y/oyMmmMhxNZbawE/+VI5S942ZGjXDGQswipIvY1rF3DY3bpjowOUYd5QOHnnt+jAfMw+ticCiB/rWCT6Gu9MrNIzd45aflvJW4g5oyV+w46XEbJa5nhBZY/gU6EPLLBPxSiYiy4XlkXRgYuw3U96n56ZL/EFAI3DmMaXMJJBvTx+2MqPly0lEdtVJCWuaynGaXwQBTfWdT3tAruAszbP+zJ4I+bm87MPbCRTWhsCkPBhPoim89sPbc9xDVMzBTlXORYldUmOaYS0/J4KVvcN/Tv2K4Y1C0nh6lXuxsScd+lHbT4rPlqaA+Ho2v+VD/sjaAdOvmYYuaqp2jG2Rso6xONc0GBaz3YHUgifboFU1Dg5fSYenLzLrXykuHtHjItBsL5LfjeNiDGG8syYFDRzKpyrUKtkrCkAhZwDbb5FC1uqzXh3llo4/L5ZILnuXWlfgdHfiGPoQIN1xjWwG5U9tsWqRgDorLSrdpOepfasf5FUA0ShULaQIBsauTrJTUz4jLHfOkHQfRNANU0mpkqcWuarQuVNlUdS4DO+SmYQgd0V/SSDniISYYH4EG+uD7PdS+HopIUNl9FxL0A83PxCkepJikhqycLFZ+gBK8Ojqiq3RbYYsONskZmsnLU48vzvyye53EH24ReL0E4RD0qBe+10HquA3d+h7wHpAjFtZnHP6UAH4tUSMnLiogmRRSTVNko7ThhyQg6KNMjJC7foIFfEijJC3r6ufFVyZ4ZNFQyeADWDkO8nYoZyGoRQT5FDQ/R1DIoaciaGKYMNhP+B/mm1rnL6s4ygAAAABJRU5ErkJggg==","aspectRatio":1.3333333333333333,"src":"/static/24ad03741385d8cca4ad09d32942ecd9/90823/download.png","srcSet":"/static/24ad03741385d8cca4ad09d32942ecd9/dc47e/download.png 200w,\n/static/24ad03741385d8cca4ad09d32942ecd9/9f2d5/download.png 400w,\n/static/24ad03741385d8cca4ad09d32942ecd9/90823/download.png 800w,\n/static/24ad03741385d8cca4ad09d32942ecd9/77647/download.png 1200w,\n/static/24ad03741385d8cca4ad09d32942ecd9/f8d4f/download.png 1600w,\n/static/24ad03741385d8cca4ad09d32942ecd9/4ce6a/download.png 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"同源下载推荐\" style=\"position:relative;\"><a href=\"#%E5%90%8C%E6%BA%90%E4%B8%8B%E8%BD%BD%E6%8E%A8%E8%8D%90\" aria-label=\"同源下载推荐 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>同源下载(推荐)</h2>\n<ul>\n<li>优点是：通过浏览器的默认行为下载，不会阻塞</li>\n<li>缺点是：必须是同源下载，不过现在都是 webpack 和 nignx 代理，所以推荐这种下载方式</li>\n<li>简单说说：如果响应头添加 <code class=\"language-text\">Content-Disposition</code>，可不使用 <code class=\"language-text\">download</code>，两者都可以阻止浏览器默认打开文件，而不是下载文件的行为，但是前者优先级比后者高</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 从远程url下载文件(同源)\n * @param {string} url -远程的url和参数\n * @param {string} filename -下载到本地的文件名\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">downLoadFile</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> filename<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> origin <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/api/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">const</span> aLink <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span>\n  aLink<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span>\n  aLink<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> origin\n  aLink<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> filename\n  aLink<span class=\"token punctuation\">.</span>target <span class=\"token operator\">=</span> <span class=\"token string\">\"_black\"</span>\n  aLink<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">\"application/octet-stream\"</span> <span class=\"token comment\">// 让浏览器知道是二进制</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>aLink<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 如果不挂载到body上，火狐浏览器会失效</span>\n  aLink<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>aLink<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"跨域下载\" style=\"position:relative;\"><a href=\"#%E8%B7%A8%E5%9F%9F%E4%B8%8B%E8%BD%BD\" aria-label=\"跨域下载 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>跨域下载</h2>\n<ul>\n<li>缺点是：要等 blob 封装完成才能下载，如果想实现前端流式下载，可参考<a href=\"https://segmentfault.com/a/1190000021367378\">fetch 方法</a></li>\n<li>优点是：可以携带 Cookie 和请求体 实现动态下载</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 获取 blob\n * @param {string} url -目标文件地址\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">getBlob</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> xhr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    xhr<span class=\"token punctuation\">.</span>responseType <span class=\"token operator\">=</span> <span class=\"token string\">\"blob\"</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>status <span class=\"token operator\">===</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>xhr<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    xhr<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 下载blob工具函数\n * @param {string} blob -文件流\n * @param {string} filename -下载的文件名\n */</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">saveAs</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">blob<span class=\"token operator\">:</span> Blob<span class=\"token punctuation\">,</span> filename<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>msSaveOrOpenBlob<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    navigator<span class=\"token punctuation\">.</span><span class=\"token function\">msSaveBlob</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> anchor <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span>\n    anchor<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span>\n    anchor<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> filename\n\n    anchor<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span>\n    body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>anchor<span class=\"token punctuation\">)</span>\n\n    anchor<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>anchor<span class=\"token punctuation\">)</span>\n\n    window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">revokeObjectURL</span><span class=\"token punctuation\">(</span>anchor<span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/**\n * @description: 用户调用的下载函数\n * @param {string} url -目标文件地址（跨域）\n * @param {string} newFilename -想要保存的文件名称\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">download</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> newFilename<span class=\"token operator\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> blob<span class=\"token operator\">:</span> Blob <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getBlob</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">saveAs</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">,</span> newFilename<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://juejin.im/post/6844903763359039501\">一个很全面的实现前端文件下载的博客</a></li>\n<li><a href=\"https://juejin.im/post/6844904069958467592\">前端下载文件的 5 中方法对比</a></li>\n<li><a href=\"https://www.npmjs.com/package/jszip\">前端 zip 压缩文件/文件夹并下载到本地</a></li>\n</ul>"},"primaryTag":null},"pageContext":{"postId":"d459636c-3533-558a-90f1-6080933d03fa","primaryTag":"Download"}},"staticQueryHashes":["2275848304","3097946992","3138592700","3462520645"]}