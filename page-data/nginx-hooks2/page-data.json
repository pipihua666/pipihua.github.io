{"componentChunkName":"component---theme-src-templates-post-tsx","path":"/nginx-hooks2","result":{"data":{"post":{"id":"6f1c2737-bd9d-59c0-b32d-8d4dca7c4399","headings":[{"depth":2},{"depth":2},{"depth":2},{"depth":3},{"depth":2},{"depth":2},{"depth":2}],"frontmatter":{"title":"Hooks核心02","path":"/nginx-hooks2","tags":["React"],"excerpt":"两个核心Hook：掌握 React 函数组件的开发思路","created":"2021-05-30 21:54","createdPretty":"30 May, 2021","updated":"2021-05-30 21:54","updatedPretty":"30 May, 2021","featuredImage":{"childImageSharp":{"sizes":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgT/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAP/2gAMAwEAAhADEAAAAZau2E0xAf/EABkQAQEBAQEBAAAAAAAAAAAAAAEAAhEDIf/aAAgBAQABBQIzosCx5djXJ38W/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAES/9oACAEDAQE/AZWn/8QAFhEBAQEAAAAAAAAAAAAAAAAAABFB/9oACAECAQE/AcV//8QAHBAAAQMFAAAAAAAAAAAAAAAAAQACEBEyQVGB/9oACAEBAAY/AsJw4rhBpuP/xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhMVFhcf/aAAgBAQABPyEl5EVBCmKGSfIgHdMXAq8u4l7n/9oADAMBAAIAAwAAABBUz//EABYRAAMAAAAAAAAAAAAAAAAAAAEQIf/aAAgBAwEBPxCJT//EABgRAQEAAwAAAAAAAAAAAAAAAAEAESFB/9oACAECAQE/EA2wQDl//8QAGxABAQADAQEBAAAAAAAAAAAAAREAITGxgZH/2gAIAQEAAT8Q1TCIW74eZDRcN6d9w6XiJTkyEEH9wRDuR1PV+4dggM//2Q==","aspectRatio":1.5037593984962405,"src":"/static/e7ba5183968db3fd78d0c8ac5deaac29/f2cbb/header.jpg","srcSet":"/static/e7ba5183968db3fd78d0c8ac5deaac29/8850c/header.jpg 200w,\n/static/e7ba5183968db3fd78d0c8ac5deaac29/da113/header.jpg 400w,\n/static/e7ba5183968db3fd78d0c8ac5deaac29/f2cbb/header.jpg 800w,\n/static/e7ba5183968db3fd78d0c8ac5deaac29/c26c2/header.jpg 1200w,\n/static/e7ba5183968db3fd78d0c8ac5deaac29/9352a/header.jpg 1600w,\n/static/e7ba5183968db3fd78d0c8ac5deaac29/4fb49/header.jpg 1920w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"html":"<h2 id=\"新思想的开始很重要\" style=\"position:relative;\"><a href=\"#%E6%96%B0%E6%80%9D%E6%83%B3%E7%9A%84%E5%BC%80%E5%A7%8B%E5%BE%88%E9%87%8D%E8%A6%81\" aria-label=\"新思想的开始很重要 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>新思想的开始很重要</h2>\n<blockquote>\n<p>如果已经习惯了类组件的开发，那么要做的，甚至是彻底忘掉那些生命周期方法。不要遇到一个需求，就映射到这个功能该在哪个生命周期中去做，然后又要去想原来的声明周期方法在函数组件中应该怎么用 Hooks 去实现。<br>\n正确的思路应该是<b>遇到需求时，直接考虑在 Hooks 中去如何实现</b>。</p>\n</blockquote>\n<h2 id=\"usestate：让函数组件具有维持状态的能力\" style=\"position:relative;\"><a href=\"#usestate%EF%BC%9A%E8%AE%A9%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E5%85%B7%E6%9C%89%E7%BB%B4%E6%8C%81%E7%8A%B6%E6%80%81%E7%9A%84%E8%83%BD%E5%8A%9B\" aria-label=\"usestate：让函数组件具有维持状态的能力 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useState：让函数组件具有维持状态的能力</h2>\n<blockquote>\n<p>原则：<b>state 中永远不要保存可以通过计算得到的值</b></p>\n</blockquote>\n<ol>\n<li><b>通过 props 传递过来的值</b>。</li>\n<li><b>从 URL 中读到的值。</b></li>\n<li><b>从 cookie、localStorage 中读取的值。</b></li>\n</ol>\n<h2 id=\"useeffect：执行副作用\" style=\"position:relative;\"><a href=\"#useeffect%EF%BC%9A%E6%89%A7%E8%A1%8C%E5%89%AF%E4%BD%9C%E7%94%A8\" aria-label=\"useeffect：执行副作用 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useEffect：执行副作用</h2>\n<h3 id=\"什么是副作用？\" style=\"position:relative;\"><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%89%AF%E4%BD%9C%E7%94%A8%EF%BC%9F\" aria-label=\"什么是副作用？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什么是副作用？</h3>\n<blockquote>\n<p>通常来说，副作用是<b>执行与当前结果无关的代码</b>。比如说要修改函数外部的某个变量，要发起一个请求，等等。也就是说，在函数组件的当次执行过程中，useEffect 中代码的执行是不影响渲染出来的 UI 的。</p>\n</blockquote>\n<p>useEffect 让我们能够在下面四种时机去执行一个回调函数产生副作用：</p>\n<ol>\n<li>每次 render 后执行：不提供第二个依赖项参数。比如 useEffect(() => {})。</li>\n<li>仅第一次 render 后执行：提供一个空数组作为依赖项。比如 useEffect(() => {}, [])。</li>\n<li>第一次以及依赖项发生变化后执行：提供依赖项数组。比如 useEffect(() => {}, [deps])。</li>\n<li>组件 unmount 后执行：返回一个回调函数。比如 useEffect() => { return () => {} }, [])。</li>\n</ol>\n<h2 id=\"理解-hooks-的依赖\" style=\"position:relative;\"><a href=\"#%E7%90%86%E8%A7%A3-hooks-%E7%9A%84%E4%BE%9D%E8%B5%96\" aria-label=\"理解 hooks 的依赖 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>理解 Hooks 的依赖</h2>\n<blockquote>\n<p>Hooks 提供了让你监听某个数据变化的能力。这个变化可能会触发组件的刷新，也可能是去创建一个副作用，又或者是刷新一个缓存。那么定义要监听哪些数据变化的机制，其实就是指定 Hooks 的<b>依赖项</b>。</p>\n</blockquote>\n<p>定义依赖项的注意点：</p>\n<ol>\n<li>依赖项中定义的变量一定是会在回调函数中用到的，否则声明依赖项其实是没有意义的。</li>\n<li>依赖项一般是一个常量数组，而不是一个变量。因为一般在创建 callback 的时候，你其实非常清楚其中要用到哪些依赖项了。</li>\n<li>React 会使用浅比较来对比依赖项是否发生了变化，所以要特别注意数组或者对象类型。如果你是每次创建一个新对象，即使和之前的值是等价的，也会被认为是依赖项发生了变化。（每次重新渲染函数，依赖项的地址发生的变化）</li>\n</ol>\n<h2 id=\"掌握-hooks-的使用规则\" style=\"position:relative;\"><a href=\"#%E6%8E%8C%E6%8F%A1-hooks-%E7%9A%84%E4%BD%BF%E7%94%A8%E8%A7%84%E5%88%99\" aria-label=\"掌握 hooks 的使用规则 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>掌握 Hooks 的使用规则</h2>\n<blockquote>\n<p>Hooks 本身作为纯粹的 JavaScript 函数，不是通过某个特殊的 API 去创建的，而是直接定义一个函数，所以需要遵循一定的规则才能正常的工作。</p>\n</blockquote>\n<p>使用规则如下：</p>\n<ol>\n<li>在 useEffect 的回调函数中使用的变量，都必须在依赖项中声明；</li>\n<li>Hooks 不能出现在条件语句或者循环中，也不能出现在 return 之后；</li>\n<li>Hooks 只能在函数组件或者自定义 Hooks 中使用。</li>\n</ol>\n<h2 id=\"class-组件就不能使用-hooks-了吗？\" style=\"position:relative;\"><a href=\"#class-%E7%BB%84%E4%BB%B6%E5%B0%B1%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8-hooks-%E4%BA%86%E5%90%97%EF%BC%9F\" aria-label=\"class 组件就不能使用 hooks 了吗？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>class 组件就不能使用 hooks 了吗？</h2>\n<blockquote>\n<p>利用高阶组件的模式，将 Hooks 封装成高阶组件，从而让类组件使用。</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useWindowSize <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../hooks/useWindowSize\"</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">withWindowSize</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">Component</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> windowSize <span class=\"token operator\">=</span> <span class=\"token function\">useWindowSize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Component</span></span> <span class=\"token attr-name\">windowSize</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>windowSize<span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">props</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyComponent</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> windowSize <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 通过 withWindowSize 高阶组件给 MyComp 添加 windowSize 属性</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">withWindowSize</span><span class=\"token punctuation\">(</span>MyComponent<span class=\"token punctuation\">)</span></code></pre></div>"},"primaryTag":{"name":"React","color":null}},"pageContext":{"postId":"6f1c2737-bd9d-59c0-b32d-8d4dca7c4399","primaryTag":"React"}},"staticQueryHashes":["1116962356","2275848304","3097946992","3138592700","3462520645"]}